(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{2022:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(4199)}])},4199:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>nX});var r=n(4848),s=n(6540),i=n(4922),o=function(e){return e.SCYTHE="scythe",e.SWORD="sword",e.SABRES="sabres",e.SPEAR="spear",e.BOW="bow",e}({});let a={sword:{normal:37,range:5.5,maxHitsPerSwing:1},scythe:{normal:23,range:5,maxHitsPerSwing:1},sabres:{normal:17,range:4,maxHitsPerSwing:2},spear:{normal:29,range:6.25,maxHitsPerSwing:1},bow:{normal:17,range:80,maxHitsPerSwing:1}},l={scythe:{q:{type:"q",key:"q",cooldown:.775,currentCooldown:0,icon:"/icons/q1.svg",maxCooldown:1,name:"Scythe Q",isUnlocked:!0},e:{type:"e",key:"e",cooldown:.725,currentCooldown:0,icon:"/icons/e1.svg",maxCooldown:.6675,name:"Scythe E",isUnlocked:!0},r:{type:"r",key:"r",cooldown:2.05,currentCooldown:0,icon:"/icons/r1.svg",maxCooldown:1.8,name:"Boneclaw",isUnlocked:!1},passive:{type:"passive",key:"1",cooldown:.725,currentCooldown:0,icon:"/icons/p1.svg",maxCooldown:0,name:"Reanimate",isUnlocked:!1},active:{type:"active",key:"2",cooldown:4.5,currentCooldown:0,icon:"/icons/a1.svg",maxCooldown:4.5,name:"Summon Skeleton",isUnlocked:!1}},sword:{q:{type:"q",key:"q",cooldown:1,currentCooldown:0,icon:"/icons/q2.svg",maxCooldown:1.08,name:"Sword Q",isUnlocked:!0},e:{type:"e",key:"e",cooldown:3.85,currentCooldown:0,icon:"/icons/e2.svg",maxCooldown:4,name:"Sword E",isUnlocked:!0},r:{type:"r",key:"r",cooldown:1.275,currentCooldown:0,icon:"/icons/r2.svg",maxCooldown:1.75,name:"Oathstrike",isUnlocked:!1},passive:{type:"passive",key:"1",cooldown:0,currentCooldown:0,icon:"/icons/p2.svg",maxCooldown:0,name:"Crusader Aura",isUnlocked:!1},active:{type:"active",key:"2",cooldown:0,currentCooldown:0,icon:"/icons/a2.svg",maxCooldown:0,name:"Sword Active",isUnlocked:!1}},sabres:{q:{type:"q",key:"q",cooldown:.6,currentCooldown:0,icon:"/icons/q3.svg",maxCooldown:.9,name:"Sabres Q",isUnlocked:!0},e:{type:"e",key:"e",cooldown:5.75,currentCooldown:0,icon:"/icons/e3.svg",maxCooldown:10,name:"Shadow Strike",isUnlocked:!0},r:{type:"r",key:"r",cooldown:10,currentCooldown:0,icon:"/icons/r3.svg",maxCooldown:10,name:"Blizzard",isUnlocked:!1},passive:{type:"passive",key:"1",cooldown:0,currentCooldown:0,icon:"/icons/p3.svg",maxCooldown:0,name:"Frost Lance",isUnlocked:!1},active:{type:"active",key:"2",cooldown:0,currentCooldown:0,icon:"/icons/a3.svg",maxCooldown:0,name:"Orb Shield",isUnlocked:!1}},spear:{q:{type:"q",key:"q",cooldown:.65,currentCooldown:0,icon:"/icons/q4.svg",maxCooldown:1,name:"Spear Q",isUnlocked:!0},e:{type:"e",key:"e",cooldown:4,currentCooldown:0,icon:"/icons/e4.svg",maxCooldown:5,name:"Spear E",isUnlocked:!0},r:{type:"r",key:"r",cooldown:2.5,currentCooldown:0,icon:"/icons/r4.svg",maxCooldown:2.5,name:"Spear R",isUnlocked:!1},passive:{type:"passive",key:"1",cooldown:0,currentCooldown:0,icon:"/icons/p4.svg",maxCooldown:0,name:"Spear Passive",isUnlocked:!1},active:{type:"active",key:"2",cooldown:0,currentCooldown:0,icon:"/icons/a4.svg",maxCooldown:0,name:"Spear Active",isUnlocked:!1}},bow:{q:{type:"q",key:"q",cooldown:.25,currentCooldown:0,icon:"/icons/q5.svg",maxCooldown:1,name:"Quick Shot",isUnlocked:!0},e:{type:"e",key:"e",cooldown:.5,currentCooldown:0,icon:"/icons/e3.svg",maxCooldown:1,name:"Sabres E",isUnlocked:!0},r:{type:"r",key:"r",cooldown:8,currentCooldown:0,icon:"/icons/r5.svg",maxCooldown:8,name:"Rain of Arrows",isUnlocked:!1},passive:{type:"passive",key:"1",cooldown:0,currentCooldown:0,icon:"/icons/p5.svg",maxCooldown:0,name:"Eagle Eye",isUnlocked:!1},active:{type:"active",key:"2",cooldown:0,currentCooldown:0,icon:"/icons/a5.svg",maxCooldown:0,name:"Ethereal Quiver",isUnlocked:!1}}},c=(e,t,n)=>{let r=l[e][t];return"sword"===e&&"q"===t&&n.sword.passive.isUnlocked?.7375:r.cooldown},u={scythe:{q:{title:"Scythe",description:"Swift reaping attack in an arc",cost:"Cooldown: 0.75 seconds",range:"Range: 4.2 feet",damage:"Damage: 17"},e:{title:"Entropic Bolt",description:"Consumes 1 orb charge to fire a ball of chaotic energy at a single target.",cost:"Cooldown: 0.75 seconds",range:"Range: 80 feet",damage:"Damage: 53"},r:{title:"Dragon Claw",description:"Summon skeletal lazer claws to damage enemies within mid-range - 2 second cooldown.",cost:"Cooldown: 2.5 seconds",range:"Range: 8.0 feet",damage:"Damage: 67"},passive:{title:"Reanimate",description:"Active: Consumes 1 Orb Charge to heal for 7 HP - 0.75 second cooldown."},active:{title:"Chaos Totem",description:"Active: Summons a totem that fights by your side for 12 seconds, shooting rapid bolts at enemies within range - 5 second cooldown.",cost:"Cooldown: 15 seconds"}},sword:{q:{title:"Greatsword",description:"Slow powerful swing in a wide arc.",cost:"1.1",range:"6.5",damage:"29"},e:{title:"Divine Smite",description:"Unleashes an extra strike that calls down radiant energy upon nearby enemies.",cost:"30",range:"4.0",damage:"35"},r:{title:"Oathstrike",description:"Active: Consumes 4 Orb Charges to unleash a devastating strike in an arc that heals the wielder if at least one enemy is hit.",cost:"50",range:"7.0",damage:"65"},passive:{title:"Crusader Aura",description:"Passive: Increases attack speed by 30% and gives attacks a 20% chance to heal for 3 HP."},active:{title:"Chain Lightning",description:"Passive: Sword attacks conduct electricity, bouncing lightning damage to nearby enemies on every hit."}},sabres:{q:{title:"Twin Sabres",description:"Fast dual-wielding slashes at close range",cost:"12",range:"3.8",damage:"13"},e:{title:"Shadow Strike",description:"Enter stealth for 10 seconds. Breaking stealth with an attack deals +100 bonus damage. If you are behind the target, this effect is doubled. If shadowstrike lands a killing blow on an enemy, you regain health.",cost:"Cooldown: 10 seconds",range:"Self",damage:"Bonus Damage: 100"},r:{title:"Blizzard",description:"Active: Unleash a devastating ice storm to nearby enemies for 6 seconds - 10 second cooldown.",cost:"60",range:"12.0",damage:"85"},passive:{title:"Frost Lance",description:"Active: Consumes 1 Orb Charge to fire a beam of ice that piereces through all enemies in a line - 0.5 second cooldown."},active:{title:"Avalanche",description:"Passive: Melee attacks passively consume orb charges to extra damage based on the number of charges available."}},spear:{q:{title:"Spear Thrust",description:"Long-range piercing thrust attack",cost:"Cooldown: 0.85 seconds",range:"Range: 6.25 feet",damage:"Damage: 27"},e:{title:"Whirlwind",description:"Spin attack that hits all surrounding enemies",cost:"Cooldown: 0.95 seconds",range:"Range: 6.25 feet",damage:"Damage: 31"},r:{title:"Dragon's Lance",description:"Powerful charging thrust that deals massive damage",cost:"Cooldown: 2.5 seconds",range:"Range: 8.0 feet",damage:"Damage: 75"},passive:{title:"Combat Expertise",description:"Passive: Each successful hit increases attack speed slightly"},active:{title:"Spear Mastery",description:"Active: Next attack deals bonus damage based on distance to target"}},bow:{q:{title:"Quick Shot",description:"Rapidly fire an ethereal arrow",cost:"Cooldown: 0.85 seconds",range:"Range: 80 feet",damage:"Damage: 17"},e:{title:"Power Shot",description:"Charge a powerful shot that deals increased damage based on charge time. Fully charged shots pierce through enemies.",cost:"Cooldown: 0.75 seconds",range:"Range: 80 feet",damage:"Damage: 53-125"},r:{title:"Rain of Arrows",description:"Unleash a barrage of ethereal arrows in an area",cost:"Cooldown: 8 seconds",range:"Range: 60 feet",damage:"Damage: 85"},passive:{title:"Eagle Eye",description:"Passive: Increased critical hit chance at long range"},active:{title:"Ethereal Quiver",description:"Active: Next 3 shots split into multiple arrows"}}},h={scythe:8,sword:4,sabres:6,spear:8,bow:6};var d=n(8875),m=n(2805);function p(){let e=(0,s.useRef)(null),t=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(!t.current){let e=new i.ypk;for(let t=0;t<8;t++){let n=t/8*Math.PI*2,r=50*Math.cos(n),s=50*Math.sin(n);0===t?e.moveTo(r,s):e.lineTo(r,s)}e.closePath(),t.current=e}},[]),(0,r.jsx)("group",{children:(0,r.jsxs)("mesh",{ref:e,rotation:[-Math.PI/2,0,0],receiveShadow:!0,children:[t.current&&(0,r.jsx)("shapeGeometry",{args:[t.current]}),(0,r.jsx)("meshStandardMaterial",{color:"#365F4A",roughness:.7,metalness:.1,emissive:"#365F4A",emissiveIntensity:.45})]})})}var f=n(3421);let x=e=>{let{color:t,size:n,meshRef:o,opacity:a=1}=e,l=(0,s.useRef)(null),c=(0,s.useRef)(new Float32Array(72)),u=(0,s.useRef)(new Float32Array(24)),h=(0,s.useRef)(new Float32Array(24)),d=(0,s.useRef)(!1),m=(0,s.useRef)(new i.Pq0);return(0,s.useEffect)(()=>{if(o.current&&!d.current){let{x:e,y:t,z:n}=o.current.position;m.current.set(e,t,n);for(let r=0;r<24;r++)c.current[3*r]=e,c.current[3*r+1]=t,c.current[3*r+2]=n,u.current[r]=0,h.current[r]=0;d.current=!0}},[o]),(0,f.F)(()=>{var e;if(!(null===(e=l.current)||void 0===e?void 0:e.parent)||!o.current||!d.current)return;let t=o.current.position;if(t.distanceToSquared(m.current)>1e-4){m.current.copy(t);for(let e=23;e>0;e--)c.current[3*e]=c.current[(e-1)*3],c.current[3*e+1]=c.current[(e-1)*3+1],c.current[3*e+2]=c.current[(e-1)*3+2];c.current[0]=t.x,c.current[1]=t.y,c.current[2]=t.z,l.current&&(l.current.geometry.attributes.position.needsUpdate=!0)}for(let e=0;e<24;e++)u.current[e]=.6*Math.pow(1-e/24,2)*a,h.current[e]=.5*n*Math.pow(1-e/24,.5);if(l.current){let e=l.current.geometry;e.attributes.opacity.needsUpdate=!0,e.attributes.scale.needsUpdate=!0}}),(0,r.jsxs)("points",{ref:l,children:[(0,r.jsxs)("bufferGeometry",{children:[(0,r.jsx)("bufferAttribute",{attach:"attributes-position",count:24,array:c.current,itemSize:3}),(0,r.jsx)("bufferAttribute",{attach:"attributes-opacity",count:24,array:u.current,itemSize:1}),(0,r.jsx)("bufferAttribute",{attach:"attributes-scale",count:24,array:h.current,itemSize:1})]}),(0,r.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:i.EZo,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 20.0 * (300.0 / -mvPosition.z);\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          uniform vec3 uColor;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.5, 0.1, d);\n            vec3 glowColor = mix(uColor, vec3(1.0), 0.4);\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        ",uniforms:{uColor:{value:t}}})]})};function g(e){let{position:t,direction:n,onImpact:o}=e,a=(0,s.useRef)(null),l=(0,s.useRef)(new i.zD7),c=(0,s.useRef)(t.clone()),{scene:u}=(0,f.D)(),h=new i.Q1f("#00ff44"),d=(0,s.useRef)(null),m=(0,s.useRef)(null),p=(0,s.useRef)(null),g=e=>{let t=new i.tBo,n=e.clone().sub(c.current).normalize();t.set(c.current,n);let r=u.children.filter(e=>"mountain"===e.name&&e instanceof i.YJl||"tree"===e.name&&e instanceof i.YJl).flatMap(e=>{let t=[];return e.traverse(e=>{e instanceof i.eaF&&t.push(e)}),t}),s=t.intersectObjects(r,!0);if(s.length>0){let t=s[0],n=c.current.distanceTo(e);if(t.distance<=n)return console.log("Collision detected:",t.point),!0}return!1},j=e=>{p.current&&(p.current.position.copy(e),p.current.visible=!0,m.current=l.current.getElapsedTime())};return(0,f.F)((e,t)=>{if(!a.current)return;if(l.current.getElapsedTime()>10){a.current.removeFromParent();return}let r=n.clone().multiplyScalar(.3*t*60),s=c.current.clone().add(r);g(s)?(a.current&&(j(c.current),a.current.removeFromParent()),o()):(c.current.copy(s),a.current.position.copy(c.current))}),(0,r.jsxs)("group",{name:"fireball-group",children:[(0,r.jsxs)("mesh",{ref:a,position:c.current,children:[(0,r.jsx)("sphereGeometry",{args:[.28,32,32]}),(0,r.jsx)("meshStandardMaterial",{emissive:h,emissiveIntensity:2,toneMapped:!1}),(0,r.jsx)("pointLight",{color:h,intensity:5,distance:12})]}),(0,r.jsx)("group",{ref:d,visible:!1}),(0,r.jsx)(x,{color:h,size:.28,meshRef:a,opacity:1}),(0,r.jsx)("pointLight",{color:h,intensity:8,distance:4,decay:2})]})}function j(e){let{isSwinging:t,onSwingComplete:n}=e,o=(0,s.useRef)(null),a=(0,s.useRef)(0);return(0,f.F)((e,r)=>{if(t&&o.current){a.current+=8*r;let e=Math.min(a.current/Math.PI/1.5,1);if(a.current>=.85*Math.PI){a.current=0,n();return}let t=e<=.3?2*e:.75-(e-.125)*1.55,s=-1.175+2.5*Math.sin(t*Math.PI),i=.9+-1.5*Math.sin(t*Math.PI),l=.3+1.1*Math.cos(t*Math.PI);o.current.position.set(s,i,l);let c=-.75*Math.sin(t*Math.PI)+.3,u=Math.sin(t*Math.PI)*Math.PI,h=Math.PI/3*Math.sin(t*Math.PI);o.current.rotation.set(c,u,h)}else!t&&o.current&&(o.current.rotation.x*=.92,o.current.rotation.y*=.92,o.current.rotation.z*=.92,o.current.position.x+=(-1.175-o.current.position.x)*.15,o.current.position.y+=(.9-o.current.position.y)*.15,o.current.position.z+=(.3-o.current.position.z)*.15)}),(0,r.jsxs)("group",{ref:o,position:[-1.175,.9,.3],rotation:[0,0,Math.PI],scale:[1,1,1],children:[(0,r.jsxs)("group",{position:[0,-.4,0],rotation:[0,0,Math.PI+.3],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.04,.04,2.3,12]}),(0,r.jsx)("meshStandardMaterial",{color:"#a86432",roughness:.7})]}),[...Array(10)].map((e,t)=>(0,r.jsxs)("mesh",{position:[0,1-.2*t,0],rotation:[Math.PI/2,0,0],children:[" ",(0,r.jsx)("torusGeometry",{args:[.07,.01,8,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#a86432",metalness:.3,roughness:.7})]},t))]}),(0,r.jsxs)("group",{position:[-.305,.6,0],rotation:[Math.PI/1,0,Math.PI-.3],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.08,.08,.3,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.6})]}),(0,r.jsx)("group",{"rotation-x":(0,f.F)(e=>2*e.clock.getElapsedTime()),children:(0,r.jsxs)("mesh",{"position-y":-.11,rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("torusGeometry",{args:[.14,.02,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,r.jsx)("group",{"rotation-x":(0,f.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,r.jsxs)("mesh",{"position-y":-.005,rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("torusGeometry",{args:[.155,.02,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,r.jsx)("group",{"rotation-x":(0,f.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,r.jsxs)("mesh",{"position-y":.1,rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("torusGeometry",{args:[.17,.02,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,r.jsx)("group",{"rotation-x":(0,f.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,r.jsxs)("mesh",{"position-y":-.35,rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("torusGeometry",{args:[.075,.02,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1,transparent:!0,opacity:.7})]})}),(0,r.jsx)("group",{"rotation-x":(0,f.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,r.jsxs)("mesh",{"position-y":-.54,rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("torusGeometry",{args:[.075,.02,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,r.jsx)("group",{"rotation-x":(0,f.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,r.jsxs)("mesh",{"position-y":-.74,rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("torusGeometry",{args:[.075,.02,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.13,.11,.32,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.5,transparent:!0,opacity:.3})]})]}),(0,r.jsx)("group",{position:[.37,.8,.775],rotation:[.2,-Math.PI/3.6,Math.PI-.175],scale:[1,.55,1],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("extrudeGeometry",{args:[(()=>{let e=new i.ypk;return e.moveTo(0,0),e.lineTo(.4,-.13),e.bezierCurveTo(.8,.22,1.33,.5,1.6,.515),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e})(),{steps:1,depth:1e-4,bevelEnabled:!0,bevelThickness:.03,bevelSize:.035,bevelSegments:1,curveSegments:16,depth:.03}]}),(0,r.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.3,metalness:.8,roughness:.1,opacity:1,transparent:!0,side:i.$EB})]})})]})}function y(e){let{isSwinging:t,isSmiting:n,isOathstriking:o,onSwingComplete:a,onSmiteComplete:l,onOathstrikeComplete:c,hasChainLightning:u=!1}=e,h=(0,s.useRef)(null),d=(0,s.useRef)(0),m=(0,s.useRef)(0),p=[-1.18,.225,.3],x=(0,s.useRef)([]);(0,f.F)((e,r)=>{if(h.current){if(o){d.current+=8.2*r;let e=Math.min(d.current/Math.PI/1.6,1),t=p[0]+2.5*Math.sin(e*Math.PI),n=p[1]+-1*Math.sin(e*Math.PI),s=p[2]+1*Math.cos(e*Math.PI);h.current.position.set(t,n,s);let i=Math.sin(e*Math.PI)*Math.PI,o=Math.PI/2.5*Math.sin(e*Math.PI*1.275);h.current.rotation.set(1.275,i,o),d.current>=Math.PI&&(d.current=0,h.current.rotation.set(0,0,0),h.current.position.set(...p),null==c||c());return}if(n){let e,t,n,s,i;m.current+=r*(m.current<Math.PI/2?3:6);let o=Math.min(m.current/Math.PI,1);if(o<.5){let r=.45*o;e=-Math.PI/3-r*Math.PI/3,t=r*Math.PI/4,n=p[0]+1.5*r,s=p[1]+1.5*r,i=p[2]-1.5*r}else{let r=(o-.5)*2;e=-2*Math.PI/3+3*r*Math.PI/2,t=Math.PI/4*(1-r),n=p[0]+1.5*(1-r),s=p[1]+(1.5-2*r),i=p[2]-(1.5-3*r)}h.current.position.set(n,s,i),h.current.rotation.set(e,t,0),m.current>=Math.PI&&(m.current=0,h.current.rotation.set(0,0,0),h.current.position.set(...p),null==l||l());return}if(t){d.current+=4.5*r;let e=Math.min(d.current/Math.PI/1.5,1);if(d.current>=.55*Math.PI){d.current=0,h.current.rotation.set(0,0,0),h.current.position.set(...p),null==a||a();return}let t=e<=.25?2*e:.65-(e-.125)*1.7,n=p[0]+2.5*Math.sin(t*Math.PI),s=p[1]+-2*Math.sin(t*Math.PI),i=p[2]+1.1*Math.cos(t*Math.PI);h.current.position.set(n,s,i);let o=-.75*Math.sin(t*Math.PI)+1.5,l=Math.sin(t*Math.PI)*Math.PI,c=Math.PI/3*Math.sin(t*Math.PI);h.current.rotation.set(o,l,c),d.current>=Math.PI&&(d.current=0,h.current.rotation.set(0,0,0),h.current.position.set(...p),null==a||a())}else t||n||(h.current.rotation.x*=.85,h.current.rotation.y*=.85,h.current.rotation.z*=.85,h.current.position.x+=(p[0]-h.current.position.x)*.2,h.current.position.y+=(p[1]-h.current.position.y)*.2,h.current.position.z+=(p[2]-h.current.position.z)*.2);if(u&&h.current){if(.8>Math.random())for(let e=0;e<3;e++){let e=2.2*Math.random(),t=new i.Pq0((Math.random()-.5)*.4,e,(Math.random()-.5)*.4);x.current.push({position:t,velocity:new i.Pq0((Math.random()-.5)*4,(Math.random()-.2)*4,(Math.random()-.5)*4).multiplyScalar(.8),life:1,scale:.02*Math.random()+.005})}x.current.forEach(e=>{e.velocity.x+=Math.sin(.01*Date.now())*r*.5,e.velocity.z+=Math.cos(.01*Date.now())*r*.5,e.position.add(e.velocity.clone().multiplyScalar(r)),e.life-=1.5*r,e.velocity.y+=.5*r}),x.current.length>120&&(x.current=x.current.slice(-120)),x.current=x.current.filter(e=>e.life>0)}}});let g=()=>{let e=new i.ypk;return e.moveTo(0,0),e.lineTo(-.25,.25),e.lineTo(-.15,-.15),e.lineTo(0,0),e.lineTo(.25,.25),e.lineTo(.15,-.15),e.lineTo(0,0),e.lineTo(0,.08),e.lineTo(.2,.2),e.quadraticCurveTo(.8,.15,1.5,.18),e.quadraticCurveTo(2,.1,2.2,0),e.quadraticCurveTo(2,-.1,1.5,-.18),e.quadraticCurveTo(.8,-.15,.2,-.2),e.lineTo(0,-.08),e.lineTo(0,0),e},j={steps:2,depth:.05,bevelEnabled:!0,bevelThickness:.014,bevelSize:.02,bevelOffset:.04,bevelSegments:2},y={...j,depth:.06,bevelThickness:.02,bevelSize:.02,bevelOffset:0,bevelSegments:6};return(0,r.jsx)("group",{rotation:[-.575,0,.2],children:(0,r.jsxs)("group",{ref:h,position:[p[0],p[1],p[2]],rotation:[0,0,Math.PI],scale:[.8,.8,.7],children:[(0,r.jsxs)("group",{position:[-.025,-.05,.35],rotation:[0,0,-Math.PI],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.03,.04,.9,12]}),(0,r.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[...Array(8)].map((e,t)=>(0,r.jsxs)("mesh",{position:[0,.35-.11*t,0],rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("torusGeometry",{args:[.045,.016,8,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,r.jsxs)("group",{position:[-.025,.7,.35],rotation:[Math.PI,1.5,Math.PI],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("torusGeometry",{args:[.26,.07,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#4a5b6c",metalness:.9,roughness:.1})]}),[...Array(8)].map((e,t)=>(0,r.jsxs)("mesh",{position:[.25*Math.cos(t*Math.PI/4),.25*Math.sin(t*Math.PI/4),0],rotation:[0,0,t*Math.PI/4-Math.PI/2],children:[(0,r.jsx)("coneGeometry",{args:[.07,.55,3]}),(0,r.jsx)("meshStandardMaterial",{color:"#4a5b6c",metalness:.9,roughness:.1})]},"spike-".concat(t))),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.155,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:new i.Q1f(0xffff00),emissive:new i.Q1f(0xff6f00),emissiveIntensity:2,transparent:!0,opacity:1})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.1,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:new i.Q1f(0xffff00),emissive:new i.Q1f(0xffff00),emissiveIntensity:40,transparent:!0,opacity:.8})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.145,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:new i.Q1f(0xffff00),emissive:new i.Q1f(0xff6f00),emissiveIntensity:35,transparent:!0,opacity:.6})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.175,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:new i.Q1f(0xffff00),emissive:new i.Q1f(0xff6f00),emissiveIntensity:30,transparent:!0,opacity:.4})]}),(0,r.jsx)("pointLight",{color:new i.Q1f(0xff6f00),intensity:2,distance:.5,decay:2})]}),(0,r.jsxs)("group",{position:[0,1,.35],rotation:[0,-Math.PI/2,Math.PI/2],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("extrudeGeometry",{args:[g(),j]}),(0,r.jsx)("meshStandardMaterial",{color:new i.Q1f(0xff6f00),emissive:new i.Q1f(0xff6f00),emissiveIntensity:2.5,metalness:.3,roughness:.1})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("extrudeGeometry",{args:[(()=>{let e=new i.ypk;return e.moveTo(0,0),e.lineTo(0,.06),e.lineTo(.15,.15),e.quadraticCurveTo(1.2,.12,1.5,.15),e.quadraticCurveTo(2,.08,2.15,0),e.quadraticCurveTo(2,-.08,1.5,-.15),e.quadraticCurveTo(1.2,-.12,.15,-.15),e.lineTo(0,-.05),e.lineTo(0,0),e})(),y]}),(0,r.jsx)("meshStandardMaterial",{color:new i.Q1f(0xffb700),emissive:new i.Q1f(0xff6f00),emissiveIntensity:5,metalness:.2,roughness:.1,opacity:.8,transparent:!0})]})]}),(0,r.jsx)("group",{children:u&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("group",{position:[0,1,.35],rotation:[0,-Math.PI/2,Math.PI/2],scale:[1.0625,1.25,1.05],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("extrudeGeometry",{args:[g(),{...j,depth:.07}]}),(0,r.jsx)("meshStandardMaterial",{color:new i.Q1f(0xffd700),emissive:new i.Q1f(0xffa500),emissiveIntensity:1.5,transparent:!0,opacity:.3,blending:i.EZo})]})}),x.current.map((e,t)=>(0,r.jsxs)("mesh",{position:e.position.toArray(),scale:[e.scale,e.scale,e.scale],children:[(0,r.jsx)("sphereGeometry",{args:[1.25,6,6]}),(0,r.jsx)("meshStandardMaterial",{color:new i.Q1f(0xffd700),emissive:new i.Q1f(0xffa500),emissiveIntensity:3*e.life,transparent:!0,opacity:.6*e.life,blending:i.EZo})]},t))]})})]})})}let M=(e,t,n)=>e*(1-n)+t*n;function v(e){let{isSwinging:t,onSwingComplete:n,onLeftSwingStart:o,onRightSwingStart:a,isBowCharging:l,hasActiveAbility:c=!1,leftTargetPosition:u=null,rightTargetPosition:h=null}=e,d=(0,s.useRef)(null),m=(0,s.useRef)(0),p=(0,s.useRef)(null),g=(0,s.useRef)(0),j=[-.8,.75,.65],y=[.8,.75,.65],v=(0,s.useRef)(0),P=(0,s.useRef)(!1),S=(0,s.useRef)(0),I=(0,s.useRef)(null),b=(0,s.useRef)(null),[F,C]=(0,s.useState)([]);(0,f.F)((e,r)=>{if(d.current&&p.current){if(l)d.current.position.x+=(-.8-d.current.position.x)*.3,d.current.position.y+=(-.2-d.current.position.y)*.3,d.current.position.z+=(.5-d.current.position.z)*.3,p.current.position.x+=(.8-p.current.position.x)*.3,p.current.position.y+=(-.2-p.current.position.y)*.3,p.current.position.z+=(.5-p.current.position.z)*.3,d.current.rotation.x=M(1.05*d.current.rotation.x,.37*Math.PI,.3),d.current.rotation.z=M(d.current.rotation.z,1.7*Math.PI,.2),p.current.rotation.x=M(1.05*p.current.rotation.x,.37*Math.PI,.3),p.current.rotation.z=M(p.current.rotation.z,-(1.7*Math.PI),.2),m.current=0,g.current=0,S.current=0,v.current=0,P.current=!1;else if(t){if(0===m.current&&0===g.current&&(P.current=!1),d.current){if(S.current<.175)S.current+=r;else{0===m.current&&o(),m.current+=9*r;let e=Math.min(m.current/Math.PI,1),t=j[0]+1.2*Math.sin(e*Math.PI)-.45,n=j[1]+-.25*Math.sin(e*Math.PI*2),s=j[2]+2*Math.sin(e*Math.PI);d.current.position.set(t,n,s);let i=.65*Math.PI*Math.sin(e*Math.PI),a=.3*Math.PI*Math.sin(e*Math.PI),l=-.1*Math.PI*Math.sin(e*Math.PI);d.current.rotation.set(i,a,l),m.current>=Math.PI&&(m.current=0,S.current=0,d.current.rotation.set(0,0,0),d.current.position.set(...j))}}if(p.current){0===g.current&&a(),g.current+=9*r;let e=Math.min(g.current/Math.PI,1),t=y[0]-1.2*Math.sin(e*Math.PI)+.45,s=y[1]+-.25*Math.sin(e*Math.PI*2),i=y[2]+2*Math.sin(e*Math.PI);p.current.position.set(t,s,i);let o=.5*Math.PI*Math.sin(e*Math.PI),l=-(.3*Math.PI*Math.sin(e*Math.PI)),c=.2*Math.PI*Math.sin(e*Math.PI);p.current.rotation.set(o,l,c),g.current>=Math.PI&&(g.current=0,v.current=0,p.current.rotation.set(0,0,0),p.current.position.set(...y),P.current=!0,n())}}else d.current.position.x+=(j[0]-d.current.position.x)*.2,d.current.position.y+=(j[1]-d.current.position.y)*.2,d.current.position.z+=(j[2]-d.current.position.z)*.2,p.current.position.x+=(y[0]-p.current.position.x)*.2,p.current.position.y+=(y[1]-p.current.position.y)*.2,p.current.position.z+=(y[2]-p.current.position.z)*.2,d.current.rotation.x*=.85,d.current.rotation.y*=.85,d.current.rotation.z*=.85,p.current.rotation.x*=.85,p.current.rotation.y*=.85,p.current.rotation.z*=.85,t||(m.current=0,g.current=0,S.current=0,v.current=0,P.current=!1)}});let E=()=>{let e=new i.ypk;return e.moveTo(0,0),e.lineTo(-.15,.1),e.lineTo(-.2,0),e.lineTo(-.2,-.05),e.lineTo(0,0),e.lineTo(.15,.1),e.lineTo(.2,0),e.lineTo(.3,0),e.lineTo(0,0),e.lineTo(0,.05),e.quadraticCurveTo(.3,.15,.5,.2),e.quadraticCurveTo(.7,.25,.9,.15),e.quadraticCurveTo(1,.1,1.1,0),e.quadraticCurveTo(1,-.05,.8,-.1),e.lineTo(.7,-.15),e.lineTo(.65,-.1),e.quadraticCurveTo(.4,-.08,.2,-.05),e.quadraticCurveTo(.1,-.02,0,0),e},k=()=>{let e=new i.ypk;return e.moveTo(0,0),e.lineTo(-.13,.08),e.lineTo(-.18,0),e.lineTo(-.08,-.04),e.lineTo(0,0),e.lineTo(.13,.08),e.lineTo(.18,0),e.lineTo(.08,-.04),e.lineTo(0,0),e.lineTo(0,.04),e.quadraticCurveTo(.28,.13,.48,.18),e.quadraticCurveTo(.68,.23,.88,.13),e.quadraticCurveTo(.98,.08,1.08,0),e.quadraticCurveTo(.98,-.04,.78,-.08),e.lineTo(.68,-.13),e.lineTo(.63,-.08),e.quadraticCurveTo(.38,-.06,.18,-.04),e.quadraticCurveTo(.08,-.02,0,0),e},R={steps:2,depth:.02,bevelEnabled:!0,bevelThickness:.004,bevelSize:.01,bevelSegments:3},T={...R,depth:.025,bevelThickness:.003,bevelSize:.004,bevelOffset:0};return(0,s.useEffect)(()=>{c&&u&&m.current>0&&C(e=>[...e,{id:Math.random(),position:u}])},[c,u]),(0,s.useEffect)(()=>{c&&h&&g.current>0&&C(e=>[...e,{id:Math.random(),position:h}])},[c,h]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("group",{position:[0,-.6,.5],rotation:[-.55,0,0],scale:[.875,.8,.8],children:[(0,r.jsxs)("group",{ref:d,position:[j[0],j[1],j[2]],rotation:[0,0,Math.PI],scale:[1,1,.875],children:[(0,r.jsxs)("group",{position:[.2,-.125,0],rotation:[0,0,-Math.PI],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.015,.02,.45,12]}),(0,r.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,r.jsxs)("mesh",{position:[0,.175-.065*t,0],children:[(0,r.jsx)("torusGeometry",{args:[.0225,.004,8,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,r.jsxs)("group",{position:[.2,.3,0],rotation:[0,Math.PI/2,Math.PI/2],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("extrudeGeometry",{args:[E(),R]}),(0,r.jsx)("meshStandardMaterial",{color:"#0066ff",emissive:"#0088ff",emissiveIntensity:3,metalness:.9,roughness:.2,opacity:.9,transparent:!0})]}),(0,r.jsxs)("mesh",{position:[0,0,-.02],children:["  ",(0,r.jsx)("extrudeGeometry",{args:[k(),{...T,depth:.06}]}),(0,r.jsx)("meshStandardMaterial",{color:"#0033ff",emissive:"#0066ff",emissiveIntensity:8,metalness:.7,roughness:.1,opacity:.4,transparent:!0})]}),(0,r.jsx)("pointLight",{color:"#0088ff",intensity:5,distance:2,decay:2}),c&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("mesh",{ref:I,position:[-.15,0,0],children:[(0,r.jsx)("sphereGeometry",{args:[.06,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#0066ff",emissive:"#0088ff",emissiveIntensity:3,transparent:!0,opacity:.9})]}),(0,r.jsx)(x,{meshRef:I,color:new i.Q1f("#0088ff"),size:.04,opacity:.6})]})]})]}),(0,r.jsxs)("group",{ref:p,position:[y[0],y[1],y[2]],rotation:[0,0,Math.PI],scale:[1,1,.875],children:[(0,r.jsxs)("group",{position:[-.2,-.125,0],rotation:[0,0,-Math.PI],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.015,.02,.45,12]}),(0,r.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,r.jsxs)("mesh",{position:[0,.175-.065*t,0],children:[(0,r.jsx)("torusGeometry",{args:[.0225,.004,8,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,r.jsxs)("group",{position:[-.2,.3,0],rotation:[0,Math.PI/2,Math.PI/2],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("extrudeGeometry",{args:[E(),R]}),(0,r.jsx)("meshStandardMaterial",{color:"#0066ff",emissive:"#0088ff",emissiveIntensity:2,metalness:.9,roughness:.2,opacity:.9,transparent:!0})]}),(0,r.jsxs)("mesh",{position:[0,0,-.02],children:["  ",(0,r.jsx)("extrudeGeometry",{args:[k(),{...T,depth:.06}]}),(0,r.jsx)("meshStandardMaterial",{color:"#0033ff",emissive:"#0066ff",emissiveIntensity:3.5,metalness:.7,roughness:.1,opacity:.4,transparent:!0})]}),(0,r.jsx)("pointLight",{color:"#0088ff",intensity:1.5,distance:2,decay:2}),c&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("mesh",{ref:b,position:[-.15,0,0],children:[(0,r.jsx)("sphereGeometry",{args:[.06,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#0066ff",emissive:"#0088ff",emissiveIntensity:3,transparent:!0,opacity:.9})]}),(0,r.jsx)(x,{meshRef:b,color:new i.Q1f("#0088ff"),size:.04,opacity:.6})]})]})]})]}),F.map(e=>(0,r.jsx)(w,{position:e.position,onComplete:()=>{C(t=>t.filter(t=>t.id!==e.id))}},e.id))]})}let w=e=>{let{position:t,onComplete:n}=e,[o,a]=(0,s.useState)(()=>Array(15).fill(null).map(()=>({position:new i.Pq0(t.x+(Math.random()-.5)*.2,t.y,t.z+(Math.random()-.5)*.2),velocity:new i.Pq0((Math.random()-.5)*2,3*Math.random(),(Math.random()-.5)*2),scale:.3*Math.random()+.1,life:1})));return(0,f.F)((e,t)=>{a(e=>{let r=e.map(e=>(e.velocity.y-=5*t,e.position.add(e.velocity.multiplyScalar(t)),e.life-=1.5*t,e)).filter(e=>e.life>0);return 0===r.length&&n(),r})}),(0,r.jsx)("group",{children:o.map((e,t)=>(0,r.jsxs)("mesh",{position:e.position.toArray(),scale:[e.scale,e.scale,e.scale],children:[(0,r.jsx)("icosahedronGeometry",{args:[1,0]}),(0,r.jsx)("meshStandardMaterial",{color:"#A5F3FC",emissive:"#A5F3FC",emissiveIntensity:1.5,transparent:!0,opacity:.7*e.life,depthWrite:!1,blending:i.EZo})]},t))})};function P(e){let{chargeProgress:t,isCharging:n,onRelease:o}=e,a=(0,s.useRef)(null),l=(0,s.useRef)(n),c=(0,s.useRef)(null);return(0,f.F)(()=>{!l.current&&n&&(c.current=Date.now()),l.current&&!n&&(o(Math.min((c.current?(Date.now()-c.current)/1e3:0)/2,1)),c.current=null),l.current=n}),(0,r.jsx)("group",{position:[.6,.6,.6],rotation:[-Math.PI/2,-Math.PI/2,-Math.PI/2],scale:[.875,.8,.8],children:(0,r.jsxs)("group",{ref:a,position:[-.9,0,.75],rotation:[Math.PI,Math.PI/2,0],children:[(0,r.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("tubeGeometry",{args:[new i.B6O([new i.Pq0(-.875,0,0),new i.Pq0(-.85,.2,0),new i.Pq0(-.25,.5,0),new i.Pq0(-.4,.35,0),new i.Pq0(.4,.35,0),new i.Pq0(.25,.5,0),new i.Pq0(.85,.2,0),new i.Pq0(.875,0,0)]),64,.035,8,!1]}),(0,r.jsx)("meshStandardMaterial",{color:"#C18C4B",emissive:"#C18C4B",emissiveIntensity:1.5,transparent:!0,opacity:.8})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("tubeGeometry",{args:[(e=>{let t=1.35*e;return new i.s0K(new i.Pq0(-.8,0,0),new i.Pq0(0,0,-t),new i.Pq0(0,0,-t),new i.Pq0(.8,0,0))})(t),16,.02,8,!1]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#ffffff",emissiveIntensity:1,transparent:!0,opacity:.6})]}),(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{position:[-.4,0,.475],rotation:[Math.PI/2,0,Math.PI/6],children:[(0,r.jsx)("boxGeometry",{args:[.6,.02,.05]}),(0,r.jsx)("meshStandardMaterial",{color:"#C18C4B",emissive:"#C18C4B",emissiveIntensity:1.5,transparent:!0,opacity:.8})]}),(0,r.jsxs)("mesh",{position:[.4,0,.475],rotation:[Math.PI/2,0,-Math.PI/6],children:[(0,r.jsx)("boxGeometry",{args:[.6,.02,.05]}),(0,r.jsx)("meshStandardMaterial",{color:"#C18C4B",emissive:"#C18C4B",emissiveIntensity:1.5,transparent:!0,opacity:.8})]})]}),n&&(0,r.jsxs)("group",{position:[0,0,.8-1.35*t],rotation:[Math.PI/2,0,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.015,.02,.9,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:3,transparent:!0,opacity:.9})]}),(0,r.jsxs)("mesh",{position:[0,.35,0],children:[(0,r.jsx)("coneGeometry",{args:[.03,.175,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:3,transparent:!0,opacity:.9})]})]})]})})}function S(e){let{isSwinging:t,onSwingComplete:n,enemyData:o,onHit:a,setDamageNumbers:l,nextDamageNumberId:c}=e,u=(0,s.useRef)(null),h=(0,s.useRef)(0),d=[-1.18,.225,-.3],m=(0,s.useRef)({}),p=(0,s.useRef)({});(0,f.F)((e,r)=>{if(u.current){if(t){let e;0===h.current&&(m.current={},p.current={}),h.current+=10*r;let t=Math.min(h.current/Math.PI/1.5,1);if(t>.4&&t<.8&&a&&l&&c&&(null==o||o.forEach(e=>{let t=Date.now();if(t-(p.current[e.id]||0)<200||m.current[e.id])return;let n=u.current.localToWorld(new i.Pq0(0,1,.35));if(6.25>=n.distanceTo(e.position)){let r=new i.Pq0(0,0,1).applyQuaternion(u.current.quaternion),s=new i.Pq0().subVectors(e.position,n).normalize();Math.abs(r.angleTo(s))<=Math.PI/6&&(a(e.id,27),l(t=>[...t,{id:c.current++,damage:27,position:e.position.clone(),isCritical:!1}]),m.current[e.id]=1,p.current[e.id]=t)}})),h.current>=.75*Math.PI){h.current=0,m.current={},p.current={},u.current.rotation.set(0,0,Math.PI),u.current.position.set(...d),null==n||n();return}e=t<.2?d[2]+-(t/.2*.8):t<.5?d[2]+-.8+(3.35+Math.abs(-.8))*Math.sin((t-.2)/.3*Math.PI/2):d[2]+3.35*(1-(t-.5)/.5),u.current.position.set(d[0],d[1],e);let s=-Math.PI/2;t<.2?s+=t/.2*.1:t<.5&&(s+=.1-(t-.2)/.3*.1),u.current.rotation.set(s,0,Math.PI)}else u.current.rotation.x=-Math.PI/2,u.current.rotation.y=0,u.current.rotation.z=Math.PI,u.current.position.x+=(d[0]-u.current.position.x)*.2,u.current.position.y+=(d[1]-u.current.position.y)*.2,u.current.position.z+=(d[2]-u.current.position.z)*.2}});let x=()=>{let e=new i.ypk;return e.moveTo(0,0),e.lineTo(.15,-.23),e.bezierCurveTo(.8,.22,1.13,.5,1.6,.6),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e},g=()=>{let e=new i.ypk;return e.moveTo(0,0),e.lineTo(0,.06),e.lineTo(.15,.15),e.quadraticCurveTo(1.2,.12,1.5,.15),e.quadraticCurveTo(2,.08,2.15,0),e.quadraticCurveTo(2,-.08,1.5,-.15),e.quadraticCurveTo(1.2,-.12,.15,-.15),e.lineTo(0,-.05),e.lineTo(0,0),e},j={steps:2,depth:.05,bevelEnabled:!0,bevelThickness:.014,bevelSize:.02,bevelOffset:.04,bevelSegments:2},y={...j,depth:.06,bevelThickness:.02,bevelSize:.02,bevelOffset:0,bevelSegments:6};return(0,r.jsx)("group",{position:[0,-.4,.6],rotation:[-.55,.15,0],scale:[.875,.8,.8],children:(0,r.jsxs)("group",{ref:u,position:[d[0],d[1],d[2]],rotation:[Math.PI/2,0,0],scale:[.8,.8,.7],children:[(0,r.jsxs)("group",{position:[-.025,-.55,.35],rotation:[0,0,-Math.PI],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.03,.04,2.2,12]})," ",(0,r.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[...Array(12)].map((e,t)=>(0,r.jsxs)("mesh",{position:[0,1-.18*t,0],rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("torusGeometry",{args:[.045,.016,8,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,r.jsxs)("group",{position:[-.025,.45,.35],rotation:[Math.PI,1.5,Math.PI],children:[" ",(0,r.jsxs)("mesh",{children:[(0,r.jsx)("torusGeometry",{args:[.26,.07,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#4a5b6c",metalness:.9,roughness:.1})]}),[...Array(8)].map((e,t)=>(0,r.jsxs)("mesh",{position:[.25*Math.cos(t*Math.PI/4),.25*Math.sin(t*Math.PI/4),0],rotation:[0,0,t*Math.PI/4-Math.PI/2],children:[(0,r.jsx)("coneGeometry",{args:[.07,.55,3]}),(0,r.jsx)("meshStandardMaterial",{color:"#4a5b6c",metalness:.9,roughness:.1})]},"spike-".concat(t))),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.155,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:new i.Q1f(0xff0000),emissive:new i.Q1f(0xff0000),emissiveIntensity:2,transparent:!0,opacity:1})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.1,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:new i.Q1f(0xff0000),emissive:new i.Q1f(0xff0000),emissiveIntensity:40,transparent:!0,opacity:.8})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.145,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:new i.Q1f(0xff0000),emissive:new i.Q1f(0xff0000),emissiveIntensity:35,transparent:!0,opacity:.6})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.175,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:new i.Q1f(0xff0000),emissive:new i.Q1f(0xff0000),emissiveIntensity:30,transparent:!0,opacity:.4})]}),(0,r.jsx)("pointLight",{color:new i.Q1f(0xff0000),intensity:2,distance:.5,decay:2})]}),(0,r.jsxs)("group",{position:[0,.75,.35],children:[(0,r.jsx)("group",{rotation:[0,0,0],children:(0,r.jsx)("group",{rotation:[0,0,-1.675],scale:[-.6,-.6,.6],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("extrudeGeometry",{args:[x(),j]}),(0,r.jsx)("meshStandardMaterial",{color:new i.Q1f(0xff0000),emissive:new i.Q1f(0xff0000),emissiveIntensity:1.55,metalness:.8,roughness:.1,opacity:.8,transparent:!0,side:i.$EB})]})})}),(0,r.jsx)("group",{rotation:[0,2*Math.PI/3,0],children:(0,r.jsx)("group",{rotation:[0,0,-1.675],scale:[-.6,-.6,.6],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("extrudeGeometry",{args:[x(),j]}),(0,r.jsx)("meshStandardMaterial",{color:new i.Q1f(0xff0000),emissive:new i.Q1f(0xff0000),emissiveIntensity:1.55,metalness:.8,roughness:.1,opacity:.8,transparent:!0,side:i.$EB})]})})}),(0,r.jsx)("group",{rotation:[0,4*Math.PI/3,0],children:(0,r.jsx)("group",{rotation:[0,0,-1.675],scale:[-.6,-.6,.6],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("extrudeGeometry",{args:[x(),j]}),(0,r.jsx)("meshStandardMaterial",{color:new i.Q1f(0xff0000),emissive:new i.Q1f(0xff0000),emissiveIntensity:1.55,metalness:.8,roughness:.1,opacity:.8,transparent:!0,side:i.$EB})]})})})]}),(0,r.jsxs)("group",{position:[0,.65,.35],rotation:[0,-Math.PI/2,Math.PI/2],scale:[.8,.8,.5],children:[" ",(0,r.jsxs)("mesh",{children:[(0,r.jsx)("extrudeGeometry",{args:[g(),j]}),(0,r.jsx)("meshStandardMaterial",{color:new i.Q1f(0xff0000),emissive:new i.Q1f(0xff0000),emissiveIntensity:1.5,metalness:.3,roughness:.1})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("extrudeGeometry",{args:[g(),y]}),(0,r.jsx)("meshStandardMaterial",{color:new i.Q1f(0xff0000),emissive:new i.Q1f(0xff0000),emissiveIntensity:1,metalness:.2,roughness:.1,opacity:.8,transparent:!0})]})]})]})})}function I(e){let{position:t,onComplete:n}=e,o=(0,s.useRef)(null),a=(0,s.useRef)(0),l=(0,s.useRef)(0),c=(0,s.useMemo)(()=>({core:new i.Ho_(.105,.105,20,16),inner:new i.Ho_(.25,.25,20,16),outer:new i.Ho_(.42,.42,20,16),glow1:new i.Ho_(.6,.6,20,16),glow2:new i.Ho_(.75,.6,20,16),outerGlow:new i.Ho_(.8,.9,20,16),torus:new i.O3Y(1.175,.1,8,32),skyTorus:new i.O3Y(1,.1,32,32),sphere:new i.Gu$(.15,8,8)}),[]),u=(0,s.useMemo)(()=>({core:new i._4j({color:"#FF7300",emissive:"#FFD500",emissiveIntensity:50,transparent:!0,opacity:.995}),inner:new i._4j({color:"#FF7300",emissive:"#FFD500",emissiveIntensity:25,transparent:!0,opacity:.675}),outer:new i._4j({color:"#FF7300",emissive:"#FFD500",emissiveIntensity:5,transparent:!0,opacity:.625}),glow1:new i._4j({color:"#FF7300",emissive:"#FFD500",emissiveIntensity:2.5,transparent:!0,opacity:.55}),glow2:new i._4j({color:"#FF7300",emissive:"#FF8812",emissiveIntensity:2.5,transparent:!0,opacity:.425}),outerGlow:new i._4j({color:"#FF7300",emissive:"#FF8812",emissiveIntensity:1,transparent:!0,opacity:.2}),spiral:new i._4j({color:"#FF0000",emissive:"#FF8812",emissiveIntensity:10,transparent:!0,opacity:.5}),skySpiral:new i._4j({color:"#FF0000",emissive:"#FF8812",emissiveIntensity:10,transparent:!0,opacity:.4}),particle:new i._4j({color:"#FF0000",emissive:"#FF8812",emissiveIntensity:10,transparent:!0,opacity:.665})}),[]),h=(0,s.useMemo)(()=>[,,,].fill(0).map((e,t)=>({rotation:new i.O9p(Math.PI/4,t*Math.PI/1.5,Math.PI)})),[]),d=(0,s.useMemo)(()=>Array(16).fill(0).map((e,t)=>({rotation:new i.O9p(0,t*Math.PI/1.5,0),position:new i.Pq0(0,7.45,0)})),[]),m=(0,s.useMemo)(()=>Array(8).fill(0).map((e,t)=>({position:new i.Pq0(1*Math.cos(t*Math.PI/4),(t-4)*2,1*Math.sin(t*Math.PI/4))})),[]);return(0,f.F)((e,t)=>{if(!o.current)return;if(l.current<.05){l.current+=t;return}a.current+=t;let r=Math.min(a.current/.9,1);if(r<1){o.current.position.y=40*(1-r);let e=r<.9?1:1-(r-.9)/.1;o.current.scale.set(e,e,e)}else n()}),(0,r.jsxs)("group",{ref:o,position:[t.x,25,t.z],visible:l.current>=.05,children:[(0,r.jsx)("mesh",{geometry:c.core,material:u.core}),(0,r.jsx)("mesh",{geometry:c.inner,material:u.inner}),(0,r.jsx)("mesh",{geometry:c.outer,material:u.outer}),(0,r.jsx)("mesh",{geometry:c.glow1,material:u.glow1}),(0,r.jsx)("mesh",{geometry:c.glow2,material:u.glow2}),(0,r.jsx)("mesh",{geometry:c.outerGlow,material:u.outerGlow}),h.map((e,t)=>(0,r.jsx)("mesh",{rotation:e.rotation,geometry:c.torus,material:u.spiral},t)),d.map((e,t)=>(0,r.jsx)("mesh",{rotation:e.rotation,position:e.position,geometry:c.skyTorus,material:u.skySpiral},t)),m.map((e,t)=>(0,r.jsx)("mesh",{position:e.position,geometry:c.sphere,material:u.particle},t)),(0,r.jsx)("pointLight",{position:[0,-10,0],color:"#ff8800",intensity:35,distance:25}),(0,r.jsx)("pointLight",{position:[0,0,0],color:"#ffaa00",intensity:10,distance:6})]})}var b=n(2027);function F(e){let{damage:t,position:n,isCritical:i=!1,isLightning:o=!1,isBlizzard:a=!1,isHealing:l=!1,isBoneclaw:c=!1,isOathstrike:u=!1,isFirebeam:h=!1,isOrbShield:d=!1,isChainLightning:m=!1,isFireball:p=!1,isSummon:x=!1,isStealthStrike:g=!1,onComplete:j}=e;console.log("DamageNumber props:",{damage:t,isCritical:i,isBlizzard:a,isLightning:o,isHealing:l,isBoneclaw:c,isOrbShield:d,isChainLightning:m});let y=(0,s.useRef)(null),M=(0,s.useRef)(Date.now()),v=n.y+3.5,{camera:w}=(0,f.D)(),P=Date.now()%1e3/1e3,S=.3*Math.sin(P*Math.PI*2),I=.2*Math.cos(P*Math.PI*2);(0,f.F)(()=>{if(!y.current)return;let e=(Date.now()-M.current)/1e3;if(e>=1.5){j();return}y.current.quaternion.copy(w.quaternion);let t=e/1.5,r=v+1.2*(1-Math.pow(1-t,3)),s=n.x+S;y.current.position.set(s,r+I,n.z),y.current.material.opacity=Math.min(1,3*(1-t))});let F=()=>l?"#338C66":m?"#ffff00":d?"#13F3FF":i?"#FF2D22":x?"#B999FF":c?"#00FF11":o?"#FFD000":u?"#FF9441":h?"#00FFE5":a?"#00B7FF":p?"#00C946":g?"#FF00FF":"#EBEBEB";return console.log("Text color:",F(),"isHealing:",l),(0,r.jsx)(b.E,{ref:y,position:[n.x,v,n.z],fontSize:.6,color:F(),anchorX:"center",anchorY:"middle",outlineWidth:.05,outlineColor:"#000000","material-transparent":!0,"material-depthTest":!1,children:l?"+".concat(t):t})}function C(e){let{children:t,position:n=[0,0,0],lockX:o=!1,lockY:a=!1,lockZ:l=!1}=e,c=(0,s.useRef)(null);return(0,f.F)(e=>{let{camera:t}=e;if(!c.current)return;let n=c.current.position,r=t.position,s=new i.Pq0().subVectors(r,n),u=c.current.rotation.clone();a||(u.y=Math.atan2(s.x,s.z)),o||(u.x=Math.atan2(-s.y,Math.sqrt(s.x*s.x+s.z*s.z))),l||(u.z=0),c.current.rotation.set(u.x,u.y,u.z)}),(0,r.jsx)("group",{ref:c,position:n,children:t})}function E(e){let{parentRef:t,weaponType:n}=e,a=(0,s.useRef)([]),l=(0,s.useRef)([]),[c,u]=(0,s.useState)(!1);(0,s.useEffect)(()=>{if(t.current){let e=t.current.position.clone();l.current=Array(30).fill(0).map(()=>e.clone()),u(!0)}},[t]);let h=()=>{switch(n){case o.SCYTHE:return"#00FF37";case o.SWORD:return"#FFB300";case o.SABRES:return"#00BFFF";case o.SPEAR:return"#FF544E";case o.BOW:return"#3A905E"}};return((0,f.F)(()=>{if(!t.current||!c)return;let e=t.current.position.clone();l.current.unshift(e),l.current=l.current.slice(0,30),a.current.forEach((e,t)=>{e&&l.current[t]&&(e.position.copy(l.current[t]),e.scale.setScalar(1-t/30*.6),e.material&&e.material instanceof i.V9B&&(e.material.opacity=(1-t/30)*.2))})}),c)?(0,r.jsx)(r.Fragment,{children:Array.from({length:30}).map((e,t)=>(0,r.jsxs)("mesh",{ref:e=>{e&&(a.current[t]=e)},children:[(0,r.jsx)("sphereGeometry",{args:[.43,32,32]}),(0,r.jsx)("meshBasicMaterial",{color:new i.Q1f(h()),transparent:!0,opacity:.3,depthWrite:!1})]},t))}):null}function k(e){let{collectedBones:t,isLeftWing:n}=e,o=(0,s.useRef)(null),a=[{pos:new i.Pq0(n?-.3:.3,.275,0),rot:new i.O9p(0,0,n?-Math.PI/5:Math.PI/5),scale:1.2},{pos:new i.Pq0(n?-.5:.5,.45,0),rot:new i.O9p(0,0,n?-Math.PI/3.5:Math.PI/3.5),scale:1.4},{pos:new i.Pq0(n?-.65:.65,.6,0),rot:new i.O9p(0,0,n?-Math.PI/2.5:Math.PI/2.5),scale:1},{pos:new i.Pq0(n?-.85:.85,.72,.1),rot:new i.O9p(.1,0,n?-Math.PI/2.2:Math.PI/2.2),scale:1},{pos:new i.Pq0(n?-1.05:1.05,.8,.2),rot:new i.O9p(.2,0,n?-Math.PI/2:Math.PI/2),scale:.9},{pos:new i.Pq0(n?-1.2:1.2,.9,.2),rot:new i.O9p(.2,0,n?-Math.PI/1.8:Math.PI/1.8),scale:.8},{pos:new i.Pq0(n?-1.3:1.3,.75,.2),rot:new i.O9p(.05,0,n?-(-Math.PI/.475):-(Math.PI/.475)),scale:1},{pos:new i.Pq0(n?-1.13:1.13,.445,.17),rot:new i.O9p(.2,0,n?-(-Math.PI/.45):-(Math.PI/.45)),scale:.8}],l=()=>(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.023,.0175,.32,3]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,r.jsxs)("mesh",{position:new i.Pq0(0,.2,0),children:[(0,r.jsx)("sphereGeometry",{args:[.035,4,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.4,metalness:.3})]})]});return(0,r.jsx)("group",{ref:o,rotation:new i.O9p(0,Math.PI,0),position:new i.Pq0(0,-.3,0),children:a.slice(0,Math.min(15,t)).map((e,t)=>(0,r.jsx)("group",{position:e.pos,rotation:e.rot,scale:e.scale,children:l()},"bone-".concat(t)))})}let R=()=>(0,r.jsxs)("group",{rotation:[Math.PI/4,0,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.0175,.0175,.175,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.4,metalness:.3})]}),(0,r.jsxs)("mesh",{position:new i.Pq0(0,.1,0),rotation:new i.O9p(0,0,Math.PI/6),children:[(0,r.jsx)("sphereGeometry",{args:[.03,4,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.5,metalness:.2})]}),(0,r.jsxs)("mesh",{position:new i.Pq0(0,-.1,0),rotation:new i.O9p(0,0,-Math.PI/6),children:[(0,r.jsx)("sphereGeometry",{args:[.0325,4,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#a4a4a4",roughness:.5,metalness:.2})]})]});function T(e){let{parentRef:t}=e,n=(0,s.useRef)([]),i=(0,s.useRef)(null);return(0,f.F)(()=>{if(!t.current||!i.current)return;let e=t.current.position;i.current.position.set(e.x,0,e.z),n.current.forEach((e,t)=>{let n=t/16*Math.PI*2+.001*Date.now(),r=-(.465*Math.cos(n)*1.1),s=.465*Math.sin(n)*1.1,i=.02*Math.sin(.002*Date.now()+t);e.position.set(r,i+.13,s),e.rotation.y=n+Math.PI/3})}),(0,r.jsx)("group",{ref:i,children:Array.from({length:16}).map((e,t)=>(0,r.jsx)("mesh",{ref:e=>{e&&(n.current[t]=e)},children:R()},t))})}let _=()=>{let e=(0,s.useRef)(null),t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(0,r.jsxs)("group",{position:[0,e,0],scale:t,children:[(0,r.jsxs)("group",{rotation:[0,0,-Math.PI/3],children:[(0,r.jsxs)("mesh",{position:[.085,.05,.08],rotation:[.3,Math.PI/2,-.5],children:[(0,r.jsx)("torusGeometry",{args:[.2,.022,8,12,1.1*Math.PI]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("mesh",{position:[0,0,-.1],children:[(0,r.jsx)("sphereGeometry",{args:[.0375,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]}),(0,r.jsxs)("group",{rotation:[0,0,Math.PI/3],children:[(0,r.jsxs)("mesh",{position:[-.085,.05,.08],rotation:[.3,-Math.PI/2,0],children:[(0,r.jsx)("torusGeometry",{args:[.2,.022,8,12,1.1*Math.PI]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("mesh",{position:[-.3,-.15,0],children:[(0,r.jsx)("sphereGeometry",{args:[.02,4,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.06,.05,.075,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})]})};return(0,r.jsx)("group",{ref:e,position:[0,.04,-0],rotation:[.25,Math.PI+Math.PI,0],children:(0,r.jsxs)("group",{children:[(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.04,.04,.9,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),[-.3,-.15,0,.15,.3].map((e,t)=>(0,r.jsxs)("group",{position:[0,e,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.06,.06,.04,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,r.jsxs)("mesh",{position:[0,0,-.125],children:[(0,r.jsx)("boxGeometry",{args:[.0175,.06,.075]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]},t))]}),(0,r.jsxs)("group",{position:[0,0,0],children:[t(.45,.7),t(.3,.8),t(.15,.9),t(0,1),t(-.15,.9),t(-.3,.8),t(-.45,.7)]})]})})},G=e=>{let{movementDirection:t=new i.Pq0}=e,n=(0,s.useRef)(null),[o,a]=(0,s.useState)({x:0,y:0});(0,f.F)(e=>{let{clock:r}=e;if(!n.current)return;let s=r.getElapsedTime(),i=.035*Math.sin(.7*s),o=.175*Math.sin(.5*s),l=1.2*t.length(),c=-(.45*t.z)*l,u=-(.125*t.x)*l,h=Math.min(1.5*l,1),d=i*(1-h)+c*h,m=o*(1-h)+u*h;a({x:d,y:m}),n.current.rotation.x=.1+d,n.current.rotation.y=m});let l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,n=1.8*Math.pow(t/20,5),s=.8*Math.pow((t+1)/15,2.2),i=Math.max(0,1-t/15),a=o.x*i,l=o.y*Math.pow(i,1.2),c=Math.PI,u=Math.atan2(s-n,.4*(1-t/20))+(0===t?c:0)+a*(1-t/15);return(0,r.jsxs)("group",{position:[0,-n+.325,-(.2*t)*(1-t/40-.1)],scale:e,rotation:[-u+.85*a,l*(1-t/2),0],children:[(0,r.jsxs)("mesh",{rotation:[-(Math.PI/4),0,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.04,.055,.125,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,r.jsxs)("group",{rotation:[Math.PI/2,0,Math.PI/2],children:[(0,r.jsxs)("mesh",{position:[0,.08,0],children:[(0,r.jsx)("coneGeometry",{args:[.02,.06,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,r.jsxs)("mesh",{position:[.08,0,0],rotation:[0,0,Math.PI/2],children:[(0,r.jsx)("coneGeometry",{args:[.015,.25,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,r.jsxs)("mesh",{position:[-.085,0,0],rotation:[0,0,-(Math.PI/2)],children:[(0,r.jsx)("coneGeometry",{args:[.015,.2,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]})]}),(0,r.jsxs)("group",{rotation:[Math.PI/24,0,-Math.PI/2],children:[(0,r.jsxs)("mesh",{position:[0,.08,0],children:[(0,r.jsx)("coneGeometry",{args:[.02,.06,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,r.jsxs)("mesh",{position:[.05,0,0],rotation:[0,0,2*Math.PI],children:[(0,r.jsx)("coneGeometry",{args:[.0125,.04,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,r.jsxs)("mesh",{position:[-.085,0,0],rotation:[0,0,Math.PI/2],children:[(0,r.jsx)("coneGeometry",{args:[.015,.04,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]})]}),(0,r.jsxs)("mesh",{position:[0,.025,.06],rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("sphereGeometry",{args:[.025,6,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]})]})};return(0,r.jsx)("group",{ref:n,position:[0,-.7,-.25],rotation:[-.1,0,0],children:[...Array(15)].map((e,t)=>l(1-.04*t,t))})},D=e=>{switch(e){case o.SCYTHE:return"#5EFF00";case o.SWORD:return"#FF9748";case o.SABRES:return"#00AAFF";case o.SPEAR:return"#FF544E";case o.BOW:return"#3A905E";default:return"#00ff44"}},A=e=>{let t=D(e);return(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("boxGeometry",{args:[.1075,.02,.025]}),(0,r.jsx)("meshStandardMaterial",{color:t,transparent:!0,opacity:.6,emissive:t,emissiveIntensity:.55})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.035,9,9]}),(0,r.jsx)("meshStandardMaterial",{color:t,emissive:t,emissiveIntensity:.7,transparent:!0,opacity:.4})]})]})};function z(e){let{parentRef:t,weaponType:n}=e,i=(0,s.useRef)([]),o=(0,s.useRef)(null);return(0,f.F)(e=>{let{clock:n}=e;if(!t.current||!o.current)return;let r=t.current.position;o.current.position.set(r.x,0,r.z),i.current.forEach((e,t)=>{if(!e)return;let r=n.getElapsedTime(),s=t/32*.625,i=t/32*Math.PI*4+2*r,o=.45*(1-.875*s),a=Math.cos(i)*o,l=Math.sin(i)*o;e.position.set(a,s,l),e.rotation.y=i+Math.PI/2,e.rotation.x=Math.PI/6,e.rotation.z=.1*Math.sin(3*r+t);let c=e.children[0];c&&c.material&&(c.material.opacity=Math.max(.1,1-2*s))})}),(0,r.jsxs)("group",{ref:o,children:[(0,r.jsx)("pointLight",{color:D(n),intensity:2,distance:1.3,position:[0,.15,0]}),(0,r.jsx)("pointLight",{color:D(n),intensity:1,distance:2,position:[0,.1,0],decay:2}),Array.from({length:32}).map((e,t)=>(0,r.jsx)("group",{ref:e=>{e&&(i.current[t]=e)},children:A(n)},t))]})}class q{static getInstance(){return q.instance||(q.instance=new q),q.instance}activateStealth(){this.state.isStealthed=!0,this.state.hasShadowStrikeBuff=!0,this.state.lastStealthStartTime=Date.now()}breakStealth(){this.state.isStealthed=!1,this.state.hasShadowStrikeBuff=!1,this.state.lastStealthStartTime=null,window.dispatchEvent(new CustomEvent("stealthBreak"))}isUnitStealthed(){return!!this.state.isStealthed&&!!this.state.lastStealthStartTime&&(!(Date.now()-this.state.lastStealthStartTime>=this.state.duration)||(this.breakStealth(),!1))}hasShadowStrikeBuff(){return!!this.state.lastStealthStartTime&&(Date.now()-this.state.lastStealthStartTime>=this.state.duration?(this.breakStealth(),!1):this.state.hasShadowStrikeBuff)}consumeShadowStrikeBuff(){this.state.hasShadowStrikeBuff=!1}getRemainingDuration(){if(!this.state.lastStealthStartTime)return 0;let e=Date.now()-this.state.lastStealthStartTime;return Math.max(0,this.state.duration-e)}constructor(){this.state={isStealthed:!1,hasShadowStrikeBuff:!1,lastStealthStartTime:null,duration:3500}}}let B=q.getInstance();function L(e){let t=.11>Math.random();return{damage:t?2*e:e,isCritical:t}}let O=Math.PI/2,H={temp1:new i.Pq0,temp2:new i.Pq0,temp3:new i.Pq0};function N(e){let{position:t,direction:n,onComplete:o}=e,a=(0,s.useRef)(null),l=(0,s.useRef)(0),c=(0,s.useRef)(0),u=new i.Q1f("#39ff14"),h=(0,s.useRef)(null),d=(0,s.useRef)(0),m=new i.Pq0(t.x+5*n.x,0,t.z+5*n.z),p=new i.Pq0(-n.z,0,n.x).normalize(),x=m.clone().add(p.clone().multiplyScalar(-1.35)),g=m.clone().add(p.clone().multiplyScalar(1.35)),j=e=>new i.BKk({transparent:!0,depthWrite:!1,blending:i.EZo,vertexShader:"\n      varying vec2 vUv;\n      void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n      }\n    ",fragmentShader:"\n      uniform vec3 uColor;\n      varying vec2 vUv;\n      void main() {\n        float strength = 1.0 - length(vUv - vec2(0.5));\n        vec3 glowColor = mix(uColor, vec3(1.0), 0.3);\n        gl_FragColor = vec4(glowColor, strength * ".concat(e,");\n      }\n    "),uniforms:{uColor:{value:u}}}),y={core:j(.95),inner:j(.8),middle:j(.6),outer:j(.4)},M={beam:new i.Ho_(.1,.1,15,16),innerBeam:new i.Ho_(.175,.175,15,16),middleBeam:new i.Ho_(.25,.25,15,16),outerBeam:new i.Ho_(.375,.375,15,16),torus:new i.O3Y(.5,.08,32,32),particle:new i.Gu$(.04,8,8)};(0,f.F)((e,t)=>{if(!a.current)return;if(c.current<.125){c.current+=t;return}l.current+=t,d.current+=t;let n=Math.min(l.current/1.2,1),r=Math.min(d.current/2.5,1);if(n<1){a.current.position.y=3.5*(1-n);let e=n<.9?1:1-(n-.9)/.2;a.current.scale.set(e,e,e)}else o();h.current&&(h.current.scale.set(Math.min(1.2*r,1),1,Math.min(1.2*r,1)),h.current.children[0].material.opacity=.6*(r>.7?1-(r-.7)/.3:1))});let v=(e,t)=>(0,r.jsxs)("group",{position:[e.x,0,e.z],rotation:[Math.PI/6,Math.atan2(n.x,n.z),0],children:[(0,r.jsx)("mesh",{geometry:M.beam,material:y.core}),(0,r.jsx)("mesh",{geometry:M.innerBeam,material:y.inner}),(0,r.jsx)("mesh",{geometry:M.middleBeam,material:y.middle}),(0,r.jsx)("mesh",{geometry:M.outerBeam,material:y.outer}),[...Array(8)].map((e,t)=>(0,r.jsxs)("mesh",{rotation:[0,t*Math.PI/1.5,0],position:[0,7.45,0],children:[(0,r.jsx)("torusGeometry",{args:[.5,.08,32,32]}),(0,r.jsx)("meshStandardMaterial",{color:u,emissive:u,emissiveIntensity:3,transparent:!0,opacity:.4})]},t)),[...Array(20)].map((e,t)=>(0,r.jsxs)("mesh",{position:[.5*Math.cos(t*Math.PI/4),(t-4)*.5,.5*Math.sin(t*Math.PI/4)],children:[(0,r.jsx)("sphereGeometry",{args:[.04,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:u,emissive:u,emissiveIntensity:12,transparent:!0,opacity:.6})]},t)),(0,r.jsx)("pointLight",{position:[0,0,0],color:u,intensity:20,distance:6}),(0,r.jsx)("pointLight",{position:[0,0,0],color:u,intensity:15,distance:3})]});return(0,r.jsxs)("group",{ref:a,visible:c.current>=.125,children:[v(x,!1),v(m,!0),v(g,!1)]})}let W={cylinder:new i.Ho_(.06,.02,.12,6),sphere:new i.Gu$(.12,12,12),box:new i.iNn(.2,.15,.08),cone:new i.qFE(.03,.3,6)},U={bone:new i._4j({color:"#d6cfc7",roughness:.9,metalness:.1}),spectral:new i._4j({color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.3,metalness:.8,roughness:.1,opacity:.85,transparent:!0,side:i.$EB})};function Q(e){let{position:t,direction:n,onComplete:o,parentRef:a,onHitTarget:l,enemyData:c,onSwingComplete:u}=e,h=(0,s.useRef)(null),d=(0,s.useRef)(0),m=(0,s.useRef)(!1),p=(0,s.useRef)(!1),x=(0,s.useRef)(new Set),g=(0,s.useRef)(new i.kn4),j=(0,s.useRef)(new i.Pq0),y=(0,s.useRef)(new i.Pq0),M=(e,t)=>(0,r.jsx)("mesh",{scale:[t/.06,e/.12,t/.06],geometry:W.cylinder,material:U.bone}),v=e=>(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[1.1*e,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#d6cfc7",roughness:.9,metalness:.1})]}),w=(e,t)=>(0,r.jsxs)("group",{children:[(0,r.jsx)("group",{position:[t/2,0,0],children:M(e,.06)}),(0,r.jsx)("group",{position:[-t/2,0,0],children:M(e,.06)}),(0,r.jsx)("group",{position:[0,e/2,0],children:v(.135)}),(0,r.jsx)("group",{position:[0,-e/2,0],children:v(.155)})]}),P=()=>{let e=new i.ypk;return e.moveTo(0,0),e.lineTo(.25,-.08),e.bezierCurveTo(.4,.3,1.05,.32,1.1,.23),e.lineTo(.84,.47),e.bezierCurveTo(.35,.13,.15,0,.07,.44),e.lineTo(0,0),e},S={steps:1,depth:1e-4,bevelEnabled:!0,bevelThickness:.015,bevelSize:.0175,bevelSegments:1,curveSegments:16},I=e=>(0,r.jsx)("group",{position:[.025*(e-2),-.3,0],rotation:[-Math.PI,Math.PI/2,Math.PI-Math.PI/4+e*Math.PI/10],scale:[.7,.7,.7],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("extrudeGeometry",{args:[P(),S]}),(0,r.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.3,metalness:.8,roughness:.1,opacity:.85,transparent:!0,side:i.$EB})]})}),b=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return(0,r.jsxs)("group",{scale:[e,e,e],children:[(0,r.jsxs)("mesh",{position:[0,0,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.06,.02,.12,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("mesh",{position:[0,.1,.02],rotation:[.05,0,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.025,.025,.12,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("mesh",{position:[0,.2,.04],rotation:[.1,0,0],children:[(0,r.jsx)("coneGeometry",{args:[.03,.15,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.5})]}),[0,Math.PI/4,1*Math.PI/2,Math.PI,3*Math.PI/2,5*Math.PI/4].map((e,t)=>(0,r.jsx)("group",{rotation:[0,e,0],children:(0,r.jsxs)("mesh",{position:[.04,.05,0],children:[(0,r.jsx)("boxGeometry",{args:[.01,.12,.02]}),(0,r.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.5,metalness:.3})]})},t))]})};return(0,f.F)((e,t)=>{if(!h.current||!(null==a?void 0:a.current))return;d.current+=5*t;let r=Math.min(d.current/Math.PI,1);if(r>=1){d.current=0,x.current.clear(),null==u||u(h.current.position.clone(),n),o();return}let s=a.current.position,i=a.current.rotation.y,f=-(2.5*Math.sin(r*Math.PI))+3,M=Math.cos(r*Math.PI)+3.75,v=2*Math.sin(r*Math.PI)+.75;if(g.current.makeRotationY(i),j.current.set(f,0,v),j.current.applyMatrix4(g.current),y.current.set(s.x+j.current.x,s.y+M,s.z+j.current.z),h.current.position.copy(y.current),h.current.rotation.set(Math.cos(r*Math.PI)/(1.5*Math.PI),i+Math.PI/2-r*Math.PI/2,-(Math.PI/3.5*Math.sin(r*Math.PI))),.1>Math.abs(r-.1)&&!m.current){m.current=!0,p.current=!0;let e=function(e,t,n,r){let s=[];for(let i=0;i<n.length;i++){let o=n[i];if(o.health<=0||o.isDying||r.has(o.id)||(H.temp1.subVectors(o.position,e),H.temp1.length()>8.625)||(H.temp2.copy(H.temp1).normalize(),Math.acos(H.temp2.dot(t))>O))continue;let{damage:a,isCritical:l}=L(73);s.push({targetId:o.id,damage:a,isCritical:l,position:o.position.clone()})}return s}(h.current.position,n,c,x.current);e.length>0&&requestAnimationFrame(()=>{e.forEach(e=>{x.current.has(e.targetId)||(x.current.add(e.targetId),null==l||l(e.targetId,e.damage,e.isCritical,e.position,!0))})})}}),(0,r.jsxs)(r.Fragment,{children:[p.current&&(0,r.jsx)(N,{position:t,direction:n,onComplete:()=>{p.current=!1}}),(0,r.jsx)("group",{ref:h,position:t,rotation:[0,Math.atan2(n.x,n.z),Math.PI/3],scale:1.25,children:(0,r.jsxs)("group",{children:[w(1.15,.15),(0,r.jsxs)("group",{position:[-.22,-.85,.21],children:["   ",(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.12,12,12]}),(0,r.jsx)("meshStandardMaterial",{color:"#d6cfc7",roughness:.9,metalness:.1})]}),(0,r.jsxs)("group",{rotation:[-.7,-0,-Math.PI/5],children:[w(.8,.12),(0,r.jsxs)("group",{position:[0,-.5,0],rotation:[0,0,1-Math.PI/4],children:[v(.125),(0,r.jsxs)("group",{position:[0,-.1,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("boxGeometry",{args:[.2,.15,.08]}),(0,r.jsx)("meshStandardMaterial",{color:"#d6cfc7",roughness:.9,metalness:.1})]}),M(.5,.02),(0,r.jsxs)("group",{position:[.025,-.3,0],rotation:[0,0,Math.PI+Math.PI/16],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("coneGeometry",{args:[.03,.3,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#c4bdb6",roughness:.9,metalness:.1})]}),[0,1,2,3,4].map(e=>I(e))]})]})]})]})]}),(0,r.jsx)("group",{position:[0,.7,0],rotation:[-1,1,1],scale:.5,children:[-.03,-.01,0,.01,.03].map((e,t)=>(0,r.jsx)("group",{position:[e,.1,0],rotation:[0,0,(t-2)*Math.PI/5],children:(0,r.jsxs)("group",{position:[0,.3,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.075,.5,.2,4,1,!1,0,2*Math.PI]}),(0,r.jsx)("meshStandardMaterial",{color:"#d6cfc7",roughness:.9,metalness:.1})]}),(0,r.jsxs)("group",{position:[0,.25,0],children:[(0,r.jsx)("group",{position:[0,0,0],rotation:[0,0,0],children:b(2)}),(0,r.jsx)("group",{position:[0,-.05,.15],rotation:[-.1,0,0],children:b(.9)}),(0,r.jsx)("group",{position:[0,-.05,-.15],rotation:[.1,0,0],children:b(.9)}),(0,r.jsx)("group",{position:[0,-.1,.25],rotation:[-.2,0,0],children:b(.7)}),(0,r.jsx)("group",{position:[0,-.1,-.25],rotation:[.2,0,0],children:b(.7)})]})]})},t))})]})})]})}function Y(e){let{initialPosition:t,onComplete:n,type:i}=e,o=(0,s.useRef)(null),a=(0,s.useRef)(1.5*Math.random()+3.65),l=(0,s.useRef)({x:1.5*Math.random(),y:.25*Math.random(),z:1*Math.random()}),c=(0,s.useRef)(Math.min(t.length(),2.7)),u=(0,s.useRef)(Math.atan2(t.z,t.x));return(0,f.F)((e,t)=>{o.current&&("falling"===i?(o.current.position.y-=a.current*t,o.current.position.y<0&&n()):(u.current+=t,o.current.position.x=Math.cos(u.current)*c.current,o.current.position.z=Math.sin(u.current)*c.current,u.current>2*Math.PI&&n()),o.current.rotation.x+=l.current.x,o.current.rotation.y+=l.current.y,o.current.rotation.z+=l.current.z)}),(0,r.jsx)("mesh",{ref:o,position:t,geometry:V.tetrahedron,material:K.shard})}function Z(e){let{onComplete:t}=e,n=(0,s.useRef)(null),i=(0,s.useRef)(0),o=(0,s.useRef)({x:.2*Math.random(),y:2*Math.random(),z:.3*Math.random()});return(0,f.F)((e,r)=>{if(!n.current)return;i.current+=r,n.current.rotation.x+=o.current.x*r,n.current.rotation.y+=o.current.y*r,n.current.rotation.z+=o.current.z*r;let s=.1*Math.sin(2*i.current)+1;n.current.scale.setScalar(s),i.current>6&&t()}),(0,r.jsx)("mesh",{ref:n,geometry:V.torus,material:K.blizzard})}let V={torus:new i.O3Y(.8,.075,8,32),tetrahedron:new i.Zpd(.0725)},K={blizzard:new i._4j({color:"#80ffff",emissive:"#40a0ff",emissiveIntensity:2,transparent:!0,opacity:.3}),shard:new i._4j({color:"#80ffff",emissive:"#40a0ff",emissiveIntensity:1,transparent:!0,opacity:.7})};function $(e){let{onComplete:t,enemyData:n=[],onHitTarget:o,parentRef:a}=e,l=(0,s.useRef)(null),c=(0,s.useRef)(0),u=(0,s.useRef)(0),h=(0,s.useRef)([]),d=(0,s.useRef)([]);return(0,f.F)((e,r)=>{if(!l.current||!(null==a?void 0:a.current))return;let s=a.current.position;if(l.current.position.copy(s),c.current+=r,c.current>=6){t();return}if(l.current.rotation.y+=4*r,.2>Math.random()){let e=Math.random()*Math.PI*2,t=.8*Math.random()/50,n=new i.Pq0(Math.cos(e)*t,2.35+1.7*Math.random(),Math.sin(e)*t);h.current.push({id:Date.now()+Math.random(),position:n,type:"orbital"})}if(Math.random()>.2){let e=Math.random()*Math.PI*2,t=2.5*Math.random(),n=new i.Pq0(Math.cos(e)*t,1.2+3*Math.random(),Math.sin(e)*t);h.current.push({id:Date.now()+Math.random(),position:n,type:"falling"})}.1>Math.random()&&d.current.push({id:Date.now()+Math.random()});let m=Date.now();m-u.current>=1e3&&(u.current=m,n&&o&&(function(e,t){let n=[];return t.forEach(t=>{if(!(t.health<=0)&&5.25>=t.position.distanceTo(e)){let{damage:e,isCritical:r}=L(37);n.push({targetId:t.id,damage:e,isCritical:r,position:t.position.clone()})}}),n})(s,n).forEach(e=>{o(e.targetId,e.damage,e.isCritical,e.position,!0)}))}),(0,r.jsxs)("group",{ref:l,children:[h.current.map(e=>(0,r.jsx)(Y,{initialPosition:e.position,type:e.type,onComplete:()=>{h.current=h.current.filter(t=>t.id!==e.id)}},e.id)),d.current.map(e=>(0,r.jsx)(Z,{onComplete:()=>{d.current=d.current.filter(t=>t.id!==e.id)}},e.id))]})}let X=e=>{let{parentRef:t}=e,[n,r]=(0,s.useState)(!1);return{isActive:n,activateFirebeam:(0,s.useCallback)(()=>{if(!t.current)return;let e=t.current.position.clone();e.y+=1;let n=new i.Pq0(0,0,1).applyQuaternion(t.current.quaternion);return r(!0),{position:e,direction:n,onComplete:()=>r(!1),damage:43}},[t]),deactivateFirebeam:(0,s.useCallback)(()=>{r(!1)},[])}};function J(e){let{parentRef:t,charges:n,orbitRadius:a=.55,orbitSpeed:l=.8,particleSize:c=.08,weaponType:u}=e,h=n.length,d=(0,s.useRef)([]),m=(()=>{switch(u){case o.SCYTHE:return"#00FF37";case o.SWORD:return"#FF831D";case o.SABRES:return"#0091FF";case o.SPEAR:return"#FF544E";case o.BOW:return"#C18C4B";default:return"#00ff44"}})();return(0,f.F)(()=>{t.current&&d.current.forEach((e,t)=>{let n=t/h*Math.PI*2+.001*Date.now()*l,r=Math.cos(n)*a,s=Math.sin(n)*a,i=.05*Math.sin(.002*Date.now()+t);e.position.set(r,i,s)})}),(0,r.jsx)(r.Fragment,{children:Array.from({length:h}).map((e,t)=>{let s=n[t];return(0,r.jsxs)("group",{ref:e=>{e&&(d.current[t]=e)},children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[c,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:(null==s?void 0:s.available)?m:"#333333",emissive:(null==s?void 0:s.available)?m:"#333333",emissiveIntensity:(null==s?void 0:s.available)?1.25:.4,transparent:!0,opacity:(null==s?void 0:s.available)?.8:.4})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[1.225*c,32,32]}),(0,r.jsx)("meshStandardMaterial",{color:(null==s?void 0:s.available)?m:"#333333",emissive:(null==s?void 0:s.available)?m:"#333333",emissiveIntensity:(null==s?void 0:s.available)?.5:.1,transparent:!0,opacity:(null==s?void 0:s.available)?.4:.15,depthWrite:!1,side:i.$EB,blending:i.EZo})]})]},t)})})}let ee=e=>{let{parentRef:t,onHit:n,enemyData:r,setActiveEffects:o,charges:a,setCharges:l,setDamageNumbers:c,nextDamageNumberId:u}=e,h=(0,s.useRef)(0),d=(0,s.useRef)(null),m=(0,s.useRef)(0),{isActive:p,activateFirebeam:f,deactivateFirebeam:x}=X({onHit:n,parentRef:t}),g=(0,s.useMemo)(()=>new i.Pq0,[]),j=(0,s.useMemo)(()=>new i.Pq0,[]),y=(0,s.useMemo)(()=>new i.Pq0,[]),M=(0,s.useMemo)(()=>new i.Pq0,[]),v=(0,s.useMemo)(()=>new i.Pq0,[]),w=(0,s.useCallback)(()=>{null!==d.current&&(o(e=>e.filter(e=>e.id!==d.current)),d.current=null),x()},[x,o]),P=(0,s.useCallback)(()=>{let e=a.findIndex(e=>e.available);return -1!==e&&(l(t=>t.map((t,n)=>n===e?{...t,available:!1,cooldownStartTime:Date.now()}:t)),setTimeout(()=>{l(t=>t.map((t,n)=>n===e?{...t,available:!0,cooldownStartTime:null}:t))},8250),!0)},[a,l]),S=(0,s.useCallback)(()=>{let e=Date.now();if(e-m.current<725||!P())return;let t=f();if(!t)return;let{position:s,direction:i,damage:a}=t,l=h.current++;return d.current=l,m.current=e,o(e=>[...e,{id:l,type:"firebeam",position:s,direction:i}]),r.forEach(e=>{if(e.health<=0)return;g.set(s.x,0,s.z),j.set(e.position.x,0,e.position.z),y.copy(i).setY(0).normalize(),M.copy(j).sub(g);let t=M.dot(y);t<=0||t>20||(v.copy(g).add(y.multiplyScalar(t)),1.375>j.distanceTo(v)&&(n(e.id,a),c(t=>[...t,{id:u.current++,damage:a,position:e.position.clone(),isCritical:!1,isFirebeam:!0}])))}),setTimeout(w,6e3)},[u,g,j,y,M,v,c,f,r,n,o,P,w]);return(0,s.useEffect)(()=>()=>{w()},[w]),{isActive:p,startFirebeam:S,stopFirebeam:w}},et=e=>{let{beamRef:t}=e,n=(0,s.useRef)(0),r=(0,s.useRef)(!0),i=(0,s.useRef)(!1),o=(0,s.useRef)();return(0,s.useEffect)(()=>{let e=t.current;return()=>{r.current=!1,e&&(i.current=!0,o.current=setTimeout(()=>{e&&(e.scale.z=0)},2500))}},[t]),(0,f.F)((e,r)=>{t.current&&(i.current?!(Math.random()>.25)&&(n.current-=r/2500,n.current>0&&(t.current.scale.z=n.current)):n.current<1&&(n.current+=r/0,t.current.scale.z=Math.min(n.current,1)))}),{reset:(0,s.useCallback)(()=>{n.current=0,r.current=!1,i.current=!0,o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{t.current&&(t.current.scale.z=0),i.current=!1},2500)},[t])}};function en(e){let{position:t,direction:n,onComplete:i}=e,o=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=o.current;return()=>{e&&(e.scale.z=0),i()}},[i]);let{reset:a}=et({beamRef:o,position:t,direction:n});return(0,s.useEffect)(()=>()=>{a()},[a]),(0,r.jsxs)("group",{ref:o,position:t.toArray(),rotation:[0,Math.atan2(n.x,n.z),0],children:[(0,r.jsxs)("group",{position:[0,-1.1,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.65,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:2.5,transparent:!0,opacity:.65})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.825,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:.7,transparent:!0,opacity:.65})]}),[void 0,void 0,void 0].map((e,t)=>(0,r.jsxs)("mesh",{rotation:[Math.PI/2,0,t*Math.PI/3],children:[(0,r.jsx)("torusGeometry",{args:[.875,.075,8,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:.8,transparent:!0,opacity:.9})]},"ring-".concat(t))),(0,r.jsx)("pointLight",{color:"#58FCEC",intensity:20,distance:3})]}),(0,r.jsxs)("group",{position:[0,-1.1,10.7],children:[(0,r.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.1,.1,20,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:15,transparent:!0,opacity:.95})]}),(0,r.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.25,.275,20,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:5,transparent:!0,opacity:.7})]}),(0,r.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.3,.375,20,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:1,transparent:!0,opacity:.6})]}),(0,r.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.35,.375,20,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:.75,transparent:!0,opacity:.6})]}),[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,r.jsxs)("mesh",{rotation:[-Math.PI/4,0,-(t*Math.PI/1.5)],position:[0,0,10],children:[(0,r.jsx)("torusGeometry",{args:[.35,.05,8,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:1,transparent:!0,opacity:.3})]},t)),[...Array(24)].map((e,t)=>(0,r.jsxs)("mesh",{position:[(Math.random()-.5)*1.75,(Math.random()-.5)*1.75,10*Math.random()],rotation:[Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2],children:[(0,r.jsx)("boxGeometry",{args:[.05,.05,.1]})," ",(0,r.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:2,transparent:!0,opacity:.75})]},"spark-".concat(t))),(0,r.jsx)("pointLight",{position:[0,0,18.5],color:"#00E5FF",intensity:12,distance:4})]})]})}let er=s.memo(e=>{let{position:t,onComplete:n}=e,[i,o]=(0,s.useState)(0),a=(0,s.useCallback)((e,t)=>{o(e=>{let r=e+t;return r>=1.5&&n(),r})},[1.5,n]);(0,f.F)(a);let l=i/1.5,c=Math.sin(l*Math.PI),u=1+2*l,h=(0,s.useMemo)(()=>({color:"#60FF38",emissive:"#60FF38",emissiveIntensity:1.5,transparent:!0}),[]),d=(0,s.useMemo)(()=>({color:"#60FF38",emissive:"#60FF38",emissiveIntensity:2.5,transparent:!0}),[]),m=(0,s.useMemo)(()=>[void 0,void 0,void 0],[]),p=(0,s.useMemo)(()=>[...Array(12)],[]);return(0,r.jsxs)("group",{position:t.toArray(),children:[m.map((e,t)=>(0,r.jsxs)("mesh",{position:[0,2*l+.5*t,0],rotation:[Math.PI/2,0,2*i],children:[(0,r.jsx)("torusGeometry",{args:[.8-.2*t,.05,16,32]}),(0,r.jsx)("meshStandardMaterial",{...h,opacity:c*(1-.2*t)})]},"ring-".concat(t))),(0,r.jsxs)("mesh",{scale:[u,u,u],children:[(0,r.jsx)("sphereGeometry",{args:[.5,32,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#60FF38",emissive:"#60FF38",emissiveIntensity:2,transparent:!0,opacity:.3*c})]}),p.map((e,t)=>{let n=t/12*Math.PI*2,s=.75+l;return(0,r.jsxs)("mesh",{position:[Math.cos(n+2*i)*s/1.1,2*l+.5*Math.sin(3*i+t),Math.sin(n+2*i)*s/1.1],children:[(0,r.jsx)("sphereGeometry",{args:[.095,8,8]}),(0,r.jsx)("meshStandardMaterial",{...d,opacity:.8*c})]},"particle-".concat(t))}),(0,r.jsx)("pointLight",{color:"#60FF38",intensity:2*c,distance:5,decay:2})]})});er.displayName="HealingEffect";let es=(0,s.forwardRef)((e,t)=>{let{parentRef:n,onHealthChange:a,charges:c,setCharges:u,setDamageNumbers:h,nextDamageNumberId:d}=e,[m,p]=(0,s.useState)(!1),{castReanimate:f}=function(e){let{charges:t,setCharges:n,onHealthChange:r,parentRef:a,setDamageNumbers:c,nextDamageNumberId:u}=e,h=(0,s.useRef)(0),d=(0,s.useMemo)(()=>7,[]),m=(0,s.useMemo)(()=>1e3*l[o.SCYTHE].passive.cooldown,[]),p=(0,s.useMemo)(()=>new i.Pq0(0,2,0),[]);return{castReanimate:(0,s.useCallback)(()=>{let e=Date.now();if(e-h.current<m)return!1;let s=t.findIndex(e=>e.available);if(-1===s)return!1;h.current=e,n(t=>{let n=[...t];return n[s]={...n[s],available:!1,cooldownStartTime:e},n});let i=null==a?void 0:a.current;return i&&c(e=>[...e,{id:u.current++,damage:d,position:i.position.clone().add(p),isCritical:!1,isHealing:!0}]),r(d),setTimeout(()=>{n(e=>{let t=[...e];return t[s]={...t[s],available:!0,cooldownStartTime:null},t})},8250),!0},[t,n,r,a,c,u,m,d,p])}}((0,s.useMemo)(()=>({parentRef:n,charges:c,setCharges:u,onHealthChange:a,setDamageNumbers:h,nextDamageNumberId:d}),[n,c,u,a,h,d])),x=(0,s.useCallback)(()=>{let e=f();return e&&p(!0),e},[f]);return(0,s.useImperativeHandle)(t,()=>({castReanimate:x})),m&&n.current?(0,r.jsx)(er,{position:n.current.position.clone().add(new i.Pq0(0,0,0)),onComplete:()=>p(!1)}):null});es.displayName="Reanimate";let ei=e=>{let{effectRef:t,parentRef:n}=e,r=(0,s.useRef)(0),o=(0,s.useRef)(!0);return(0,s.useEffect)(()=>{let e=t.current;return()=>{o.current=!1,e&&e.scale.set(0,0,0)}},[t]),(0,f.F)((e,s)=>{if(!t.current||!o.current||!n.current)return;r.current+=s;let a=r.current/.2;if(a<=1){let e=n.current.quaternion,r=new i.Pq0(0,0,2);r.applyQuaternion(e),t.current.position.copy(n.current.position).add(r).setY(.1);let s=new i.PTz().setFromAxisAngle(new i.Pq0(-1,0,0),-Math.PI/2);t.current.quaternion.copy(e).multiply(s);let o=1.5*Math.sin(a*Math.PI);t.current.scale.set(o,o,.5*o),t.current.traverse(e=>{let t=e.material;(null==t?void 0:t.opacity)!==void 0&&(t.opacity=Math.sin(a*Math.PI))})}else o.current=!1,t.current&&t.current.scale.set(0,0,0)}),{reset:()=>{r.current=0,o.current=!0,t.current&&t.current.scale.set(0,0,0)}}};function eo(e){let{position:t,direction:n,onComplete:o,parentRef:a}=e,l=(0,s.useRef)(null),c=(0,s.useMemo)(()=>({mainArc:new i.O3Y(3,.8,8,32,Math.PI),innerGlow:new i.O3Y(3,.4,16,32,Math.PI),outerGlow:new i.O3Y(2,.9,16,32,Math.PI),particle:new i.Gu$(.15,8,8)}),[]),u=(0,s.useMemo)(()=>({mainFlame:new i._4j({color:"#FF9748",emissive:"#FF6F00",emissiveIntensity:2,transparent:!0,opacity:.9}),innerGlow:new i._4j({color:"#FF9748",emissive:"#FF6F00",emissiveIntensity:1,transparent:!0,opacity:.7}),outerGlow:new i._4j({color:"#FF9748",emissive:"#FF6F00",emissiveIntensity:1.3,transparent:!0,opacity:.5}),particle:new i._4j({color:"#FF9748",emissive:"#FF6F00",emissiveIntensity:1.5,transparent:!0,opacity:.6})}),[]),h=(0,s.useMemo)(()=>Array(12).fill(0).map((e,t)=>({position:new i.Pq0(1.5*Math.cos(t*Math.PI/6),1.5*Math.sin(t*Math.PI/6),0)})),[]),{reset:d}=ei({effectRef:l,position:t,direction:n,parentRef:a});return(0,s.useEffect)(()=>()=>{d(),o()},[d,o]),(0,r.jsx)("group",{ref:l,position:t.toArray(),rotation:[Math.PI/2,Math.atan2(n.x,n.z),0],children:(0,r.jsxs)("group",{position:[0,0,0],children:[(0,r.jsx)("mesh",{geometry:c.mainArc,material:u.mainFlame}),(0,r.jsx)("mesh",{geometry:c.innerGlow,material:u.innerGlow}),(0,r.jsx)("mesh",{geometry:c.outerGlow,material:u.outerGlow}),h.map((e,t)=>(0,r.jsx)("mesh",{position:e.position,geometry:c.particle,material:u.particle},t)),(0,r.jsx)("pointLight",{color:"#FF9748",intensity:15,distance:8}),(0,r.jsx)("pointLight",{color:"#FF6F00",intensity:10,distance:12})]})})}let ea=e=>{let{currentHealth:t,maxHealth:n,onHealthChange:r,setDamageNumbers:i,nextDamageNumberId:o,healAmount:a=10}=e;return{processHealing:(0,s.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,s=arguments.length>1?arguments[1]:void 0,l=Math.min(e,n-t);l>0&&(r(l),i&&o&&i(e=>[...e,{id:o.current++,damage:l,position:s,isCritical:!1,isHealing:!0}]))},[t,n,r,i,o,a])}},el=e=>{let{parentRef:t,onHit:n,charges:r,setCharges:o,enemyData:a,onHealthChange:l,setDamageNumbers:c,nextDamageNumberId:u,currentHealth:h,maxHealth:d}=e,[m,p]=(0,s.useState)(!1),{processHealing:f}=ea({currentHealth:h,maxHealth:d,onHealthChange:l,setDamageNumbers:c,nextDamageNumberId:u,healAmount:5}),x=(0,s.useCallback)(()=>{let e=r.filter(e=>e.available);if(e.length<2)return console.log("Not enough charges available for Oathstrike"),!1;o(t=>t.map((t,n)=>n===e[0].id-1||n===e[1].id-1?{...t,available:!1,cooldownStartTime:Date.now()}:t));for(let t=0;t<2;t++)e[t].id&&setTimeout(()=>{o(n=>n.map((n,r)=>r===e[t].id-1?{...n,available:!0,cooldownStartTime:null}:n))},8250);return!0},[r,o]);return{isActive:m,activateOathstrike:(0,s.useCallback)(()=>{if(!t.current||!x())return null;let e=t.current.position.clone();e.y+=1;let r=new i.Pq0(0,0,1).applyQuaternion(t.current.quaternion);p(!0);let s=r.clone(),o=.6*Math.PI,l=!1;return a.forEach(t=>{if(t.health<=0)return;let r=t.position.clone().sub(e);if(6>=r.length()&&Math.abs(s.angleTo(r))<=o/2){l=!0;let{damage:e,isCritical:r}=L(47);n(t.id,e),c(n=>[...n,{id:u.current++,damage:e,position:t.position.clone(),isCritical:r,isOathstrike:!0}])}}),l&&f(5,e),{position:e,direction:r,onComplete:()=>{p(!1)}}},[u,c,t,x,a,n,f])}},ec=e=>{let{onHealthChange:t,parentRef:n,setDamageNumbers:r,nextDamageNumberId:o,currentHealth:a,maxHealth:l}=e,[c,u]=(0,s.useState)(!1),{processHealing:h}=ea({currentHealth:a,maxHealth:l,onHealthChange:t,setDamageNumbers:r,nextDamageNumberId:o,healAmount:3});return{processHealingChance:(0,s.useCallback)(()=>{n.current&&.25>Math.random()&&(h(3,n.current.position.clone().add(new i.Pq0(0,2,0))),u(!0))},[h,n,.25,3]),showHealingEffect:c,setShowHealingEffect:u}},eu=e=>{let{position:t,onComplete:n}=e,o=(0,s.useRef)(0),a=(0,s.useMemo)(()=>({ring:new i.O3Y(.8,.05,16,32),sphere:new i.Gu$(.5,32,32),particle:new i.Gu$(.1,8,8)}),[]),l=(0,s.useMemo)(()=>({ring:new i._4j({color:"#ffaa00",emissive:"#ff8800",emissiveIntensity:2,transparent:!0}),glow:new i._4j({color:"#ffaa00",emissive:"#ff8800",emissiveIntensity:3,transparent:!0}),particle:new i._4j({color:"#ffaa00",emissive:"#ff8800",emissiveIntensity:2,transparent:!0})}),[]),c=(0,s.useMemo)(()=>Array(12).fill(0).map((e,t)=>t/12*Math.PI*2),[]);(0,f.F)((e,t)=>{if(o.current+=t,o.current>=1.5){n();return}let r=Math.sin(o.current/1.5*Math.PI);l.ring.opacity=r,l.glow.opacity=.3*r,l.particle.opacity=.8*r});let u=o.current/1.5,h=1+2*u;return(0,r.jsxs)("group",{position:t.toArray(),children:[[0,1,2].map(e=>(0,r.jsx)("mesh",{position:[0,2*u+.5*e,0],rotation:[Math.PI/2,0,2*o.current],geometry:a.ring,material:l.ring,scale:[1-.2*e,1-.2*e,1]},"ring-".concat(e))),(0,r.jsx)("mesh",{geometry:a.sphere,material:l.glow,scale:[h,h,h]}),c.map((e,t)=>{let n=1+u;return(0,r.jsx)("mesh",{position:[Math.cos(e+2*o.current)*n,2*u+.5*Math.sin(3*o.current+t),Math.sin(e+2*o.current)*n],geometry:a.particle,material:l.particle},"particle-".concat(t))}),(0,r.jsx)("pointLight",{color:"#ff8800",intensity:4*Math.sin(u*Math.PI),distance:5,decay:2})]})},eh=(0,s.forwardRef)((e,t)=>{let{parentRef:n,onHealthChange:o,setDamageNumbers:a,nextDamageNumberId:l,currentHealth:c,maxHealth:u}=e,h=(0,s.useRef)(null),{processHealingChance:d,showHealingEffect:m,setShowHealingEffect:p}=ec({onHealthChange:o,parentRef:n,setDamageNumbers:a,nextDamageNumberId:l,currentHealth:c,maxHealth:u});return(0,s.useImperativeHandle)(t,()=>({processHealingChance:d})),(0,f.F)(()=>{if(h.current&&n.current){let e=n.current.position;h.current.position.set(e.x,.015,e.z),h.current.rotation.y+=.0012}}),(0,r.jsxs)(r.Fragment,{children:[m&&n.current&&(0,r.jsx)(eu,{position:n.current.position.clone().add(new i.Pq0(0,0,0)),onComplete:()=>p(!1)}),(0,r.jsxs)("group",{ref:h,children:[(0,r.jsx)("group",{rotation:[0,0,0],position:[0,.005,0],children:[0,Math.PI/2,Math.PI,1.5*Math.PI].map((e,t)=>(0,r.jsxs)("mesh",{rotation:[-Math.PI/2,0,e+8e-4*Date.now()],children:[(0,r.jsx)("ringGeometry",{args:[.85,1,3]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffaa00",emissive:"#ff8800",emissiveIntensity:2,transparent:!0,opacity:.6,depthWrite:!1})]},t))}),(0,r.jsxs)("mesh",{position:[0,.1,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.925,.5,-.175,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff8800",emissive:"#ff6600",emissiveIntensity:1,transparent:!0,opacity:.55,depthWrite:!1})]})]})]})});eh.displayName="CrusaderAura";let ed=()=>(0,r.jsxs)("group",{rotation:[Math.PI/4,0,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.12,.12,1.8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.4,metalness:.3})]}),(0,r.jsxs)("mesh",{position:new i.Pq0(0,.5,0),rotation:new i.O9p(0,0,Math.PI/6),children:[(0,r.jsx)("sphereGeometry",{args:[.12,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.5,metalness:.2})]}),(0,r.jsxs)("mesh",{position:new i.Pq0(0,.15,0),rotation:new i.O9p(0,0,-Math.PI/6),children:[(0,r.jsx)("sphereGeometry",{args:[.12,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#a4a4a4",roughness:.5,metalness:.2})]})]});function em(e){let{parentRef:t}=e,n=(0,s.useRef)([]),i=(0,s.useRef)(null);return(0,f.F)(()=>{if(!t.current||!i.current)return;let e=t.current.position;i.current.position.set(e.x,.4,e.z),n.current.forEach((e,t)=>{let n=t/20*Math.PI*2+.001*Date.now(),r=-(1.75*Math.cos(n)),s=1.75*Math.sin(n),i=.15*Math.sin(.002*Date.now()+t);e.position.set(r,i-.3,s),e.rotation.y=n+Math.PI/3})}),(0,r.jsx)("group",{ref:i,children:Array.from({length:20}).map((e,t)=>(0,r.jsx)("mesh",{ref:e=>{e&&(n.current[t]=e)},children:ed()},t))})}function ep(e){let{parentRef:t}=e,n=(0,s.useRef)(null);return(0,f.F)(()=>{if(n.current&&t.current){let e=t.current.position;n.current.position.set(e.x,.015,e.z),n.current.rotation.y+=96e-5}}),(0,r.jsxs)("group",{ref:n,scale:1.45,children:[(0,r.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],position:[0,.01,0],children:[(0,r.jsx)("ringGeometry",{args:[2.4,2.8,128]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ff88",emissive:"#00ff88",emissiveIntensity:1.5,transparent:!0,opacity:.3,depthWrite:!1})]}),(0,r.jsx)("group",{position:[0,.02,0],children:[...Array(8)].map((e,t)=>(0,r.jsxs)("mesh",{rotation:[-Math.PI/2,0,t/8*Math.PI*2+.001*Date.now()],position:[0,0,0],children:[(0,r.jsx)("planeGeometry",{args:[.4,2.6]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ff88",emissive:"#00ff88",emissiveIntensity:2,transparent:!0,opacity:.4+.2*Math.sin(.003*Date.now()+t),depthWrite:!1})]},t))}),(0,r.jsx)("group",{position:[0,.03,0],children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>{let n=t/5*Math.PI*2;return(0,r.jsxs)("mesh",{position:[1.2*Math.cos(n+.001*Date.now()),0,1.2*Math.sin(n+.001*Date.now())],rotation:[-Math.PI/2,0,n+Math.PI/2],children:[(0,r.jsx)("planeGeometry",{args:[.6,.6]}),(0,r.jsx)("meshStandardMaterial",{color:"#00cc66",emissive:"#00ff88",emissiveIntensity:2,transparent:!0,opacity:.3+.2*Math.sin(.002*Date.now()+.5*t),depthWrite:!1})]},t)})}),(0,r.jsx)("group",{position:[0,.01,0],children:[...Array(12)].map((e,t)=>{let n=t/12*Math.PI*2,s=1.8+.2*Math.sin(.002*Date.now()+t);return(0,r.jsxs)("mesh",{position:[Math.cos(n)*s,0,Math.sin(n)*s],rotation:[-Math.PI/2,0,n+.0015*Date.now()],children:[(0,r.jsx)("planeGeometry",{args:[.2,.8]}),(0,r.jsx)("meshStandardMaterial",{color:"#004433",emissive:"#00ff88",emissiveIntensity:3,transparent:!0,opacity:.2+.1*Math.sin(.004*Date.now()+t),depthWrite:!1})]},t)})}),(0,r.jsxs)("mesh",{position:[0,.02,0],rotation:[-Math.PI/2,0,0],children:[(0,r.jsx)("ringGeometry",{args:[.2,1,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#002211",emissive:"#00ff88",emissiveIntensity:1.5,transparent:!0,opacity:.4,depthWrite:!1})]}),(0,r.jsxs)("mesh",{position:[0,.01,0],rotation:[-Math.PI/2,0,0],children:[(0,r.jsx)("ringGeometry",{args:[2.4,2.55,128,1]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ff88",emissive:"#00ff88",emissiveIntensity:.3,transparent:!0,opacity:.6,depthWrite:!1})]})]})}let ef={bone:new i._4j({color:"#D2B48C",roughness:1,metalness:0}),spikes:new i._4j({color:"#BC8F8F",roughness:1,metalness:0}),runes:new i._4j({color:"#00ff88",emissive:"#00ff88",transparent:!0,opacity:.9}),crown:new i._4j({color:"#DEB887",roughness:1,metalness:0})},ex={tower:new i.Ho_(.6,.8,4,8),spike:new i.qFE(.2,.8,4),rune:new i.bdM(.2,.2),crown:new i.qFE(.15,1.2,4),eye:new i.Gu$(.3,32,32),base:new i.Ho_(1,1.2,.6,8),lightning:new i.Gu$(.1,16,16)};function eg(e){let{isAttacking:t}=e,n=(0,s.useRef)(null);return(0,r.jsxs)("group",{ref:n,scale:.475,position:[0,-.75,0],children:[(0,r.jsxs)("mesh",{position:[0,2,0],children:[(0,r.jsx)("primitive",{object:ex.tower}),(0,r.jsx)("primitive",{object:ef.bone})]}),[...Array(12)].map((e,t)=>(0,r.jsx)("group",{rotation:[0,-Math.PI*t/12,.25*Math.PI],position:[0,2.5,0],children:(0,r.jsxs)("mesh",{position:[.7,.5*Math.sin(3*t),0],rotation:[Math.PI/3,0,-(.25*Math.PI)],children:[(0,r.jsx)("primitive",{object:ex.spike}),(0,r.jsx)("primitive",{object:ef.spikes})]})},t)),[.5,1.5,2.5,3.5].map((e,n)=>(0,r.jsxs)("group",{position:[0,e,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("torusGeometry",{args:[.7,.05,16,32]}),(0,r.jsx)("primitive",{object:ef.runes,emissiveIntensity:t?3:1})]}),[void 0,void 0,void 0,void 0].map((e,n)=>(0,r.jsxs)("mesh",{position:[.7*Math.cos(2*Math.PI*n/4),.1*Math.sin(.001*Date.now()+n),.7*Math.sin(2*Math.PI*n/4)],children:[(0,r.jsx)("primitive",{object:ex.rune}),(0,r.jsx)("primitive",{object:ef.runes,emissiveIntensity:t?4:2,opacity:.8,side:2})]},n))]},n)),(0,r.jsxs)("group",{position:[0,4,0],children:[[...Array(8)].map((e,t)=>(0,r.jsxs)("mesh",{position:[.5*Math.cos(2*Math.PI*t/8),.3,.5*Math.sin(2*Math.PI*t/8)],rotation:[.2*Math.random(),2*Math.PI*t/8,.15*Math.PI],children:[(0,r.jsx)("primitive",{object:ex.crown}),(0,r.jsx)("primitive",{object:ef.crown})]},t)),(0,r.jsxs)("mesh",{position:[0,.5,0],children:[(0,r.jsx)("primitive",{object:ex.eye}),(0,r.jsx)("primitive",{object:ef.runes,emissiveIntensity:t?5:3})]})]}),(0,r.jsxs)("mesh",{position:[0,.3,0],children:[(0,r.jsx)("primitive",{object:ex.base}),(0,r.jsx)("primitive",{object:ef.bone})]}),t&&[void 0,void 0,void 0,void 0].map((e,t)=>(0,r.jsxs)("mesh",{position:[1*Math.cos(2*Math.PI*t/4),2,1*Math.sin(2*Math.PI*t/4)],children:[(0,r.jsx)("primitive",{object:ex.lightning}),(0,r.jsx)("primitive",{object:ef.runes,emissiveIntensity:5,opacity:.8})]},t)),(0,r.jsx)(em,{parentRef:n}),(0,r.jsx)(ep,{parentRef:n})]})}function ej(e){let{position:t,enemyData:n,onDamage:o,onComplete:a,onStartCooldown:l,setActiveEffects:c,activeEffects:u,setDamageNumbers:h,nextDamageNumberId:d}=e,m=(0,s.useRef)(null),[p,x]=(0,s.useState)(null),g=(0,s.useRef)({lastAttackTime:0,startTime:Date.now(),hasTriggeredCleanup:!1,mountId:Date.now(),lastTargetSwitchTime:Date.now(),ATTACK_COOLDOWN:750,RANGE:35,DURATION:12e3,DAMAGE:53,EFFECT_DURATION:225,TARGET_SWITCH_INTERVAL:3e3}).current,j=(0,s.useCallback)((e,t)=>{let n=e.x-t.x,r=e.z-t.z;return Math.sqrt(n*n+r*r)},[]),y=(0,s.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!m.current)return null;let t=m.current.position,r=g.RANGE,s=null;for(let i=0;i<n.length;i++){let o=n[i];if(o.health<=0||o.isDying||o.deathStartTime||!o.position||e&&p&&o.id===p.id)continue;let a=j({x:o.position.x,z:o.position.z},{x:t.x,z:t.z});a<=r&&(r=a,s=o)}return s},[n,j,p,g.RANGE]),M=(0,s.useCallback)(e=>{var t;if(!e||e.health<=0||e.isDying||e.deathStartTime||!e.position)return;let r=e.id.startsWith("boss-")||e.id.startsWith("enemy-boss-")?17:g.DAMAGE,s=e.position.clone().setY(1.5);if(!n.find(t=>t.id===e.id&&t.health>0))return;o(e.id,r,s,!0);let a=Date.now(),l=new i.Pq0;null===(t=m.current)||void 0===t||t.getWorldPosition(l);let u={damageNumber:{id:d.current++,damage:r,position:s.clone(),isCritical:!1,isSummon:!0},effect:{id:a,type:"summonExplosion",position:s.clone().sub(l),direction:new i.Pq0,duration:g.EFFECT_DURATION/1e3,startTime:Date.now(),summonId:g.mountId,targetId:e.id}};h(e=>[...e,u.damageNumber]),c(e=>[...e.filter(e=>"summonExplosion"!==e.type||e.startTime&&Date.now()-e.startTime<g.EFFECT_DURATION),u.effect]),requestAnimationFrame(()=>{Date.now()-u.effect.startTime>=g.EFFECT_DURATION+150&&c(e=>e.filter(e=>e.id!==a))})},[g,o,c,h,d,n]);return(0,f.F)(()=>{let e=Date.now();if(e-g.startTime>g.DURATION){g.hasTriggeredCleanup||(g.hasTriggeredCleanup=!0,a(),l());return}if(!(e-g.lastAttackTime<g.ATTACK_COOLDOWN)){if(e-g.lastTargetSwitchTime>=g.TARGET_SWITCH_INTERVAL){let t=y(!0);t&&x(t),g.lastTargetSwitchTime=e}if(!(null==p?void 0:p.health)||p.health<=0||p.isDying){x(y());return}M(p),g.lastAttackTime=e}}),(0,s.useEffect)(()=>{let e=g.mountId;return()=>{c(t=>t.filter(t=>"summonExplosion"!==t.type||t.summonId!==e))}},[c,g.mountId]),(0,r.jsxs)("group",{ref:m,position:t.toArray(),children:[(0,r.jsx)(eg,{isAttacking:!!p}),u.map(e=>{if("summonExplosion"===e.type){let t=e.startTime?(Date.now()-e.startTime)/1e3:0,s=Math.max(0,1-t/(e.duration||.2)),o=e.targetId?n.find(t=>t.id===e.targetId):null;if(o&&m.current){let n=new i.Pq0;m.current.getWorldPosition(n);let a=o.position.clone().setY(1.5).sub(n);return(0,r.jsxs)("group",{position:a.toArray(),children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.35*(1+2*t),32,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#8800ff",emissive:"#9933ff",emissiveIntensity:.5*s,transparent:!0,opacity:.8*s,depthWrite:!1,blending:i.EZo})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.25*(1+3*t),24,24]}),(0,r.jsx)("meshStandardMaterial",{color:"#aa66ff",emissive:"#ffffff",emissiveIntensity:.5*s,transparent:!0,opacity:.9*s,depthWrite:!1,blending:i.EZo})]}),[.45,.65,.85].map((e,n)=>(0,r.jsxs)("mesh",{rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,r.jsx)("torusGeometry",{args:[e*(1+3*t),.045,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#8800ff",emissive:"#9933ff",emissiveIntensity:1*s,transparent:!0,opacity:.6*s*(1-.2*n),depthWrite:!1,blending:i.EZo})]},n)),[void 0,void 0,void 0,void 0].map((e,n)=>{let o=n/4*Math.PI*2,a=.5*(1+2*t);return(0,r.jsxs)("mesh",{position:[Math.sin(o)*a,Math.cos(o)*a,0],children:[(0,r.jsx)("sphereGeometry",{args:[.05,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#aa66ff",emissive:"#ffffff",emissiveIntensity:2*s,transparent:!0,opacity:.8*s,depthWrite:!1,blending:i.EZo})]},"spark-".concat(n))}),(0,r.jsx)("pointLight",{color:"#8800ff",intensity:1*s,distance:4,decay:2}),(0,r.jsx)("pointLight",{color:"#aa66ff",intensity:1*s,distance:6,decay:1})]},e.id)}}return null})]})}let ey=e=>{let{parentRef:t,enemies:n,onEnemyDamage:r,setDamageNumbers:o,nextDamageNumberId:a}=e,[l,c]=(0,s.useState)([]),[u,h]=(0,s.useState)(!1);return{processChainLightning:(0,s.useCallback)(()=>{if(u)return;if(h(!0),Math.random()>=.375){console.log("Chain Lightning failed random check"),h(!1);return}let e=(e,t)=>{let r=null,s=1/0,i="";return n.forEach(n=>{if(n.isDying||!n.position||n.health<=0||t.has(n.id))return;let o=e.distanceTo(n.position);o<s&&o<11.25&&(s=o,r=n.position,i=n.id)}),r?{position:r,id:i}:null},s=e=>[19,17,13,11,7][e],l=new Set,d=e(t.current.position.clone(),l);if(!d){h(!1);return}l.add(d.id);let m=[d.position];r(d.id,19,!1,d.position,!0),o(e=>[...e,{id:a.current++,damage:19,position:d.position.clone().add(new i.Pq0(0,1.5,0)),isCritical:!1,isChainLightning:!0}]);let p=d.position;for(let t=1;t<Math.min(n.length,5);t++){let n=e(p,l);if(!n)break;let c=s(t);console.log("Chain Lightning jump ".concat(t,": Damage=").concat(c)),m.push(n.position),l.add(n.id),setTimeout(()=>{r(n.id,c,!1,n.position,!0),o(e=>[...e,{id:a.current++,damage:c,position:n.position.clone().add(new i.Pq0(0,1.5,0)),isCritical:!1,isChainLightning:!0}])},100*t),p=n.position}m.length>0&&(c(m),setTimeout(()=>{c([]),h(!1)},500))},[t,n,r,o,a,u]),lightningTargets:l,isProcessing:u}},eM=e=>{let{startPosition:t,targetPositions:n}=e,o=(0,s.useRef)(0),a=(0,s.useRef)(1),l=(0,s.useMemo)(()=>({segment:new i.Gu$(1,8,8),impact:new i.Gu$(.4,16,16)}),[]),c=(0,s.useMemo)(()=>({core:new i._4j({color:new i.Q1f("#FFD700"),emissive:new i.Q1f("#FFD700"),emissiveIntensity:5,transparent:!0}),branch:new i._4j({color:new i.Q1f("#FFA500"),emissive:new i.Q1f("#FFA500"),emissiveIntensity:4,transparent:!0}),impact:new i._4j({color:new i.Q1f("#FFD700"),emissive:new i.Q1f("#FFD700"),emissiveIntensity:3,transparent:!0})}),[]),u=(0,s.useMemo)(()=>Array(32).fill(0).map(()=>new i.Pq0((Math.random()-.5)*.15,(Math.random()-.5)*.15+2,(Math.random()-.5)*.15)),[]);return(0,f.F)((e,t)=>{o.current=Math.min(o.current+t,.5),a.current=.5*Math.random()+.5;let n=o.current/.5;c.core.opacity=.7*(1-n)*a.current,c.branch.opacity=.75*(1-n)*a.current,c.impact.opacity=.6*(1-n)*a.current}),(0,r.jsx)("group",{children:n.map((e,s)=>{let h=0===s?t:n[s-1],d=Math.ceil(8*e.clone().sub(h).length());return(0,r.jsxs)("group",{children:[Array(d).fill(0).map((t,n)=>{let s=n/d,o=u[n%u.length],a=h.clone().lerp(e,s).add(o).add(new i.Pq0(0,.5*Math.sin(s*Math.PI),0)),m=.025*Math.random()+.04;return(0,r.jsxs)("group",{children:[(0,r.jsx)("mesh",{position:a.toArray(),geometry:l.segment,material:c.core,scale:[m,m,m]}),.2>Math.random()&&(0,r.jsx)("mesh",{position:a.clone().add(u[(n+1)%u.length]),geometry:l.segment,material:c.branch,scale:[.35*m,.35*m,.35*m]})]},n)}),(0,r.jsx)("mesh",{position:e.toArray(),geometry:l.impact,material:c.impact}),(0,r.jsx)("pointLight",{position:e.toArray(),color:"#FFA500",intensity:15*(1-o.current/.5)*a.current,distance:4,decay:2})]},s)})})},ev=(0,s.forwardRef)((e,t)=>{let{parentRef:n,enemies:i,onEnemyDamage:o,setDamageNumbers:a,nextDamageNumberId:l}=e,{processChainLightning:c,lightningTargets:u}=ey({parentRef:n,enemies:i,onEnemyDamage:o,setDamageNumbers:a,nextDamageNumberId:l});return(0,s.useImperativeHandle)(t,()=>({processChainLightning:c})),(0,r.jsx)(r.Fragment,{children:u.length>0&&(0,r.jsx)(eM,{startPosition:n.current.position,targetPositions:u})})});ev.displayName="ChainLightning";let ew={1:29,2:41,3:47,4:53,5:73,6:83},eP=e=>{let{position:t}=e,[n,o]=s.useState(()=>Array(15).fill(null).map(()=>({offset:new i.Pq0((Math.random()-.5)*.8,0,(Math.random()-.5)*.8),speed:new i.Pq0((Math.random()-.5)*.55,(Math.random()-.5)*.05,(Math.random()-.5)*.55),life:1,orbit:{radius:.2+.3*Math.random(),speed:(Math.random()+.5)*2,phase:Math.random()*Math.PI*2}})));return(0,f.F)((e,t)=>{o(e=>e.map(e=>{let n=.001*Date.now()*e.orbit.speed+e.orbit.phase;return(e.offset.x=Math.cos(n)*e.orbit.radius+e.speed.x,e.offset.z=Math.sin(n)*e.orbit.radius+e.speed.z,e.offset.y=e.speed.y,e.speed.add(new i.Pq0((Math.random()-.5)*.01,(Math.random()-.5)*.001,(Math.random()-.5)*.01)),e.speed.multiplyScalar(.8),e.life-=1*t,e.life<=0)?{offset:new i.Pq0((Math.random()-.5)*.4,0,(Math.random()-.5)*.4),speed:new i.Pq0((Math.random()-.5)*.15,(Math.random()-.5)*.05,(Math.random()-.5)*.15),life:1,orbit:{radius:.4+.3*Math.random(),speed:(Math.random()+.5)*2,phase:Math.random()*Math.PI*2}}:e}))}),(0,r.jsx)("group",{position:t,children:n.map((e,t)=>(0,r.jsxs)("mesh",{position:e.offset.toArray(),children:[(0,r.jsx)("sphereGeometry",{args:[.0125,4,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#4488ff",emissive:"#4488ff",emissiveIntensity:3,transparent:!0,opacity:.8*e.life,depthWrite:!1,blending:i.EZo})]},t))})},eS=(0,s.forwardRef)((e,t)=>{let{parentRef:n,charges:o,setCharges:a}=e,l=(0,s.useRef)(null),{calculateBonusDamage:c,consumeOrb:u}=function(e){let{charges:t,setCharges:n}=e;return{calculateBonusDamage:(0,s.useCallback)(()=>ew[t.filter(e=>e.available).length]||0,[t]),consumeOrb:(0,s.useCallback)(()=>{let e=t.filter(e=>e.available);if(0===e.length)return;let r=e[0];n(e=>e.map(e=>e.id===r.id?{...e,available:!1,cooldownStartTime:Date.now()+200}:e)),setTimeout(()=>{n(e=>e.map(e=>e.id===r.id?{...e,available:!0,cooldownStartTime:null}:e))},8450)},[t,n])}}({charges:o,setCharges:a});if((0,s.useImperativeHandle)(t,()=>({calculateBonusDamage:c,consumeOrb:u})),(0,f.F)(()=>{l.current&&n.current&&l.current.position.copy(n.current.position)}),!n.current||!o.some(e=>e.available))return null;let h=o.length;return(0,r.jsx)("group",{ref:l,children:o.map((e,t)=>{if(!e.available)return null;let n=Math.acos(-1+2*t/h),s=Math.sqrt(h*Math.PI)*n,o=.05*Math.sin(n)*Math.cos(s),a=.05*Math.sin(n)*Math.sin(s+.001*Date.now()),l=.05*Math.cos(n);return(0,r.jsx)(eP,{position:new i.Pq0(o,a,l)},e.id)})})});eS.displayName="OrbShield";let eI=e=>{let{position:t,onComplete:n}=e,o=(0,s.useRef)(Date.now()),a=(0,s.useRef)(!1),l=(0,s.useRef)([]);(0,s.useEffect)(()=>{l.current=Array(40).fill(null).map(()=>({position:new i.Pq0(t.x+(Math.random()-.5)*1.65,t.y+3+2*Math.random(),t.z+(Math.random()-.5)*2),velocity:new i.Pq0((Math.random()-.5)*3,-(5*Math.random())-3,(Math.random()-.5)*3),scale:.1*Math.random()+.02,rotation:Math.random()*Math.PI,rotationSpeed:(Math.random()-.5)*5,life:1}))},[t]);let c=(0,s.useCallback)(()=>{a.current||(a.current=!0,null==n||n())},[n]);(0,s.useEffect)(()=>{let e=setTimeout(c,2850);return()=>{clearTimeout(e)}},[c]);let[u,h]=(0,s.useState)([]);return(0,f.F)((e,t)=>{if(a.current)return;let n=l.current.map(e=>({...e,velocity:e.velocity.clone().add(new i.Pq0(0,-(8*t),0)),position:e.position.clone().add(e.velocity.clone().multiplyScalar(t)),rotation:e.rotation+e.rotationSpeed*t,life:e.life-t})).filter(e=>e.life>0);l.current=n,h(n);let r=Date.now()-o.current;0===n.length&&r>=1250&&c()}),(0,r.jsx)("group",{children:u.map((e,t)=>(0,r.jsxs)("mesh",{position:e.position.toArray(),scale:[e.scale,e.scale,e.scale],rotation:[e.rotation,e.rotation,e.rotation],children:[(0,r.jsx)("icosahedronGeometry",{args:[1,0]}),(0,r.jsx)("meshStandardMaterial",{color:"#E5F7FF",emissive:"#E5F7FF",emissiveIntensity:1,transparent:!0,opacity:.45*e.life,depthWrite:!1,blending:i.EZo})]},t))})};function eb(e){let{isLeft:t=!1}=e,n=1.75*Math.PI;return(0,r.jsx)("group",{rotation:[-.45,t?-.7:.7,t?-.15:.15],children:Array.from({length:18}).map((e,s)=>{let i=s/19,o=.075*(1-.725*i),a=Math.pow(i,.2)*n,l=3.25*Math.pow(i,2.7);return(0,r.jsxs)("group",{position:[l*(t?-.15:.15),.0675*s,-(.725*l)],rotation:[-1.5*i,a,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[o,1.5*o,.0675,10]}),(0,r.jsx)("meshStandardMaterial",{color:"rgb(".concat(139-80*i,", ").concat(0+20*i,", ").concat(0+20*i,")"),roughness:.7,metalness:.4})]}),Array.from({length:6}).map((e,t)=>(0,r.jsx)("group",{rotation:[0,t*Math.PI/2,0],children:(0,r.jsxs)("mesh",{position:[.95*o,0,0],children:[(0,r.jsx)("boxGeometry",{args:[.3*o,.259375,1.5*o]}),(0,r.jsx)("meshStandardMaterial",{color:"rgb(".concat(159-100*i,", ").concat(20+20*i,", ").concat(20+20*i,")"),roughness:.8,metalness:.3})]})},t))]},s)})})}function eF(e){let{parentRef:t,isActive:n,onHit:o,enemyData:a,setDamageNumbers:l,nextDamageNumberId:c,charges:u,setCharges:h,onWhirlwindEnd:d}=e,m=(0,s.useRef)(null),p=(0,s.useRef)(0),x=(0,s.useRef)(new Set),g=(0,s.useRef)({}),{consumeCharge:j}=function(e){let{charges:t,setCharges:n,isWhirlwinding:r,onWhirlwindEnd:i}=e,o=(0,s.useRef)(0);(0,s.useEffect)(()=>{r&&!t.some(e=>e.available)&&(null==i||i())},[t,r,i]);let a=(0,s.useCallback)(()=>{let e=Date.now();if(e-o.current<1e3)return!1;let r=t.findIndex(e=>e.available);return -1===r?(null==i||i(),!1):(o.current=e,n(t=>{let n=[...t];return n[r]={...n[r],available:!1,cooldownStartTime:e},n}),setTimeout(()=>{n(e=>{let t=[...e];return t[r]={...t[r],available:!0,cooldownStartTime:null},t})},8250),!0)},[t,n,i]);return(0,s.useEffect)(()=>{if(r){if(!t.some(e=>e.available)){null==i||i();return}a();let e=setInterval(()=>{a()},1e3);return()=>clearInterval(e)}},[a,r,t,i]),{consumeCharge:a}}({parentRef:t,charges:u,setCharges:h,isWhirlwinding:n}),y=u.some(e=>e.available),M=n&&y;return(0,s.useEffect)(()=>{M||(x.current.clear(),p.current=0,null==d||d())},[M,d]),(0,s.useEffect)(()=>{if(M){let e=setInterval(()=>{j()||null==d||d()},1e3);return()=>clearInterval(e)}},[M,j,d]),(0,f.F)((e,n)=>{m.current&&t.current&&M&&(m.current.position.copy(t.current.position),p.current=Math.min(p.current+3*n,25),m.current.rotation.y+=p.current*n,o&&l&&c&&a&&a.forEach(e=>{let t=Date.now();if(t-(g.current[e.id]||0)<333)return;let n=m.current.position.distanceTo(e.position);if(n<=6.25){let r,s;n>=5?(r=38,s=!0):(r=19,s=!1),o(e.id,r),l(t=>[...t,{id:c.current++,damage:r,position:e.position.clone(),isCritical:s}]),g.current[e.id]=t}}))}),(0,r.jsx)("group",{ref:m,children:M&&(0,r.jsxs)(r.Fragment,{children:[[.5,1,1.5].map((e,t)=>(0,r.jsxs)("mesh",{position:[0,.5,0],rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("torusGeometry",{args:[2*e,.1,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:new i.Q1f(0xff0000),emissive:new i.Q1f(0xff0000),emissiveIntensity:2,transparent:!0,opacity:.6-.15*t,side:i.$EB})]},t)),[...Array(8)].map((e,t)=>(0,r.jsxs)("mesh",{position:[0,.5,0],rotation:[0,t/8*Math.PI*2,0],children:[(0,r.jsx)("planeGeometry",{args:[6.75,.5]}),(0,r.jsx)("meshStandardMaterial",{color:new i.Q1f(0xff0000),emissive:new i.Q1f(0xff0000),emissiveIntensity:1.5,transparent:!0,opacity:.4,side:i.$EB,blending:i.EZo})]},"trail-".concat(t)))]})})}let eC=e=>{let{currentHealth:t,maxHealth:n,onHealthChange:r,setDamageNumbers:o,nextDamageNumberId:a}=e,{processHealing:l}=ea({currentHealth:t,maxHealth:n,onHealthChange:r,setDamageNumbers:o,nextDamageNumberId:a,healAmount:7});return{handleStealthKillHeal:(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];l(t?7:5,e.clone().add(new i.Pq0(0,2,0)))},[l])}};function eE(e){let{parentRef:t}=e,n=(0,s.useRef)([]),o=(0,s.useRef)(Date.now());return(0,s.useEffect)(()=>(n.current=Array(20).fill(null).map(()=>{let e=new i.eaF(new i.Gu$(.15,8,8),new i._4j({color:"#a8e6cf",emissive:"#a8e6cf",transparent:!0,opacity:.6,blending:i.EZo,depthWrite:!1})),t=Math.random()*Math.PI*2,n=.5+.5*Math.random();return e.position.set(Math.cos(t)*n,.5+1*Math.random(),Math.sin(t)*n),e}),()=>{n.current.forEach(e=>{e.geometry.dispose(),e.material.dispose()})}),[]),(0,f.F)(()=>{if(!t.current)return;let e=Math.min((Date.now()-o.current)/1e3,1);n.current.forEach((t,r)=>{let s=r/n.current.length*Math.PI*2+e*Math.PI,i=.5*(1-e);t.position.x=Math.cos(s)*i,t.position.z=Math.sin(s)*i,t.position.y+=.03,t.material.opacity=.6*(1-e),t.scale.setScalar(1-.5*e)})}),(0,r.jsxs)("group",{children:[n.current.map((e,t)=>(0,r.jsx)("primitive",{object:e},t)),(0,r.jsx)("pointLight",{color:"#a8e6cf",intensity:2,distance:3,decay:2})]})}function ek(e){let{position:t,direction:n,onComplete:o,parentRef:a}=e,l=(0,s.useRef)(null),c=(0,s.useMemo)(()=>({mainArc:new i.O3Y(1.5,.4,8,32,Math.PI),innerGlow:new i.O3Y(1.5,.2,16,32,Math.PI),outerGlow:new i.O3Y(1,.45,16,32,Math.PI),particle:new i.Gu$(.08,8,8)}),[]),u=(0,s.useMemo)(()=>({mainFlame:new i._4j({color:"#9b4dff",emissive:"#4d2bff",emissiveIntensity:2,transparent:!0,opacity:.9}),innerGlow:new i._4j({color:"#4d8eff",emissive:"#2b4dff",emissiveIntensity:1,transparent:!0,opacity:.7}),outerGlow:new i._4j({color:"#9b4dff",emissive:"#4d2bff",emissiveIntensity:1.3,transparent:!0,opacity:.5}),particle:new i._4j({color:"#4d8eff",emissive:"#2b4dff",emissiveIntensity:1.5,transparent:!0,opacity:.6})}),[]),h=(0,s.useMemo)(()=>Array(12).fill(0).map((e,t)=>({position:new i.Pq0(.75*Math.cos(t*Math.PI/6),.75*Math.sin(t*Math.PI/6),0)})),[]),{reset:d}=ei({effectRef:l,position:t,direction:n,parentRef:a});return(0,s.useEffect)(()=>()=>{d(),o()},[d,o]),(0,r.jsx)("group",{ref:l,position:t.toArray(),rotation:[Math.PI/2,Math.atan2(n.x,n.z),0],children:(0,r.jsxs)("group",{position:[0,0,0],children:[(0,r.jsx)("mesh",{geometry:c.mainArc,material:u.mainFlame}),(0,r.jsx)("mesh",{geometry:c.innerGlow,material:u.innerGlow}),(0,r.jsx)("mesh",{geometry:c.outerGlow,material:u.outerGlow}),h.map((e,t)=>(0,r.jsx)("mesh",{position:e.position,geometry:c.particle,material:u.particle},t)),(0,r.jsx)("pointLight",{color:"#9b4dff",intensity:8,distance:4}),(0,r.jsx)("pointLight",{color:"#4d8eff",intensity:5,distance:6})]})})}let eR=e=>{let{parentRef:t,onHit:n,enemyData:r,setDamageNumbers:l,nextDamageNumberId:c,charges:u,setCharges:h}=e,d=(0,s.useRef)([]),m=(0,s.useRef)(0),{consumeCharge:p}=function(e){let{charges:t,setCharges:n}=e,r=(0,s.useRef)(0),i=(0,s.useRef)(null);return{consumeCharge:(0,s.useCallback)(()=>{let e=t.filter(e=>e.available);if(0===e.length)return!1;if(null===i.current&&(i.current=e[0].id,r.current=0),r.current++,r.current>=8){let e=i.current;n(t=>t.map(t=>t.id===e?{...t,available:!1,cooldownStartTime:Date.now()}:t)),setTimeout(()=>{n(t=>t.map(t=>t.id===e?{...t,available:!0,cooldownStartTime:null}:t))},8250),r.current=0,i.current=null}return!0},[t,n])}}({charges:u,setCharges:h}),f=(0,s.useCallback)(()=>{let e=Date.now();if(e-m.current<150||!u.some(e=>e.available)||!p()||!t.current)return;m.current=e;let s=t.current.position.clone();s.y+=1;let h=new i.Pq0(0,0,1);h.applyQuaternion(t.current.quaternion);let f=s.clone(),x={id:Date.now(),position:f.clone(),direction:h.clone(),startPosition:f.clone(),maxDistance:40,isQuickShot:!0,power:1,startTime:Date.now(),hasCollided:!1};d.current.push(x);let g=()=>{d.current=d.current.filter(e=>{if(e.position.distanceTo(e.startPosition)<e.maxDistance){for(let t of(e.position.add(e.direction.clone().multiplyScalar(.5)),r)){if(t.isDying||t.health<=0)continue;let r=new i.Pq0(e.position.x,0,e.position.z),s=new i.Pq0(t.position.x,0,t.position.z);if(1.3>r.distanceTo(s)){let e=a[o.BOW].normal;return n(t.id,e),t.health-e>0&&l(n=>[...n,{id:c.current++,damage:e,position:t.position.clone(),isCritical:!1}]),!1}}return!0}return!1}),d.current.length>0&&requestAnimationFrame(g)};requestAnimationFrame(g)},[t,r,n,l,c,u,p]);return(0,s.useEffect)(()=>(console.log("QuickShot hook initialized"),()=>{console.log("QuickShot hook cleanup")}),[]),{shootQuickShot:f,activeProjectilesRef:d}};function eT(e){let{position:t,direction:n}=e,s=new i._4j({color:"#d6cfc7",roughness:.9,metalness:.1});return(0,r.jsxs)("group",{position:t.toArray(),rotation:[0,Math.atan2(n.x,n.z),0],children:[(0,r.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.04,.06,1.2,6]}),(0,r.jsx)("meshStandardMaterial",{...s})]}),[-.3,0,.3].map((e,t)=>(0,r.jsx)("group",{position:[0,0,e],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.08,8,8]}),(0,r.jsx)("meshStandardMaterial",{...s})]})},t)),(0,r.jsx)("group",{position:[0,0,-.7],children:(0,r.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("coneGeometry",{args:[.1,.3,6]}),(0,r.jsx)("meshStandardMaterial",{...s})]})}),[0,Math.PI/2,Math.PI,3*Math.PI/2].map((e,t)=>(0,r.jsx)("group",{position:[.08*Math.sin(e),.08*Math.cos(e),0],rotation:[0,0,e],children:(0,r.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("coneGeometry",{args:[.02,.1,4]}),(0,r.jsx)("meshStandardMaterial",{...s})]})},t)),(0,r.jsx)("pointLight",{color:"#a8e6cf",intensity:.5,distance:2,decay:2})]})}function e_(e){var t;let{onHit:n,controlsRef:l,currentWeapon:c,health:u,maxHealth:d,isPlayer:m=!1,abilities:p,onAbilityUse:x,onPositionUpdate:M,enemyData:w,onHealthChange:b,fireballManagerRef:R}=e,D=(0,s.useRef)(null),[A,q]=(0,s.useState)(!1),[O,H]=(0,s.useState)([]),N=(0,s.useRef)(0),{camera:W}=(0,f.D)(),[U,Y]=(0,s.useState)(!1),{keys:Z}=function(e){let{groupRef:t,controlsRef:n,camera:r,speed:o=3.6,onPositionUpdate:a,health:l,isCharging:c=!1,onMovementUpdate:u}=e,h=(0,s.useRef)({w:!1,a:!1,s:!1,d:!1,shift:!1}),d=(0,s.useRef)(!1),m=(0,s.useRef)(new i.Pq0);return(0,s.useEffect)(()=>{l<=0?(d.current=!0,h.current={w:!1,a:!1,s:!1,d:!1,shift:!1}):d.current=!1},[l]),(0,s.useEffect)(()=>{let e=()=>{d.current=!0,h.current={w:!1,a:!1,s:!1,d:!1,shift:!1}},t=()=>{d.current=!1};return window.addEventListener("gameOver",e),window.addEventListener("gameReset",t),()=>{window.removeEventListener("gameOver",e),window.removeEventListener("gameReset",t)}},[]),(0,f.F)((e,s)=>{if(!t.current||d.current)return;let l=new i.Pq0;r.getWorldDirection(l),l.y=0,l.normalize();let p=new i.Pq0(-l.z,0,l.x),f=new i.Pq0(0,0,0);if(h.current.w&&f.add(l),h.current.s&&f.sub(l),h.current.a&&f.sub(p),h.current.d&&f.add(p),f.length()>0){f.normalize(),m.current.copy(f),u&&u(f);let e=o*s,n=f.dot(l);n<-.1?e*=.6:.1>=Math.abs(n)&&(e*=.85),c&&(e*=.05);let r=B.isUnitStealthed();r&&(e*=1.6);let i=f.multiplyScalar(e),h=t.current.position.clone().add(i);28>h.length()&&(t.current.position.copy(h),a(t.current.position,r))}if(n.current){if(!h.current.shift&&!n.current.mouseButtons.LEFT){let e=Math.atan2(l.x,l.z)-t.current.rotation.y;for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;t.current.rotation.y+=e*Math.min(1,15*s)}let e=t.current.position;n.current.target.set(e.x,e.y,e.z)}}),(0,s.useEffect)(()=>{let e=e=>{if(d.current)return;let t=e.key.toLowerCase();"shift"===t?h.current.shift=!0:t in h.current&&(h.current[t]=!0)},t=e=>{let t=e.key.toLowerCase();"shift"===t?h.current.shift=!1:t in h.current&&(h.current[t]=!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[]),{keys:h}}({groupRef:D,controlsRef:l,camera:W,onPositionUpdate:M,health:u,isCharging:U,onMovementUpdate:e=>{eN.copy(e)}}),[V,K]=(0,s.useState)(!1),[X,et]=(0,s.useState)([]),er=(0,s.useRef)(0),[ei,ea]=(0,s.useState)([]),ec=(0,s.useRef)(0),[eu,ed]=(0,s.useState)({}),[em,ep]=(0,s.useState)(0),ef=(0,s.useRef)(null),ex=(0,s.useRef)(0),[eg,ey]=(0,s.useState)([]),[eM,ew]=(0,s.useState)(()=>Array.from({length:h[c]},(e,t)=>({id:t+1,available:!0,cooldownStartTime:null}))),[eP]=(0,s.useState)(15),e_=(0,s.useRef)(new Set),[eG,eD]=(0,s.useState)([]),[eA,ez]=(0,s.useState)(!1),[eq,eB]=(0,s.useState)(!1),eL=(0,s.useRef)(null),[eO,eH]=(0,s.useState)(0),[eN]=(0,s.useState)(()=>new i.Pq0),eW=(0,s.useRef)(null),eU=(0,s.useRef)(0),eQ=(0,s.useRef)([]),eY=(0,s.useRef)([]),{activateStealth:eZ,isStealthed:eV,setIsStealthed:eK,setHasShadowStrikeBuff:e$}=function(){let{onStealthStart:e,onStealthEnd:t,duration:n=3500}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[r,i]=(0,s.useState)(!1),[o,a]=(0,s.useState)(!1),l=(0,s.useRef)(null),c=(0,s.useCallback)(()=>{B.activateStealth(),i(!0),a(!0),null==e||e(),clearTimeout(l.current),l.current=setTimeout(()=>{B.breakStealth(),i(!1),a(!1),null==t||t()},n)},[n,e,t]);return(0,s.useEffect)(()=>()=>{l.current&&clearTimeout(l.current)},[]),{activateStealth:c,isStealthed:r,hasShadowStrikeBuff:o,setIsStealthed:i,setHasShadowStrikeBuff:a}}({onStealthStart:()=>{eD(e=>{var t;return[...e,{id:Date.now(),type:"stealth",position:(null===(t=D.current)||void 0===t?void 0:t.position.clone())||new i.Pq0,direction:new i.Pq0,duration:5,startTime:Date.now()}]})},onStealthEnd:()=>{eD(e=>e.filter(e=>"stealth"!==e.type))}}),{handleStealthKillHeal:eX}=eC({currentHealth:u,maxHealth:d,onHealthChange:e=>null==b?void 0:b(e),setDamageNumbers:ea,nextDamageNumberId:ec}),eJ=(0,s.useCallback)((e,t)=>{let r=t,s=!1,o=!1,a=B.hasShadowStrikeBuff();if(a){let t=w.find(t=>t.id===e);if(t&&D.current){let e=D.current.position,n=t.position,a=new i.Pq0(0,0,1).applyEuler(new i.O9p(0,t.rotation,0)),l=new i.Pq0().subVectors(e,n).normalize().dot(a);s=!0,B.breakStealth(),requestAnimationFrame(()=>{eK(!1),e$(!1)}),l>.5?(r+=221,o=!0,t.health<=r&&eX(t.position,!0)):(r+=110,t.health<=r&&eX(t.position,!1))}}n(e,r);let l=w.find(t=>t.id===e);if(l&&ea(e=>[...e,{id:ec.current++,damage:r,position:l.position.clone(),isCritical:o,isStealthStrike:s}]),a&&l&&D.current){let e=new i.Pq0().subVectors(l.position,D.current.position).normalize();eD(t=>[...t,{id:Date.now(),type:"stealthStrike",position:l.position.clone(),direction:e,duration:.2,startTime:Date.now()}])}},[n,eK,e$,w,eX]),[e0,e1]=(0,s.useState)(!1),e2=(0,s.useRef)(null),{shootQuickShot:e5,activeProjectilesRef:e3}=eR({parentRef:D,onHit:n,enemyData:w,setDamageNumbers:ea,nextDamageNumberId:ec,charges:eM,setCharges:ew}),e8=(0,s.useCallback)(()=>{if(!D.current)return;let e=eM.findIndex(e=>e.available);if(-1===e)return;let t=D.current.position.clone();t.y+=1;let n=new i.Pq0(0,0,1);n.applyQuaternion(D.current.quaternion),ew(t=>t.map((t,n)=>n===e?{...t,available:!1,cooldownStartTime:Date.now()}:t));let r={id:N.current++,position:t.clone(),startPosition:t.clone(),direction:n.normalize(),maxDistance:45};eQ.current.push(r),H(e=>[...e,r])},[D,eM]),e4=(e,t)=>{if(t){let e=Date.now();eD(n=>[...n,{id:e,type:"unitFireballExplosion",position:t,direction:new i.Pq0,duration:.225,startTime:e}])}eQ.current=eQ.current.filter(t=>t.id!==e),H(t=>t.filter(t=>t.id!==e))},e6=(0,s.useRef)({}),e7=c===o.SCYTHE?120:200,e9=e=>{if(!D.current||!A)return;let t=Date.now();if(t-(e6.current[e]||0)<e7)return;e6.current[e]=t;let n=w.find(t=>t.id===e);if(!n||n.health<=0||n.isDying)return;ed(e=>({...e,[n.id]:(e[n.id]||0)+1,["".concat(n.id,"_time")]:t}));let r=n.id.startsWith("enemy");if(!r)return;let s=r&&c===o.SABRES?2:1,l=eu[n.id]||0;if(l>=s)return;let u=D.current.position.distanceTo(n.position);if(u<=a[c].range){var h,d;if(c===o.SPEAR){let e,t;let r=new i.Pq0().subVectors(n.position,D.current.position).normalize(),s=new i.Pq0(0,0,1).applyQuaternion(D.current.quaternion);if(Math.abs(r.angleTo(s))>Math.PI/6)return;let l=a[o.SPEAR].range,h=a[c].normal;if(u>=.8*l)e=2*h,t=!0;else{let n=L(h);e=n.damage,t=n.isCritical}eJ(n.id,e),ea(r=>[...r,{id:ec.current++,damage:e,position:n.position.clone(),isCritical:t}]);return}if(c===o.SABRES){let e=new i.Pq0().subVectors(n.position,D.current.position).normalize(),t=new i.Pq0(0,0,.25).applyQuaternion(D.current.quaternion);if(Math.abs(e.angleTo(t))>Math.PI/4.5)return}let t=a[c].normal;if(V&&c===o.SWORD){let e=e_.current;if(e.has(n.id)||n.health<=0)return;e.add(n.id);let{damage:t,isCritical:r}=L(13);eJ(n.id,t),ea(e=>[...e,{id:ec.current++,damage:t,position:n.position.clone(),isCritical:r}]),setTimeout(()=>{let t=w.find(e=>e.id===n.id);if(!t||t.health<=0){e.delete(n.id);return}let{damage:r,isCritical:s}=L(41);eJ(n.id,r),ea(e=>[...e,{id:ec.current++,damage:r,position:t.position.clone(),isCritical:s,isLightning:!0}]),e.delete(n.id)},300)}let{damage:r,isCritical:s}=L(t),m=r;if(c===o.SABRES&&tl.current&&p[o.SABRES].active.isUnlocked){let t=tl.current.calculateBonusDamage();if(t>0){m+=t,ea(e=>(console.log("Creating OrbShield damage number:",{damage:t,isOrbShield:!0}),[...e,{id:ec.current++,damage:t,position:new i.Pq0(n.position.x+(0===l?-.4:.4),n.position.y+.8,n.position.z),isCritical:!1,isOrbShield:!0}]));let r=Date.now();if(r-eU.current>=1e3){eU.current=r;let e=D.current.position.clone(),t=new i.Pq0(0,0,1).applyQuaternion(D.current.quaternion).multiplyScalar(2);eD(n=>[...n.filter(e=>"frostExplosion"!==e.type||e.startTime&&Date.now()-e.startTime<2e3),{id:Date.now(),type:"frostExplosion",position:e.add(t),direction:new i.Pq0,duration:.5,startTime:Date.now()}])}eu[e]||tl.current.consumeOrb()}}eJ(n.id,m);let f=n.health-m;if(c!==o.SWORD||!p[o.SWORD].passive.isUnlocked||V||eA||eq||!(f>0)||(null===(h=eL.current)||void 0===h||h.processHealingChance(),eB(!0)),f>0){if(c===o.SABRES){let e=0===l?-.4:.4;ea(t=>[...t,{id:ec.current++,damage:r,position:new i.Pq0(n.position.x+e,n.position.y,n.position.z),isCritical:s}])}else ea(e=>[...e,{id:ec.current++,damage:r,position:n.position.clone(),isCritical:s}])}c!==o.SWORD||!p[o.SWORD].active.isUnlocked||V||eA||null===(d=eW.current)||void 0===d||d.processChainLightning()}},te=()=>{q(!1),ed({}),K(!1),eB(!1)};(0,f.F)((e,t)=>{if(D.current){if(A&&D.current&&w.forEach(e=>{e9(e.id)}),U&&null!==ef.current){let e=Math.min((Date.now()-ef.current)/1e3/1.675,1);ep(e),eH(e);let n=ex.current;ex.current+=(e-n)*t*5,e>=1&&tr(1)}eY.current=eY.current.filter(e=>{if(e.position.distanceTo(e.startPosition)<e.maxDistance&&!e.hasCollided){let t=e.power>=1?.5:.375;for(let n of(e.position.add(e.direction.clone().multiplyScalar(t)),w)){let t=new i.Pq0(e.position.x,0,e.position.z),r=new i.Pq0(n.position.x,0,n.position.z);if(1.3>t.distanceTo(r)&&(td(e.id,n.id,e.power,e.position),e.power<1))return e.hasCollided=!0,!1}return!0}return!1}),eY.current.length!==eg.length&&ey([...eY.current]),eQ.current=eQ.current.filter(e=>{if(e.position.distanceTo(e.startPosition)<e.maxDistance){for(let t of(e.position.add(e.direction.clone().multiplyScalar(.4)),w)){if(t.health<=0)continue;let n=t.position.clone();if(n.y=1.5,1.5>e.position.distanceTo(n))return tm(e.id,t.id),e4(e.id,e.position.clone()),!1}return!0}return e4(e.id),!1}),H([...eQ.current]),ew(e=>e.map(e=>!e.available&&e.cooldownStartTime&&Date.now()-e.cooldownStartTime>=8250?{...e,available:!0,cooldownStartTime:null}:e)),eD(e=>e.filter(e=>"boneclaw"===e.type||"blizzard"===e.type||!e.duration||!e.startTime||(Date.now()-e.startTime)/1e3<e.duration)),e0&&e2.current&&Date.now()-e2.current>=15e3&&(e1(!1),e2.current=null,x(c,"e"))}});let[tt,tn]=(0,s.useState)(0),tr=(0,s.useCallback)(e=>{if(!D.current)return;let t=Date.now();if(t-tt<750)return;tn(t);let n=D.current.position.clone();n.y+=1;let r=new i.Pq0(0,0,1);r.applyQuaternion(D.current.quaternion);let s=n.clone(),o={id:Date.now(),position:s.clone(),direction:r.clone(),power:e,startTime:Date.now(),maxDistance:40,startPosition:s.clone()};eY.current.push(o),ey(e=>[...e,o]),Y(!1),ep(0),ef.current=null,x(c,"e")},[c,D,x,tt]),{startFirebeam:ts,stopFirebeam:ti}=ee({parentRef:D,onHit:n,enemyData:w,setActiveEffects:eD,charges:eM,setCharges:ew,setDamageNumbers:ea,nextDamageNumberId:ec}),to=(0,s.useRef)(null),ta=(0,s.useCallback)(e=>{b&&b(e)},[b]),tl=(0,s.useRef)(null),{activateOathstrike:tc}=el({parentRef:D,onHit:n,charges:eM,setCharges:ew,enemyData:w,onHealthChange:ta,setDamageNumbers:ea,nextDamageNumberId:ec,currentHealth:u,maxHealth:d});!function(e){let{keys:t,groupRef:n,currentWeapon:r,abilities:a,isSwinging:l,isSmiting:c,isBowCharging:u,bowChargeProgress:h,nextSmiteId:d,setIsSwinging:m,setIsSmiting:p,setIsBowCharging:f,setBowChargeStartTime:x,setSmiteEffects:g,setActiveEffects:j,onAbilityUse:y,shootFireball:M,releaseBowShot:v,startFirebeam:w,stopFirebeam:P,castReanimate:S,health:I,maxHealth:b,onHealthChange:F,activateOathstrike:C,setIsOathstriking:E,orbShieldRef:k,setIsWhirlwinding:R,whirlwindStartTime:T,isWhirlwinding:_,fireballCharges:G,activateStealth:D,shootQuickShot:A}=e,z=(0,s.useRef)(0),q=(0,s.useRef)(!1),B=(0,s.useRef)(0),L=(0,s.useCallback)(()=>{let e=Date.now();e-B.current<200||!(a[r].q.currentCooldown<=0)||l||(B.current=e,z.current=e,m(!0),y(r,"q"))},[a,r,l,y,m]);(0,s.useEffect)(()=>{I<=0?q.current=!0:q.current=!1},[I]),(0,s.useEffect)(()=>{let e=e=>{if(q.current)return;let s=e.key.toLowerCase();if(!(s in t.current)||!t.current[s]){if(s in t.current&&(t.current[s]=!0),"q"===s&&(r===o.BOW?A():L()),"e"===s){let e=a[r].e;if(e.currentCooldown<=0)switch(r){case o.SWORD:if(!c){if(Date.now()-z.current<450){console.log("Cannot use Smite so soon after a normal attack");return}p(!0),m(!0);let e=n.current.position.clone();e.add(new i.Pq0(0,0,3.5).applyQuaternion(n.current.quaternion)),g(t=>[...t,{id:d.current++,position:e}]),y(r,"e")}break;case o.BOW:u||(f(!0),x(Date.now()));break;case o.SABRES:e.currentCooldown<=0&&(D(),y(r,"e"));break;case o.SCYTHE:M(),y(r,"e");break;case o.SPEAR:_||(G.some(e=>e.available)?(R(!0),T.current=Date.now()):console.log("Cannot use Whirlwind without available charges"))}}if("1"===s&&a[r].passive.isUnlocked&&(r===o.SCYTHE?S():r===o.SABRES&&w&&P&&(w(),y(r,"passive"))),"2"===s){let e=a[r].active;if(e.isUnlocked&&e.currentCooldown<=0&&r===o.SCYTHE){let e=Date.now();j(t=>t.some(e=>"summon"===e.type)?t:[...t,{id:e,type:"summon",position:n.current.position.clone(),direction:new i.Pq0(0,0,1).applyQuaternion(n.current.quaternion),onComplete:()=>{console.log("Summon completed, ID:",e),y(r,"active"),j(t=>t.filter(t=>t.id!==e))},onStartCooldown:()=>{console.log("Starting cooldown for summon:",e)}}])}}if("r"===s){let e=a[r].r;if(e.isUnlocked&&e.currentCooldown<=0)switch(r){case o.SWORD:let t=C();t&&(E(!0),j(e=>[...e,{id:Math.random(),type:"oathstrike",position:t.position,direction:t.direction}]),y(r,"r"));break;case o.SABRES:j(e=>[...e,{id:Math.random(),type:"blizzard",position:n.current.position.clone(),direction:new i.Pq0(0,0,0)}]),y(r,"r");break;case o.SCYTHE:j(e=>[...e,{id:Math.random(),type:"boneclaw",position:n.current.position.clone(),direction:new i.Pq0(0,0,1).applyQuaternion(n.current.quaternion)}]),y(r,"r")}}l||r!==o.BOW||"q"!==e.key.toLowerCase()||(A(),y(o.BOW,"q"))}},s=e=>{if(q.current)return;let n=e.key.toLowerCase();n in t.current&&(t.current[n]=!1),"e"===n&&r===o.BOW&&u&&v(h),"e"===n&&r===o.SPEAR&&_&&(R(!1),T.current=null,y(r,"e"))};return window.addEventListener("keydown",e),window.addEventListener("keyup",s),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",s)}},[t,L,n,r,a,l,c,u,h,m,p,f,g,j,y,M,v,d,x,w,P,S,I,b,F,E,C,k,R,T,_,G,D,A]),(0,s.useEffect)(()=>{let e=e=>{q.current||0!==e.button||(t.current.mouse0=!0)},n=e=>{q.current||0!==e.button||(t.current.mouse0=!1)};return window.addEventListener("mousedown",e),window.addEventListener("mouseup",n),()=>{window.removeEventListener("mousedown",e),window.removeEventListener("mouseup",n)}},[t]),(0,s.useEffect)(()=>{let e=setInterval(()=>{!q.current&&t.current&&t.current.mouse0&&L()},50);return()=>clearInterval(e)},[L,t,a,r,l,y]),(0,s.useEffect)(()=>{let e=()=>{q.current=!0},t=()=>{q.current=!1};return window.addEventListener("gameOver",e),window.addEventListener("gameReset",t),()=>{window.removeEventListener("gameOver",e),window.removeEventListener("gameReset",t)}},[])}({keys:Z,groupRef:D,currentWeapon:c,abilities:p,isSwinging:A,isSmiting:V,isBowCharging:U,bowChargeProgress:em,nextSmiteId:er,setIsSwinging:q,setIsSmiting:K,setIsBowCharging:Y,setBowChargeStartTime:e=>{ef.current=e},setSmiteEffects:et,setActiveEffects:eD,onAbilityUse:x,shootFireball:e8,releaseBowShot:tr,startFirebeam:ts,stopFirebeam:ti,castReanimate:()=>{var e;null===(e=to.current)||void 0===e||e.castReanimate()},reanimateRef:to,health:u,maxHealth:d,onHealthChange:b,activateOathstrike:tc,setIsOathstriking:ez,orbShieldRef:tl,isWhirlwinding:e0,setIsWhirlwinding:e1,whirlwindStartTime:e2,fireballCharges:eM,activateStealth:eZ,shootQuickShot:e5});let tu=e=>{et(t=>t.filter(t=>t.id!==e))},th=e=>{ea(t=>t.filter(t=>t.id!==e))};(0,s.useEffect)(()=>{c===o.SABRES&&ed({})},[c]);let td=(e,t,r,s)=>{if(!t.startsWith("enemy"))return;let o=w.find(e=>e.id===t);if(!o||o.health<=0||o.isDying)return;let a="".concat(e,"_").concat(t);if(eu[a])return;let l=new i.Pq0(s.x,0,s.z),c=new i.Pq0(o.position.x,0,o.position.z);if(l.distanceTo(c)>1.3)return;ed(e=>({...e,[a]:1}));let u=Math.floor(41+30*r)+(r>=.99?71:0);n(t,u),o.health-u>0&&ea(e=>[...e,{id:ec.current++,damage:u,position:o.position.clone(),isCritical:r>=.99}])},tm=(e,t)=>{if(!t.startsWith("enemy"))return;let r=w.find(e=>e.id===t);if(!r)return;let{damage:s,isCritical:i}=L(59);n(t,s),r.health-s>0&&ea(e=>[...e,{id:ec.current++,damage:s,position:r.position.clone(),isCritical:i,isFireball:!0}]),e4(e)};return(0,f.F)(()=>{D.current&&M(D.current.position.clone(),eV)}),(0,s.useEffect)(()=>{let e=e_.current;return()=>{e.clear()}},[]),(0,f.F)(()=>{ey(e=>e.filter(e=>e.position.distanceTo(e.startPosition)<e.maxDistance))}),(0,s.useEffect)(()=>{let e=setInterval(()=>{eD(e=>e.filter(e=>"unitFireballExplosion"!==e.type||!!e.startTime&&Date.now()-e.startTime<1e3*e.duration))},100);return()=>{clearInterval(e),eD(e=>e.filter(e=>"unitFireballExplosion"!==e.type))}},[]),(0,s.useEffect)(()=>()=>{eD(e=>e.filter(e=>"fireballExplosion"!==e.type))},[]),(0,s.useEffect)(()=>{R&&(R.current={shootFireball:e8,cleanup:()=>{H([]),eD([]),e_.current.clear(),ew(e=>e.map(e=>({...e,available:!0,cooldownStartTime:null})))}})},[R,e8]),(0,s.useEffect)(()=>()=>{H([]),ew(e=>e.map(e=>({...e,available:!0,cooldownStartTime:null})))},[]),(0,s.useEffect)(()=>()=>{eD(e=>e.filter(e=>"boneclaw"===e.type||"blizzard"===e.type))},[]),(0,s.useEffect)(()=>{let e=Date.now();eD(t=>t.filter(t=>!t.startTime||!t.duration||e-t.startTime<t.duration))},[]),(0,s.useEffect)(()=>{let e=setInterval(()=>{eD(e=>e.filter(e=>"fireballExplosion"!==e.type||(e.startTime?(Date.now()-e.startTime)/1e3:0)<(e.duration||.225)))},100);return()=>clearInterval(e)},[eD]),(0,s.useEffect)(()=>{let e=setInterval(()=>{eD(e=>e.filter(e=>"frostExplosion"!==e.type||(e.startTime?(Date.now()-e.startTime)/1e3:0)<(e.duration||.25)))},100);return()=>clearInterval(e)},[eD]),(0,s.useEffect)(()=>()=>{eQ.current=[],H([])},[]),(0,s.useEffect)(()=>()=>{eY.current=[],ey([])},[]),(0,s.useEffect)(()=>()=>{e1(!1),e2.current=null},[]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("group",{ref:D,position:[0,1,0],children:[(0,r.jsx)("group",{scale:[.335,.335,.335],position:[-.05,.215,.35],rotation:[.15,0,-5],children:(0,r.jsx)(eb,{isLeft:!0})}),(0,r.jsx)("group",{scale:[.335,.335,.335],position:[.05,.215,.35],rotation:[.15,0,5],children:(0,r.jsx)(eb,{isLeft:!1})}),(0,r.jsxs)("mesh",{scale:1.085,children:[(0,r.jsx)("sphereGeometry",{args:[.415,32,32]}),(0,r.jsx)("meshBasicMaterial",{color:"#a8e6cf",transparent:!0,opacity:eV?.15:.125,depthWrite:!1,blending:i.EZo})]}),eV&&(0,r.jsxs)("mesh",{scale:1.1,children:[(0,r.jsx)("sphereGeometry",{args:[.42,32,32]}),(0,r.jsx)("meshBasicMaterial",{color:"#a8e6cf",transparent:!0,opacity:.08,depthWrite:!1,blending:i.EZo})]}),eV&&(0,r.jsx)(eE,{parentRef:D}),(0,r.jsxs)("group",{position:[0,.2,-.2],children:[(0,r.jsx)("group",{rotation:[0,Math.PI/5.5,0],children:(0,r.jsx)(k,{collectedBones:eP,isLeftWing:!0,parentRef:D})}),(0,r.jsx)("group",{rotation:[0,-Math.PI/5.5,0],children:(0,r.jsx)(k,{collectedBones:eP,isLeftWing:!1,parentRef:D})})]}),(0,r.jsx)(J,{parentRef:D,charges:eM,weaponType:c}),(0,r.jsx)("group",{scale:[.8,.55,.8],position:[0,.04,-.015],rotation:[.4,0,0],children:(0,r.jsx)(_,{})}),(0,r.jsx)("group",{scale:[.85,.85,.85],position:[0,.05,.1],children:(0,r.jsx)(G,{movementDirection:eN})}),c===o.SABRES?(0,r.jsx)(v,{isSwinging:A,onSwingComplete:te,onLeftSwingStart:()=>{},onRightSwingStart:()=>{},isBowCharging:U,hasActiveAbility:p[o.SABRES].active.isUnlocked}):c===o.SCYTHE?(0,r.jsx)(j,{parentRef:D,isSwinging:A,onSwingComplete:te}):c===o.SPEAR?(0,r.jsx)(S,{isSwinging:A,onSwingComplete:te,enemyData:w,onHit:n,setDamageNumbers:ea,nextDamageNumberId:ec}):c===o.BOW?(0,r.jsx)("group",{position:[0,.1,.3],children:(0,r.jsx)(P,{position:new i.Pq0,direction:new i.Pq0(0,0,1).applyQuaternion((null===(t=D.current)||void 0===t?void 0:t.quaternion)||new i.PTz),chargeProgress:em,isCharging:U,onRelease:tr})}):(0,r.jsx)(y,{isSwinging:A,isSmiting:V,isOathstriking:eA,onSwingComplete:te,onSmiteComplete:()=>{K(!1),q(!1),ed({})},onOathstrikeComplete:()=>{ez(!1),q(!1),ed({})},hasChainLightning:p[o.SWORD].active.isUnlocked}),!m&&(0,r.jsxs)(C,{position:[0,2,0],lockX:!1,lockY:!1,lockZ:!1,children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("planeGeometry",{args:[1,.1]}),(0,r.jsx)("meshBasicMaterial",{color:"#333333"})]}),(0,r.jsx)("mesh",{position:[.5+u/d*.5,0,.001],children:(0,r.jsx)("planeGeometry",{args:[u/d,.08]})})]})]}),(0,r.jsx)(E,{parentRef:D,weaponType:c}),O.map(e=>(0,r.jsx)(g,{position:e.position,direction:e.direction,onImpact:t=>e4(e.id,t)},e.id)),X.map(e=>(0,r.jsx)(I,{weaponType:c,position:e.position,onComplete:()=>tu(e.id)},e.id)),ei.map(e=>(0,r.jsx)(F,{damage:e.damage,position:e.position,isCritical:e.isCritical,isLightning:e.isLightning,isHealing:e.isHealing,isBlizzard:e.isBlizzard,isBoneclaw:e.isBoneclaw,isOathstrike:e.isOathstrike,isFirebeam:e.isFirebeam,isOrbShield:e.isOrbShield,isChainLightning:e.isChainLightning,isFireball:e.isFireball,isSummon:e.isSummon,isStealthStrike:e.isStealthStrike,onComplete:()=>th(e.id)},e.id)),eg.map(e=>(0,r.jsxs)("group",{children:[(0,r.jsxs)("group",{position:e.position.toArray(),rotation:[0,Math.atan2(e.direction.x,e.direction.z),0],children:[(0,r.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.03,.125,2.1,6]})," ",(0,r.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:1,transparent:!0,opacity:1})]}),[void 0,void 0,void 0].map((e,t)=>(0,r.jsxs)("mesh",{position:[0,0,-(.45*t)+.5],rotation:[Math.PI,0,.003*Date.now()+t*Math.PI/3],children:[(0,r.jsx)("torusGeometry",{args:[.125+.04*t,.05,6,12]})," ",(0,r.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:3,transparent:!0,opacity:.9-.125*t,blending:i.EZo})]},"ring-".concat(t))),(0,r.jsx)("pointLight",{color:"#00ffff",intensity:3,distance:5,decay:2})]}),e.power>=1&&e.position.distanceTo(e.startPosition)<e.maxDistance&&!e.hasCollided&&(0,r.jsxs)("group",{position:e.position.toArray(),rotation:[0,Math.atan2(e.direction.x,e.direction.z),0],children:[(0,r.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.15,.35,2,4]})," ",(0,r.jsx)("meshStandardMaterial",{color:"#EAC4D5",emissive:"#EAC4D5",emissiveIntensity:1.5,transparent:!0,opacity:.7})]}),[void 0,void 0,void 0,void 0].map((e,t)=>{let n=t/4*Math.PI*2;return(0,r.jsx)("group",{position:[.4*Math.sin(n+.003*Date.now()),.4*Math.cos(n+.003*Date.now()),-1.4],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.125,3,3]})," ",(0,r.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:1,transparent:!0,opacity:.5,blending:i.EZo})]})},"ghost-trail-".concat(t))}),[...Array(6)].map((e,t)=>(0,r.jsx)("group",{position:[0,0,-(.3*t)-1.5],rotation:[0,.001*Date.now()+t,0],children:(0,r.jsxs)("mesh",{scale:1-.015*t,children:[(0,r.jsx)("torusGeometry",{args:[.4,.1,3,6]})," ",(0,r.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:1,transparent:!0,opacity:.3,blending:i.EZo})]})},"wisp-".concat(t))),(0,r.jsx)("pointLight",{color:"#EAC4D5",intensity:3,distance:5,decay:2})]})]},e.id)),(0,r.jsx)(z,{parentRef:D,weaponType:c}),(0,r.jsx)(T,{parentRef:D}),eG.map(e=>{if("boneclaw"===e.type)return(0,r.jsx)(Q,{position:e.position,direction:e.direction,parentRef:D,enemyData:w,onComplete:()=>{eD(t=>t.filter(t=>t.id!==e.id))},onHitTarget:(e,t,r,s,i)=>{n(e,t),ea(e=>[...e,{id:ec.current++,damage:t,position:s.clone(),isCritical:r,isBoneclaw:i}])}},e.id);if("blizzard"===e.type)return(0,r.jsx)($,{position:e.position,enemyData:w,parentRef:D,onHitTarget:(e,t,r,s,i)=>{n(e,t),ea(e=>[...e,{id:ec.current++,damage:t,position:s.clone(),isCritical:r,isBlizzard:i}])},onComplete:()=>{eD(t=>t.filter(t=>t.id!==e.id))}},e.id);if("firebeam"===e.type)return(0,r.jsx)(en,{position:e.position,direction:e.direction,onComplete:()=>{eD(t=>t.filter(t=>t.id!==e.id))}},e.id);if("oathstrike"===e.type)return(0,r.jsx)(eo,{position:e.position,direction:e.direction,onComplete:()=>{eD(t=>t.filter(t=>t.id!==e.id))},parentRef:D},e.id);if("summon"===e.type)return(0,r.jsx)(ej,{position:e.position,enemyData:w,onDamage:(e,t,r)=>{n(e,t);let s=w.find(t=>t.id===e);s&&s.position&&ea(e=>[...e,{id:ec.current++,damage:t,position:r||s.position.clone(),isCritical:!1,isSummon:!0}])},id:e.id.toString(),onComplete:()=>{eD(t=>t.filter(t=>t.id!==e.id))},onStartCooldown:()=>{x(c,"active")},setActiveEffects:eD,activeEffects:eG,setDamageNumbers:ea,nextDamageNumberId:ec},e.id);if("frostExplosion"===e.type)return(0,r.jsx)(eI,{position:e.position,onComplete:()=>{eD(t=>t.filter(t=>t.id!==e.id))}},e.id);if("stealthStrike"===e.type)return(0,r.jsx)(ek,{position:e.position,direction:e.direction,onComplete:()=>{eD(t=>t.filter(t=>t.id!==e.id))},parentRef:D},e.id);return null}),(0,r.jsx)(es,{ref:to,parentRef:D,onHealthChange:ta,charges:eM,setCharges:ew,setDamageNumbers:ea,nextDamageNumberId:ec,currentHealth:u,maxHealth:d}),c===o.SWORD&&p[o.SWORD].passive.isUnlocked&&(0,r.jsx)(eh,{ref:eL,parentRef:D,onHealthChange:ta,setDamageNumbers:ea,nextDamageNumberId:ec,currentHealth:u,maxHealth:d}),eG.map(e=>{if("unitFireballExplosion"===e.type){let t=e.startTime?(Date.now()-e.startTime)/1e3:0,n=Math.max(0,1-t/(e.duration||.225));return(0,r.jsxs)("group",{position:e.position,children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.3*(1+2*t),32,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ff44",emissive:"#33ff66",emissiveIntensity:2*n,transparent:!0,opacity:.8*n,depthWrite:!1,blending:i.EZo})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.2*(1+3*t),24,24]}),(0,r.jsx)("meshStandardMaterial",{color:"#66ff88",emissive:"#ffffff",emissiveIntensity:3*n,transparent:!0,opacity:.9*n,depthWrite:!1,blending:i.EZo})]}),[.4,.6,.8].map((e,s)=>(0,r.jsxs)("mesh",{rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,r.jsx)("torusGeometry",{args:[e*(1+3*t),.045,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ff44",emissive:"#33ff66",emissiveIntensity:.8*n,transparent:!0,opacity:.5*n*(1-.2*s),depthWrite:!1,blending:i.EZo})]},s)),[...Array(8)].map((e,s)=>{let o=s/8*Math.PI*2,a=.5*(1+2*t);return(0,r.jsxs)("mesh",{position:[Math.sin(o)*a,Math.cos(o)*a,0],children:[(0,r.jsx)("sphereGeometry",{args:[.05,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#66ff88",emissive:"#ffffff",emissiveIntensity:1.85*n,transparent:!0,opacity:.85*n,depthWrite:!1,blending:i.EZo})]},"spark-".concat(s))}),(0,r.jsx)("pointLight",{color:"#00ff44",intensity:2*n,distance:4,decay:2}),(0,r.jsx)("pointLight",{color:"#66ff88",intensity:1*n,distance:6,decay:1})]},e.id)}return null}),U&&(0,r.jsxs)("group",{position:D.current?(()=>{let e=new i.Pq0(0,0,1).applyQuaternion(D.current.quaternion).multiplyScalar(2);return[D.current.position.x+e.x,.01,D.current.position.z+e.z]})():[0,.015,0],ref:e=>{e&&(null==D?void 0:D.current)&&(e.rotation.y=D.current.rotation.y)},children:[(0,r.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],position:[0,.15,15*eO-4.5],children:[(0,r.jsx)("planeGeometry",{args:[.4,30*eO-4]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:1,transparent:!0,opacity:.3+.4*eO,blending:i.EZo,depthWrite:!1})]}),[-.4,.4].map((e,t)=>(0,r.jsxs)("mesh",{position:[e,.1,7.5*eO+3.5],rotation:[-Math.PI/2,0,0],children:[(0,r.jsx)("planeGeometry",{args:[.125,15*eO+10]}),(0,r.jsx)("meshStandardMaterial",{color:"#80ffff",emissive:"#80ffff",emissiveIntensity:2,transparent:!0,opacity:.6*eO,blending:i.EZo,depthWrite:!1})]},t)),[...Array(10)].map((e,t)=>(0,r.jsxs)("mesh",{position:[0,.1,2.5*t*eO+(3*eO-2)],rotation:[-Math.PI/2,0,0],children:[(0,r.jsx)("planeGeometry",{args:[1,.1]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:1.5,transparent:!0,opacity:.4*eO*(1-.07*t),blending:i.EZo,depthWrite:!1})]},t))]}),c===o.SWORD&&p[o.SWORD].active.isUnlocked&&(0,r.jsx)(ev,{ref:eW,parentRef:D,enemies:w,onEnemyDamage:n,setDamageNumbers:ea,nextDamageNumberId:ec}),c===o.SABRES&&p[o.SABRES].active.isUnlocked&&(0,r.jsx)(eS,{ref:tl,parentRef:D,charges:eM,setCharges:ew}),c===o.SPEAR&&(0,r.jsx)(eF,{parentRef:D,isActive:e0,onHit:n,enemyData:w,setDamageNumbers:ea,nextDamageNumberId:ec,charges:eM,setCharges:ew}),e3.current.map(e=>(0,r.jsx)(eT,{position:e.position,direction:e.direction},e.id))]})}var eG=n(2433);let eD=new i._4j({color:"#e8e8e8",roughness:.4,metalness:.3}),eA=new i._4j({color:"#d4d4d4",roughness:.3,metalness:.4}),ez=new i.Gu$(.06,6,6),eq=new i.Ho_(.04,.032,1,5),eB=new i.qFE(.02,.15,5),eL=new i.kn4,eO=new i.Pq0,eH=new i.O9p,eN=new i.Pq0,eW=new i.PTz;function eU(e,t,n,r,s){eW.setFromEuler(r),eL.compose(n,eW,s),e.setMatrixAt(t,eL)}function eQ(e){let{isUpper:t=!0}=e,n=(0,s.useMemo)(()=>{let e=t?5:4,n=new i.ZLX(eB,eD,e);return n.instanceMatrix.setUsage(i.Vnu),n},[t]);return(0,s.useEffect)(()=>{(t?[-.03,-.06,-.09,0,.03]:[-.06,-.02,.02,.06]).forEach((e,r)=>{eO.set(e,t?-.25:-.18,.2),eH.set(t?.5:2.5,0,0),eN.set(1,1,1),eU(n,r,eO,eH,eN)}),n.instanceMatrix.needsUpdate=!0},[n,t]),(0,r.jsx)("primitive",{object:n})}function eY(){let e=(0,s.useMemo)(()=>{let e=new i.ZLX(new i.iNn(.12,.19,.02),eA,4);return e.instanceMatrix.setUsage(i.Vnu),e},[]);return(0,s.useEffect)(()=>{for(let t=0;t<4;t++){let n=t*Math.PI/2;eO.set(.11*Math.cos(n),0,.11*Math.sin(n)),eH.set(0,n+Math.PI/6,0),eN.set(1,1,1),eU(e,t,eO,eH,eN)}e.instanceMatrix.needsUpdate=!0},[e]),(0,r.jsx)("primitive",{object:e})}function eZ(){return(0,r.jsx)("group",{children:(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.123,.19,.175,6,1,!1,0,2*Math.PI]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsx)(eY,{}),(0,r.jsxs)("mesh",{position:[0,.22,0],rotation:[Math.PI/2,Math.PI,Math.PI/2],children:[(0,r.jsx)("torusGeometry",{args:[.065,.02,3,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.5})]}),(0,r.jsxs)("mesh",{position:[0,0,0],rotation:[Math.PI/2,Math.PI,Math.PI/2],children:[(0,r.jsx)("torusGeometry",{args:[.16,.02,4,5]}),(0,r.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.5})]}),(0,r.jsxs)("mesh",{position:[0,-.1,0],rotation:[Math.PI/2,Math.PI,Math.PI/2],children:[(0,r.jsx)("torusGeometry",{args:[.2,.02,4,5]}),(0,r.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.5})]}),(0,r.jsxs)("mesh",{position:[0,.1,0],rotation:[Math.PI/2,Math.PI,Math.PI/2],children:[(0,r.jsx)("torusGeometry",{args:[.125,.0175,6,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.5})]})]})})}function eV(){let e=(e,t)=>(0,r.jsx)("mesh",{geometry:eq,material:eD,scale:[t/.04,e,t/.04]}),t=e=>(0,r.jsx)("mesh",{geometry:ez,material:eD,scale:[e/.06,e/.06,e/.06]}),n=(n,s)=>(0,r.jsxs)("group",{children:[(0,r.jsx)("group",{position:[s/2,0,0],children:e(n,.04)}),(0,r.jsx)("group",{position:[-s/2,0,0],children:e(n,.04)}),(0,r.jsx)("group",{position:[0,n/2,0],children:t(.06)}),(0,r.jsx)("group",{position:[0,-n/2,0],children:t(.06)})]});return(0,r.jsx)("group",{children:(0,r.jsxs)("group",{children:[n(.65,.05),(0,r.jsxs)("group",{position:[0,-.35,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.08,12,12]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("group",{position:[0,-.15,0],children:[n(.7,.06),(0,r.jsxs)("group",{position:[0,-.25,0],rotation:[Math.PI/2,0,0],children:[t(.06),(0,r.jsxs)("group",{position:[0,-.015,.1],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("boxGeometry",{args:[.15,.02,.4]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),[-.05,0,.05].map((e,t)=>(0,r.jsx)("group",{position:[e,.15,.25],rotation:[-Math.PI,0,0],children:(0,r.jsxs)("group",{children:[n(.15,.02),(0,r.jsx)("group",{position:[0,-.1,0],rotation:[Math.PI/6,0,0],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("coneGeometry",{args:[.02,.15,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})})]})},t))]})]})]})]})]})})}function eK(e){let{isLeftHand:t=!1}=e,n=(e,t)=>(0,r.jsx)("mesh",{geometry:eq,material:eD,scale:[t/.04,e,t/.04]}),s=e=>(0,r.jsx)("mesh",{geometry:ez,material:eD,scale:[e/.06,e/.06,e/.06]}),i=(e,t)=>(0,r.jsxs)("group",{children:[(0,r.jsx)("group",{position:[t/2,0,0],children:n(e,.06)}),(0,r.jsx)("group",{position:[-t/2,0,0],children:n(e,.06)}),(0,r.jsx)("group",{position:[0,e/2,0],children:s(.08)}),(0,r.jsx)("group",{position:[0,-e/2,0],children:s(.08)})]});return(0,r.jsx)("group",{children:(0,r.jsxs)("group",{children:[i(1.3,.15),(0,r.jsxs)("group",{position:[.25,-.85,.21],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.12,12,12]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("group",{rotation:[-.7,-0,Math.PI/5],children:[i(.8,.12),(0,r.jsxs)("group",{position:[0,-.5,0],rotation:[0,0,Math.PI/5.5],children:[s(.09),(0,r.jsxs)("group",{position:[0,-.1,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("boxGeometry",{args:[.2,.15,.08]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4})]}),[-.08,0,.08].map((e,t)=>(0,r.jsxs)("group",{position:[e,-.1,0],rotation:[0,0,(t-1)*Math.PI/8],children:[n(.5,.02),(0,r.jsx)("group",{position:[.025,-.3,0],rotation:[0,0,Math.PI+Math.PI/16],children:(0,r.jsx)("mesh",{geometry:eB,material:eA})})]},t)),!t&&(0,r.jsx)("group",{position:[0,-.2,.3],rotation:[Math.PI/2,0,0],scale:[.8,.8,.8],children:(0,r.jsx)(e$,{})})]})]})]})]})]})})}function e$(){let e={color:"#FF4C4C",emissive:"#4ECB7E",emissiveIntensity:.5,roughness:.4,metalness:.6};return(0,r.jsxs)("group",{rotation:[0,-1.05,-Math.PI/2.5],position:[.3,-.1,.75],scale:[.9,.9,1.2],children:[(0,r.jsxs)("mesh",{position:[0,0,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.125,.125,3.35,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#8b0000",roughness:.4,metalness:.3})]}),(0,r.jsxs)("mesh",{position:[0,-.25,0],rotation:[Math.PI/2,-Math.PI/2,Math.PI/2],children:[(0,r.jsx)("cylinderGeometry",{args:[.3,.3,.125]}),(0,r.jsx)("meshStandardMaterial",{color:"#4ECB7E",roughness:.4,metalness:.5})]}),(0,r.jsxs)("mesh",{position:[0,1,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.325,.125,2.9,4]}),(0,r.jsx)("meshStandardMaterial",{...e})]}),(0,r.jsxs)("mesh",{position:[0,3.45,0],children:[(0,r.jsx)("coneGeometry",{args:[.325,2,4]}),(0,r.jsx)("meshStandardMaterial",{...e})]}),(0,r.jsx)("pointLight",{color:"#FF4D00",intensity:.3,distance:3,decay:2.5})]})}function eX(e){let{position:t,isAttacking:n,isWalking:o,onHit:a}=e,l=(0,s.useRef)(null),[c,u]=(0,s.useState)(0),[h,d]=(0,s.useState)(0),m=(0,s.useRef)();return(0,f.F)((e,r)=>{if(!l.current)return;let s=l.current;if(o){let e=(c+4*r)%(2*Math.PI);u(e);let n=Math.abs(.1*Math.sin(e));s.position.y=t[1]-n;let o=new i.O9p;["LeftLeg","RightLeg"].forEach(t=>{var n;let r=s.getObjectByName(t);if(!r)return;let i=t.includes("Right")?e:e+Math.PI,a=Math.sin(i);o.set(.4*a,.05*Math.sin(i),0),r.rotation.copy(o);let l=.4*Math.sin(i);r.rotation.x=l;let c=null===(n=r.children[0])||void 0===n?void 0:n.children[1];if(c){let e=Math.max(0,Math.sin(i+Math.PI/4));c.rotation.x=.2+.8*e;let t=.1*Math.sin(i);c.rotation.y=t}let u=.05*Math.sin(i);r.rotation.y=u}),["LeftArm","RightArm"].forEach(t=>{let n=s.getObjectByName(t);if(n){let r=.1*Math.sin(t.includes("Right")?e+Math.PI:e);n.rotation.x=r}})}if(n){d(e=>e+3*r);let e=Math.sin(Math.min(h,Math.PI/2))*Math.PI,t=s.getObjectByName("RightArm");t&&(t.rotation.x=-e),h>Math.PI/4&&a&&!m.current&&(m.current=setTimeout(()=>{m.current=void 0},0)),h>Math.PI/2&&d(0)}else m.current&&(clearTimeout(m.current),m.current=void 0)}),(0,s.useEffect)(()=>()=>{m.current&&clearTimeout(m.current)},[]),(0,s.useEffect)(()=>()=>{eD.dispose(),eA.dispose(),ez.dispose(),eq.dispose(),eB.dispose()},[]),(0,r.jsxs)("group",{ref:l,position:[t[0],t[1]+1,t[2]],children:[(0,r.jsx)("group",{name:"Body",position:[0,1.05,0],scale:[.95,.8,.8],rotation:[-.2,0,0],children:(0,r.jsx)(_,{})}),(0,r.jsxs)("group",{name:"Head",position:[0,1.775,.1],scale:[.75,.8,.8],children:[(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{position:[0,0,-.05],children:[(0,r.jsx)("sphereGeometry",{args:[.22,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("mesh",{position:[0,-.02,.12],children:[(0,r.jsx)("boxGeometry",{args:[.28,.28,.1]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{position:[.12,-.08,.1],children:[(0,r.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("mesh",{position:[-.12,-.08,.1],children:[(0,r.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})]}),(0,r.jsx)("group",{position:[0,-.15,.05],children:(0,r.jsxs)("mesh",{position:[0,-.08,.08],rotation:[0,Math.PI/5,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.08,.08,.2,5]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})}),(0,r.jsx)("group",{position:[.025,-.25,.2175],children:(0,r.jsx)(eQ,{isUpper:!0})}),(0,r.jsx)("group",{position:[0,-.18,.2],children:(0,r.jsx)(eQ,{isUpper:!1})})]}),(0,r.jsxs)("group",{position:[0,.05,.14],children:[(0,r.jsxs)("group",{position:[-.07,0,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.02,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:3})]}),(0,r.jsxs)("mesh",{scale:1.2,children:[(0,r.jsx)("sphereGeometry",{args:[.035,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.75})]}),(0,r.jsxs)("mesh",{scale:1.4,children:[(0,r.jsx)("sphereGeometry",{args:[.05,6.5,2]}),(0,r.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.7})]}),(0,r.jsx)("pointLight",{color:"#FF4C4C",intensity:.75,position:[0,0,0],distance:1.5,decay:2})]}),(0,r.jsxs)("group",{position:[.07,0,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.02,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:3})]}),(0,r.jsxs)("mesh",{scale:1.2,children:[(0,r.jsx)("sphereGeometry",{args:[.035,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.75})]}),(0,r.jsxs)("mesh",{scale:1.4,children:[(0,r.jsx)("sphereGeometry",{args:[.05,6.5,2]}),(0,r.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.7})]}),(0,r.jsx)("pointLight",{color:"#FF4C4C",intensity:.75,position:[0,0,0],distance:1.5,decay:2})]})]})]}),(0,r.jsx)("group",{position:[-.34,1.475,0],rotation:[-.35,-Math.PI-.4,-.35],children:(0,r.jsx)(eZ,{})}),(0,r.jsx)("group",{position:[.34,1.475,0],rotation:[-.35,Math.PI-.4,.35],children:(0,r.jsx)(eZ,{})}),(0,r.jsx)("group",{name:"LeftArm",position:[-.35,1.325,0],scale:[-.45,.45,.45],rotation:[0,Math.PI/3,0],children:(0,r.jsx)(eK,{isLeftHand:!0})}),(0,r.jsx)("group",{name:"RightArm",position:[.35,1.525,.1],scale:[.45,.45,.45],rotation:[0,-Math.PI/2.5,0],children:(0,r.jsx)(eK,{isLeftHand:!1})}),(0,r.jsxs)("group",{position:[0,.6,0],scale:[1.4,1,.8],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.21,.2,.2,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),[-1,1].map(e=>(0,r.jsx)("group",{position:[.15*e,-.1,0],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.075,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})},e))]}),(0,r.jsx)("group",{name:"LeftLeg",position:[.2,.2725,0],children:(0,r.jsx)(eV,{})}),(0,r.jsx)("group",{name:"RightLeg",position:[-.2,.2725,0],children:(0,r.jsx)(eV,{})}),(0,r.jsx)("group",{position:[0,1.2,0],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.04,.04,.2,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})})]})}let eJ=()=>(0,r.jsx)("group",{children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.03,.025,.3,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#F33FAE",transparent:!0,opacity:.55,emissive:"#FF0000",emissiveIntensity:.75})]})});function e0(e){let{position:t,onComplete:n,isSpawning:i=!1,scale:o=1}=e,a=(0,s.useRef)([]),l=1.15*o,c=2.75*o,u=(0,s.useRef)(null),h=(0,s.useRef)(Date.now());return(0,f.F)(()=>{if(!u.current)return;let e=Date.now()-h.current,r=Math.min(e/1500,1),s=i?1-r:r;u.current.position.copy(t),a.current.forEach((t,n)=>{let r=Math.floor(n/10)/11,i=l*r*(s<.5?2*s:2-2*s),o=n%10/10*Math.PI*2+.006*(1+3*r)*e,a=Math.cos(o+2*r)*i,u=Math.sin(o+2*r)*i,h=(1-r)*c*(1+.1*Math.sin(.002*e));t.position.set(a,h,u),t.rotation.y=o+Math.PI/2,t.rotation.z=Math.PI/2+.8*r,t.rotation.x=.2*Math.sin(.004*e+n);let d=t.material;d.opacity=Math.max(0,.7-.4*r-(s>.7?(s-.7)*3:0)),d.emissiveIntensity=.5+.3*Math.sin(.004*e+n);let m=1+.2*Math.sin(.003*e+.5*n);t.scale.set(m,m,m)}),1===r&&n&&n()}),(0,r.jsx)("group",{ref:u,children:Array.from({length:120}).map((e,t)=>(0,r.jsx)("mesh",{ref:e=>{e&&(a.current[t]=e)},children:eJ()},t))})}let e1=e=>{switch(e){case o.SCYTHE:return"#00FF4D";case o.SWORD:return"#FFD700";case o.SABRES:return"#00BBFF";case o.SPEAR:return"#F33FAE";default:return"#00ff44"}},e2=e=>{let t=e1(e);return(0,r.jsx)("group",{children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.03,.025,.3,8]}),(0,r.jsx)("meshStandardMaterial",{color:t,transparent:!0,opacity:.525,emissive:t,emissiveIntensity:.75})]})})};function e5(e){let{position:t,onComplete:n,isSpawning:i=!1,weaponType:o}=e,a=(0,s.useRef)([]),l=(0,s.useRef)(null),c=(0,s.useRef)(Date.now());return(0,f.F)(()=>{if(!l.current)return;let e=Date.now()-c.current,r=Math.min(e/1500,1),s=i?1-r:r;l.current.position.set(t.x,0,t.z),a.current.forEach((t,n)=>{let r=Math.floor(n/10)/11,i=1.15*r*(s<.5?2*s:2-2*s),o=n%10/10*Math.PI*2+.006*(1+3*r)*e,a=Math.cos(o+2*r)*i,l=Math.sin(o+2*r)*i,c=(1-r)*2.75*(1+.1*Math.sin(.002*e));t.position.set(a,c,l),t.rotation.y=o+Math.PI/2,t.rotation.z=Math.PI/2+.8*r,t.rotation.x=.2*Math.sin(.004*e+n);let u=t.material;u.opacity=Math.max(0,.7-.4*r-(s>.7?(s-.7)*3:0)),u.emissiveIntensity=.5+.3*Math.sin(.004*e+n);let h=1+.2*Math.sin(.003*e+.5*n);t.scale.set(h,h,h)}),1===r&&n&&n()}),(0,r.jsx)("group",{ref:l,children:Array.from({length:120}).map((e,t)=>(0,r.jsx)("mesh",{ref:e=>{e&&(a.current[t]=e)},children:e2(o)},t))})}let e3={skeleton:null,mage:null,abomination:null,tree:null,mountain:null,mushroom:null,boss:null,player:null},e8={skeleton:null,mage:null,abomination:null,tree:null,mountain:null,mushroom:null,bossMaterial:null,playerMaterial:null};function e4(){e3.skeleton||(Object.keys(e3).forEach(e=>{e3[e]=new i.LoY}),Object.keys(e8).forEach(e=>{e8[e]=new i._4j}))}function e6(){Object.values(e3).forEach(e=>null==e?void 0:e.dispose()),Object.values(e8).forEach(e=>null==e?void 0:e.dispose())}let e7=s.memo(function(e){let{id:t,initialPosition:n,position:a,health:l,maxHealth:c,onTakeDamage:u,onPositionUpdate:h,playerPosition:d,onAttackPlayer:m,weaponType:p}=e,x=(0,s.useRef)(null),g=(0,s.useRef)(Date.now()+2e3),[j,y]=(0,s.useState)(!1),[M,v]=(0,s.useState)(!1),[w,P]=(0,s.useState)(!1),[S,I]=(0,s.useState)(!0),[F,C]=(0,s.useState)(!1),[E,k]=(0,s.useState)(!1),R=(0,s.useRef)(n.clone().setY(0)),T=(0,s.useRef)(n.clone().setY(0)),_=(0,s.useRef)(Date.now()),G=(0,s.useRef)(l),D=(0,s.useRef)(new i.Pq0),A=(0,s.useRef)(0),z=(0,s.useRef)(null),q=(0,s.useRef)(Date.now()),L=(0,s.useCallback)(()=>{if(!x.current)return null;let e=Math.random()*Math.PI*2,t=5*Math.random();return new i.Pq0(R.current.x+Math.cos(e)*t,0,R.current.z+Math.sin(e)*t)},[]);(0,s.useEffect)(()=>{G.current=l},[l]);let O=(0,s.useCallback)((e,n)=>{if(G.current<=0)return;let r=Math.max(0,G.current-e);u("enemy-".concat(t),e),0===r&&G.current>0&&(P(!0),v(!0)),n.type===o.SABRES&&n.hasActiveAbility&&k(!0)},[t,u]);(0,s.useEffect)(()=>{a&&(R.current.copy(a),R.current.y=0,T.current.copy(R.current),x.current&&x.current.position.copy(R.current))},[a]);let H=(0,s.useCallback)((e,t)=>{x.current&&h(e,t.clone(),x.current.rotation.y)},[h]);return(0,f.F)((e,n)=>{if(!x.current||G.current<=0||!d){C(!1);return}let r=R.current.distanceTo(d);if(B.isUnitStealthed()){y(!1);let e=Date.now();if(!z.current||e-q.current>4500){if(z.current){let e=new i.Pq0().subVectors(z.current,R.current).normalize(),t=new i.Pq0().copy(R.current).add(e.multiplyScalar(5));z.current=t}else z.current=L();q.current=e}if(z.current){C(!0);let e=new i.Pq0().subVectors(z.current,R.current).normalize(),t=e.multiplyScalar(1.0799999999999998*n);D.current.lerp(t,3*n),R.current.add(D.current),R.current.y=0,x.current.position.copy(R.current);let r=Math.atan2(e.x,e.z)-x.current.rotation.y;for(;r>Math.PI;)r-=2*Math.PI;for(;r<-Math.PI;)r+=2*Math.PI;x.current.rotation.y+=r*Math.min(1,4*n)}return}if(B.isUnitStealthed()){C(!1),y(!1);return}if(r>2.25&&G.current>0){var s;y(!1),C(!0);let e=new i.Pq0().subVectors(d,R.current).normalize(),t=new i.Pq0;((null===(s=x.current.parent)||void 0===s?void 0:s.children.filter(e=>e!==x.current&&e.position&&1.25>e.position.distanceTo(R.current)))||[]).forEach(e=>{let n=R.current.clone().setY(0),r=e.position.clone().setY(0),s=new i.Pq0().subVectors(n,r).normalize().multiplyScalar(.155/Math.max(.1,r.distanceTo(n)));t.add(s)});let r=e.add(t).normalize();r.y=0;let o=r.multiplyScalar(2.1*n);D.current.lerp(o,6*n),R.current.add(D.current),R.current.y=0,x.current.position.copy(R.current);let a=new i.Pq0().copy(d).setY(R.current.y);A.current=Math.atan2(a.x-R.current.x,a.z-R.current.z);let l=x.current.rotation.y,c=A.current-l;for(;c>Math.PI;)c-=2*Math.PI;for(;c<-Math.PI;)c+=2*Math.PI;x.current.rotation.y+=c*Math.min(1,8*n)}else C(!1),D.current.multiplyScalar(1-8*n),D.current.length()>.001&&(R.current.add(D.current),x.current.position.copy(R.current));if(r<=2.25&&G.current>0){let e=Date.now();if(e-g.current>=2500){y(!0);let t=R.current.clone();setTimeout(()=>{let e=R.current.distanceTo(d);G.current>0&&e<=2.25&&.75>t.distanceTo(R.current)&&m(0)},935),g.current=e,setTimeout(()=>{y(!1)},500)}}let o=Date.now();o-_.current>=50&&R.current.distanceTo(a)>.1&&(H(t,R.current.clone()),_.current=o)}),(0,s.useEffect)(()=>{0===l&&!w&&(P(!0),v(!0),x.current&&(x.current.visible=!0))},[l,w]),(0,s.useEffect)(()=>{if(w){let e=setTimeout(()=>{var e;v(!1),(null===(e=x.current)||void 0===e?void 0:e.parent)&&x.current.parent.remove(x.current)},3e3);return()=>clearTimeout(e)}},[w]),(0,s.useEffect)(()=>{let e=()=>{C(!0)};return window.addEventListener("stealthBreak",e),()=>{window.removeEventListener("stealthBreak",e)}},[]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("group",{ref:x,visible:!S&&G.current>0,position:R.current,onClick:e=>{e.stopPropagation()},children:[(0,r.jsx)(eX,{position:[0,.795,0],isAttacking:j,isWalking:F&&G.current>0,onHit:e=>O(e,{type:p})}),(0,r.jsx)(eG.Q,{position:[0,3.5,0],follow:!0,lockX:!1,lockY:!1,lockZ:!1,children:G.current>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("mesh",{position:[0,0,0],children:[(0,r.jsx)("planeGeometry",{args:[2,.25]}),(0,r.jsx)("meshBasicMaterial",{color:"#333333",opacity:.8,transparent:!0})]}),(0,r.jsxs)("mesh",{position:[-1+G.current/c,0,.001],children:[(0,r.jsx)("planeGeometry",{args:[G.current/c*2,.23]}),(0,r.jsx)("meshBasicMaterial",{color:"#ff3333",opacity:.9,transparent:!0})]}),(0,r.jsx)(b.E,{position:[0,0,.002],fontSize:.2,color:"#ffffff",anchorX:"center",anchorY:"middle",fontWeight:"bold",children:"".concat(Math.ceil(G.current),"/").concat(c)})]})})]}),S&&(0,r.jsx)(e0,{position:R.current,onComplete:()=>{I(!1)},isSpawning:!0}),M&&(0,r.jsx)(e5,{position:R.current,onComplete:()=>{v(!1)},isSpawning:!1,weaponType:p}),E&&(0,r.jsx)(eI,{position:a,onComplete:()=>k(!1)})]})},(e,t)=>e.health===t.health&&e.position.equals(t.position)&&e.playerPosition.equals(t.playerPosition));e3.skeleton,e8.skeleton;let e9=()=>{let e=(0,f.H)(i.Tap,"/textures/ring-alpha.jpg"),t=(0,s.useRef)(null),n=(0,s.useRef)(null),o=(0,s.useMemo)(()=>new i.Gu$(1,32,32),[]),a=(0,s.useMemo)(()=>new i.rKP(1.4,2.1,64),[]),l=(0,s.useMemo)(()=>new i._4j({color:"#B8E0D2",roughness:.7,metalness:.2,emissive:"#B8E0D2",emissiveIntensity:.675}),[]),c=(0,s.useMemo)(()=>new i.V9B({color:"#4dff90",transparent:!0,opacity:.5}),[]);return(0,f.F)((e,r)=>{if(t.current&&(t.current.rotation.z+=.006*r),n.current){let t=new i.PPD,r=new i.kn4().multiplyMatrices(e.camera.projectionMatrix,e.camera.matrixWorldInverse);t.setFromProjectionMatrix(r);let s=new i.iyt(n.current.position,24*Math.sqrt(3));n.current.visible=t.intersectsSphere(s)}}),(0,r.jsxs)("group",{ref:n,position:[100,80,-150],scale:[24,24,24],rotation:[1,.1,.1],children:[(0,r.jsx)("mesh",{geometry:o,material:l}),(0,r.jsx)("mesh",{ref:t,rotation:[Math.PI/2.8,0,0],geometry:a,children:(0,r.jsx)("meshStandardMaterial",{map:e,color:"#A8DBFF",transparent:!0,opacity:1,side:i.$EB,alphaMap:e,roughness:.7,metalness:.2,emissive:"#77FFC0",emissiveIntensity:1.1})}),(0,r.jsx)("mesh",{scale:[1.05,1.05,1.05],geometry:o,material:c}),(0,r.jsx)("mesh",{scale:[1.1,1.1,1.1],geometry:o,children:(0,r.jsx)("meshBasicMaterial",{color:"#4dff90",transparent:!0,opacity:.2,side:i.hsX})})]})},te={uniforms:{topColor:{value:new i.Q1f("#1500FF")},middleColor:{value:new i.Q1f("#FF79AF")},bottomColor:{value:new i.Q1f("#FFCDA2")},offset:{value:33},exponent:{value:.6}},vertexShader:"\n    varying vec3 vWorldPosition;\n    \n    void main() {\n      vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n      vWorldPosition = worldPosition.xyz;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n  ",fragmentShader:"\n    uniform vec3 topColor;\n    uniform vec3 middleColor;\n    uniform vec3 bottomColor;\n    uniform float offset;\n    uniform float exponent;\n    \n    varying vec3 vWorldPosition;\n    \n    void main() {\n      float h = normalize(vWorldPosition + vec3(0.0, offset, 0.0)).y;\n      float mixStrength = max(pow(max(h, 0.0), exponent), 0.0);\n      vec3 color = mix(middleColor, topColor, mixStrength);\n      color = mix(bottomColor, color, smoothstep(0.0, 1.0, h));\n      gl_FragColor = vec4(color, 1.0);\n    }\n  "},tt=()=>{let e=(0,s.useMemo)(()=>({uniforms:te.uniforms,vertexShader:te.vertexShader,fragmentShader:te.fragmentShader,side:i.hsX}),[]);return(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[500,32,32]}),(0,r.jsx)("shaderMaterial",{attach:"material",args:[e]})]})},tn=()=>{let e=[];for(let t=0;t<12;t++){let n=t/12*Math.PI*2,r=51+(4*Math.random()-2),s=Math.cos(n)*r,o=Math.sin(n)*r,a=.75+.4*Math.random();e.push({position:new i.Pq0(s,0,o),scale:a});let l=n+Math.PI/12,c=39*Math.cos(l),u=39*Math.sin(l);e.push({position:new i.Pq0(c,0,u),scale:.9*a})}return e},tr=()=>[{position:new i.Pq0(-15,0,-5),scale:1.3,trunkColor:new i.Q1f("#B89F89"),leafColor:new i.Q1f("#FFA1E0").multiplyScalar(3.5)},{position:new i.Pq0(-12,0,-8),scale:1.25,trunkColor:new i.Q1f("#B89F89"),leafColor:new i.Q1f("#FFA1E0").multiplyScalar(3.5)},{position:new i.Pq0(-12,0,-13.5),scale:.8,trunkColor:new i.Q1f("#B89F89"),leafColor:new i.Q1f("#8AFF7B").multiplyScalar(3.5)},{position:new i.Pq0(16,0,-10),scale:1,trunkColor:new i.Q1f("#B89F89"),leafColor:new i.Q1f("#8AFF7B").multiplyScalar(3.5)},{position:new i.Pq0(12,0,8),scale:1.25,trunkColor:new i.Q1f("#B89F89"),leafColor:new i.Q1f("#8AFF7B").multiplyScalar(3.5)},{position:new i.Pq0(-11,0,5),scale:1.3,trunkColor:new i.Q1f("#B89F89"),leafColor:new i.Q1f("#8AFF7B").multiplyScalar(3.5)},{position:new i.Pq0(12,0,-8),scale:1.25,trunkColor:new i.Q1f("#B89F89"),leafColor:new i.Q1f("#8AFF7B").multiplyScalar(3.5)},{position:new i.Pq0(18,0,-8),scale:1.1,trunkColor:new i.Q1f("#C69155"),leafColor:new i.Q1f("#FFA1E0").multiplyScalar(3.5)},{position:new i.Pq0(17.5,0,-10),scale:.9,trunkColor:new i.Q1f("#C69155"),leafColor:new i.Q1f("#73D0FF").multiplyScalar(3.5)},{position:new i.Pq0(15,0,-11.5),scale:1.1,trunkColor:new i.Q1f("#C69155"),leafColor:new i.Q1f("#73D0FF").multiplyScalar(3.5)},{position:new i.Pq0(16.5,0,-6.5),scale:1,trunkColor:new i.Q1f("#C69155"),leafColor:new i.Q1f("#73D0FF").multiplyScalar(3.5)},{position:new i.Pq0(-12,0,12),scale:.8,trunkColor:new i.Q1f("#C69155"),leafColor:new i.Q1f("#73D0FF").multiplyScalar(3.5)},{position:new i.Pq0(12,0,12),scale:.8,trunkColor:new i.Q1f("#AC8F75"),leafColor:new i.Q1f("#FFA1E0").multiplyScalar(3.5)},{position:new i.Pq0(-5,0,-15),scale:.85,trunkColor:new i.Q1f("#B89F89"),leafColor:new i.Q1f("#8AFF7B").multiplyScalar(3.5)},{position:new i.Pq0(5,0,-18),scale:.85,trunkColor:new i.Q1f("#C69155"),leafColor:new i.Q1f("#73D0FF").multiplyScalar(3.5)}],ts=()=>{let e=[],t=tr();for(let n=0;n<30;n++){let n,r,s;let o=.375+.175*Math.random();if(.7>Math.random()&&t.length>0){let e=t[Math.floor(Math.random()*t.length)],s=Math.random()*Math.PI*2,i=4*Math.random();n=e.position.x+Math.cos(s)*i,r=e.position.z+Math.sin(s)*i}else{let e=Math.random()*Math.PI*2,t=48*Math.random();n=t*Math.cos(e),r=t*Math.sin(e)}let a=100*Math.random();s=a<33.33?"pink":a<66.66?"green":"blue",e.push({position:new i.Pq0(n,0,r),scale:o,variant:s})}return e},ti=()=>{let e=Math.random()*Math.PI*2,t=15.5*Math.random(),n=Math.cos(e)*t,r=Math.sin(e)*t;return new i.Pq0(n,0,r)},to=e=>{let{trees:t}=e,n=(0,s.useRef)(null),o=(0,s.useRef)([]);return(0,s.useEffect)(()=>{if(!n.current)return;let e=new i.kn4;t.forEach((t,r)=>{var s;e.makeTranslation(t.position.x,t.position.y,t.position.z),e.scale(new i.Pq0(.9*t.scale,.9*t.scale,.9*t.scale)),null===(s=n.current)||void 0===s||s.setMatrixAt(r,e)}),n.current.instanceMatrix&&(n.current.instanceMatrix.needsUpdate=!0),o.current.forEach((n,r)=>{n&&(t.forEach((t,s)=>{let o=[{posY:2.24,size:1.35,height:1.7},{posY:2.76,size:1.08,height:1.36},{posY:3.4,size:.756,height:1.36},{posY:3.62,size:.709,height:.765}][r];e.makeTranslation(t.position.x,o.posY*t.scale,t.position.z),e.scale(new i.Pq0(.9*t.scale,.9*t.scale,.9*t.scale)),n.setMatrixAt(s,e);let a=t.leafColor.clone().multiplyScalar(1.5);n.setColorAt(s,a)}),n.instanceMatrix.needsUpdate=!0,n.instanceColor&&(n.instanceColor.needsUpdate=!0))})},[t]),(0,r.jsxs)("group",{children:[(0,r.jsxs)("instancedMesh",{args:[void 0,void 0,t.length],ref:n,frustumCulled:!1,children:[(0,r.jsx)("cylinderGeometry",{args:[.25,.30625,4,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#FFBD83",roughness:.6,metalness:.2,emissive:"#FFBD83",emissiveIntensity:0})]}),[{posY:.56,size:1.35,height:1.7,emissiveIntensity:1},{posY:.69,size:1.08,height:1.36,emissiveIntensity:1.1},{posY:.85,size:.756,height:1.36,emissiveIntensity:1.2},{posY:.905,size:.709,height:.765,emissiveIntensity:1.3}].map((e,n)=>(0,r.jsxs)("instancedMesh",{args:[void 0,void 0,t.length],ref:e=>{o.current[n]=e},frustumCulled:!1,children:[(0,r.jsx)("coneGeometry",{args:[e.size,e.height,8]}),(0,r.jsx)("meshStandardMaterial",{roughness:.3,metalness:.2,emissiveIntensity:e.emissiveIntensity,transparent:!0,opacity:.95})]},"foliage-".concat(n)))]})},ta=e=>{let{mountains:t}=e,n=(0,s.useRef)(null),o=(0,s.useRef)(null),a=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(!n.current||!o.current||!a.current)return;let e=new i.kn4;t.forEach((t,r)=>{var s;e.makeTranslation(t.position.x,t.position.y,t.position.z);let o=new i.kn4().makeScale(t.scale,t.scale,t.scale);e.multiply(o),null===(s=n.current)||void 0===s||s.setMatrixAt(r,e)}),t.forEach((t,n)=>{var r;let s=new i.kn4().makeRotationFromEuler(new i.O9p(0,.5,.1)),a=-4*t.scale,l=-5*t.scale,c=-2*t.scale;e.makeTranslation(t.position.x+a,t.position.y+l,t.position.z+c);let u=new i.kn4().makeScale(t.scale,t.scale,t.scale);e.multiply(s).multiply(u),null===(r=o.current)||void 0===r||r.setMatrixAt(n,e)}),t.forEach((t,n)=>{var r;e.makeTranslation(t.position.x,t.position.y+14*t.scale,t.position.z);let s=new i.kn4().makeScale(.9*t.scale,t.scale,.9*t.scale);e.multiply(s),null===(r=a.current)||void 0===r||r.setMatrixAt(n,e)}),n.current.instanceMatrix.needsUpdate=!0,o.current.instanceMatrix.needsUpdate=!0,a.current.instanceMatrix.needsUpdate=!0},[t]),(0,r.jsxs)("group",{children:[(0,r.jsxs)("instancedMesh",{args:[void 0,void 0,t.length],ref:n,castShadow:!0,receiveShadow:!0,children:[(0,r.jsx)("coneGeometry",{args:[23,35,12]}),(0,r.jsx)("meshPhysicalMaterial",{color:"#2a2a2a",metalness:.1,roughness:1,emissive:"#222222",flatShading:!0,clearcoat:.1,clearcoatRoughness:.8})]}),(0,r.jsxs)("instancedMesh",{args:[void 0,void 0,t.length],ref:o,castShadow:!0,children:[(0,r.jsx)("coneGeometry",{args:[24,28,12]}),(0,r.jsx)("meshPhysicalMaterial",{color:"#252525",metalness:.05,roughness:1,flatShading:!0,clearcoat:.1,clearcoatRoughness:.9})]}),(0,r.jsxs)("instancedMesh",{args:[void 0,void 0,t.length],ref:a,castShadow:!0,children:[(0,r.jsx)("coneGeometry",{args:[5,8,12]}),(0,r.jsx)("meshPhysicalMaterial",{color:"#ffffff",metalness:.1,roughness:.3,flatShading:!0,clearcoat:.4,clearcoatRoughness:.2,envMapIntensity:1.5})]})]})},tl=e=>{let{mushrooms:t}=e,n=(0,s.useRef)(null),o=(0,s.useRef)(null),a=(0,s.useRef)(null),l=(0,s.useMemo)(()=>({pink:{main:new i.Q1f("#FAA9C5").multiplyScalar(4.5),spots:new i.Q1f("#FAA9C5").multiplyScalar(4.5)},green:{main:new i.Q1f("#FF8DC6").multiplyScalar(2.5),spots:new i.Q1f("#92E2FF").multiplyScalar(2.5)},blue:{main:new i.Q1f("#92E2FF").multiplyScalar(2.5),spots:new i.Q1f("#92E2FF").multiplyScalar(2.5)}}),[]);return(0,s.useEffect)(()=>{if(!n.current||!o.current||!a.current)return;let e=new i.kn4;t.forEach((t,r)=>{var s,o;e.makeTranslation(t.position.x,t.position.y,t.position.z),e.scale(new i.Pq0(.8*t.scale,.8*t.scale,.8*t.scale)),null===(s=n.current)||void 0===s||s.setMatrixAt(r,e),null===(o=n.current)||void 0===o||o.setColorAt(r,l[t.variant].main.clone().multiplyScalar(.9))}),t.forEach((t,n)=>{var r,s;e.makeTranslation(t.position.x,t.position.y+.35*t.scale*.8,t.position.z),e.scale(new i.Pq0(.8*t.scale,.8*t.scale,.8*t.scale)),null===(r=o.current)||void 0===r||r.setMatrixAt(n,e),null===(s=o.current)||void 0===s||s.setColorAt(n,l[t.variant].main)}),t.forEach((t,n)=>{for(let o=0;o<6;o++){var r,s;let c=o*Math.PI/3,u=6*n+o;e.makeTranslation(t.position.x+.15*Math.sin(c)*t.scale*.8,t.position.y+(.4+.1*Math.cos(c))*t.scale*.8,t.position.z+.15*Math.cos(c)*t.scale*.8);let h=new i.kn4().makeRotationFromEuler(new i.O9p(-Math.PI/3,0,-c));e.multiply(h),e.scale(new i.Pq0(.8*t.scale,.8*t.scale,.8*t.scale)),null===(r=a.current)||void 0===r||r.setMatrixAt(u,e),null===(s=a.current)||void 0===s||s.setColorAt(u,l[t.variant].spots)}}),n.current.instanceMatrix.needsUpdate=!0,o.current.instanceMatrix.needsUpdate=!0,a.current.instanceMatrix.needsUpdate=!0,n.current.instanceColor&&(n.current.instanceColor.needsUpdate=!0),o.current.instanceColor&&(o.current.instanceColor.needsUpdate=!0),a.current.instanceColor&&(a.current.instanceColor.needsUpdate=!0)},[t,l]),(0,r.jsxs)("group",{children:[(0,r.jsxs)("instancedMesh",{args:[void 0,void 0,t.length],ref:n,frustumCulled:!1,children:[(0,r.jsx)("cylinderGeometry",{args:[.1,.12,.7,16]}),(0,r.jsx)("meshStandardMaterial",{roughness:.3,metalness:.2,emissiveIntensity:.5})]}),(0,r.jsxs)("instancedMesh",{args:[void 0,void 0,t.length],ref:o,children:[(0,r.jsx)("sphereGeometry",{args:[.3,32,32,0,2*Math.PI,0,Math.PI/2]}),(0,r.jsx)("meshStandardMaterial",{roughness:.3,metalness:.2,emissiveIntensity:.8,transparent:!0,opacity:.95})]}),(0,r.jsxs)("instancedMesh",{args:[void 0,void 0,6*t.length],ref:a,children:[(0,r.jsx)("circleGeometry",{args:[.04,16]}),(0,r.jsx)("meshStandardMaterial",{roughness:.2,metalness:.3,emissiveIntensity:1.5,transparent:!0,opacity:.95})]})]})},tc=s.memo(()=>{let{pillarGeometries:e,materials:t}=(0,s.useMemo)(()=>{let e=new i.Ho_(2,2.2,1,8),t=new i.Ho_(1.5,1.5,8,8),n=new i.Ho_(2.2,2,1,8),r=new i._4j({color:"#ffffff",roughness:.7,metalness:.2});return{pillarGeometries:{base:e,column:t,top:n,orb:new i.Gu$(1,32,32)},materials:{stone:r,orb:new i._4j({color:"#ff0000",emissive:"#600000",metalness:1,roughness:.2})}}},[]),[n,o]=s.useState(0);return s.useEffect(()=>{let e;let t=()=>{o(e=>(e+.02)%(2*Math.PI)),e=requestAnimationFrame(t)};return t(),()=>{cancelAnimationFrame(e)}},[]),s.useEffect(()=>()=>{Object.values(e).forEach(e=>e.dispose()),Object.values(t).forEach(e=>e.dispose())},[e,t]),(0,r.jsxs)("group",{position:[0,0,0],scale:[.35,.35,.35],children:[(0,r.jsx)("mesh",{geometry:e.base,material:t.stone,position:[0,0,0]}),(0,r.jsx)("mesh",{geometry:e.column,material:t.stone,position:[0,.25,0]}),(0,r.jsx)("mesh",{geometry:e.top,material:t.stone,position:[0,3,0]}),(0,r.jsx)("mesh",{geometry:e.orb,material:t.orb,position:[0,5,0],rotation:[n,n,0],children:(0,r.jsx)("pointLight",{color:"#ff0000",intensity:.5,distance:5})})]})});class tu{acquire(){if(this.pool.length>0)return this.pool.pop();if(this.maxSize>0&&this.pool.length>=this.maxSize)throw Error("Pool exhausted");return this.create()}release(e){this.maxSize>0&&this.pool.length>=this.maxSize||this.pool.push(e)}clear(){this.pool=[]}constructor(e,t,n){this.pool=[],this.create=e,this.maxSize=n;for(let e=0;e<t;e++)this.pool.push(this.create())}}function th(e){let{unitProps:{controlsRef:t,...n},onLevelComplete:o,spawnInterval:a=2e3,maxSkeletons:l=13,initialSkeletons:c=4,killCount:u}=e,h=(0,s.useMemo)(()=>tn(),[]),d=(0,s.useMemo)(()=>tr(),[]),m=(0,s.useMemo)(()=>ts(),[]),[f]=(0,s.useState)(()=>new tu(()=>new i.YJl,l,l+5)),x=(0,s.useCallback)(e=>{let t=f.acquire(),n=ti();return n.y=0,{id:e,position:n.clone(),initialPosition:n.clone(),rotation:0,health:196,maxHealth:196,ref:{current:t}}},[f]),g=(0,s.useCallback)(e=>{var t;(null===(t=e.ref)||void 0===t?void 0:t.current)&&f.release(e.ref.current)},[f]),[j,y]=(0,s.useState)(()=>Array.from({length:c},(e,t)=>x("skeleton-".concat(t)))),[M,v]=(0,s.useState)(c),[w,P]=(0,s.useState)(n.health),S=(0,s.useRef)(null),[I,b]=(0,s.useState)(new i.Pq0(0,0,0)),F=(0,s.useCallback)((e,t)=>{y(r=>{let s=[...r],i=s.findIndex(t=>t.id===e.replace("enemy-",""));if(-1!==i){let e=Math.max(0,s[i].health-t);if(0===e&&s[i].health>0){var o;s[i]={...s[i],health:e,isDying:!0,deathStartTime:Date.now()},null===(o=n.onEnemyDeath)||void 0===o||o.call(n)}else s[i]={...s[i],health:e}}return s})},[n]),C=(0,s.useCallback)(e=>{var t;null===(t=n.onDamage)||void 0===t||t.call(n,e)},[n]),E=(0,s.useCallback)(e=>{b(e)},[]),k=(0,s.useCallback)((e,t)=>{y(n=>n.map(n=>n.id===e.replace("enemy-","")?{...n,position:t.clone()}:n))},[]),R={onHit:F,controlsRef:t,currentWeapon:n.currentWeapon,onWeaponSelect:n.onWeaponSelect,health:w,maxHealth:n.maxHealth,isPlayer:n.isPlayer,abilities:n.abilities,onAbilityUse:n.onAbilityUse,onPositionUpdate:E,onHealthChange:e=>{if("function"==typeof e)P(t=>{var r;let s=e(t);return null===(r=n.onHealthChange)||void 0===r||r.call(n,s),s});else{var t;P(e),null===(t=n.onHealthChange)||void 0===t||t.call(n,e)}},enemyData:j.map(e=>({id:"enemy-".concat(e.id),position:e.position,initialPosition:e.initialPosition,rotation:e.rotation,health:e.health,maxHealth:e.maxHealth})),onDamage:n.onDamage,onEnemyDeath:()=>{console.log("Kill counted in Scene")},onFireballDamage:n.onFireballDamage,fireballManagerRef:n.fireballManagerRef,onSmiteDamage:n.onSmiteDamage},[T,_]=(0,s.useState)(0);(0,s.useEffect)(()=>{if(M>=l)return;let e=setInterval(()=>{u<2&&0===T||u<5&&1===T||u<8&&2===T||y(e=>{let t=l-M;if(t<=0)return e;let n=Math.min(3,t),r=Array.from({length:n},(e,t)=>x("skeleton-".concat(M+t)));return v(e=>e+n),_(e=>e+1),[...e,...r]})},a);return()=>clearInterval(e)},[M,l,a,T,u,x]),(0,s.useEffect)(()=>{let e=j.every(e=>e.health<=0),t=M>=l;e&&t&&o()},[j,M,l,o]),(0,s.useEffect)(()=>{t.current&&(t.current.object.position.set(0,12,-18),t.current.target.set(0,0,0),t.current.update())},[t]),(0,s.useEffect)(()=>{y(e=>{let t=Date.now();return e.filter(e=>e.isDying&&e.deathStartTime?t-e.deathStartTime<1500:e.health>0)})},[j]),(0,s.useEffect)(()=>{let e=S.current;return()=>{y([]),e&&e.clear(),b(new i.Pq0(0,0,0)),v(c)}},[c]),(0,s.useEffect)(()=>{let e=[],t=[];return()=>{e.forEach(e=>e.dispose()),t.forEach(e=>e.dispose())}},[]);let G=(0,s.useCallback)(()=>{y(e=>(e.forEach(g),[])),f.clear()},[g,f]);return(0,s.useEffect)(()=>G,[G]),(0,s.useEffect)(()=>(e4(),e3.mountain=new i.qFE(23,35,12),e8.mountain=new i.uSd({color:"#2a2a2a",metalness:.1,roughness:1,emissive:"#222222",flatShading:!0,clearcoat:.1,clearcoatRoughness:.8}),()=>{e6()}),[]),(0,s.useEffect)(()=>()=>{e6(),f.clear()},[f]),(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("group",{children:[(0,r.jsx)(tt,{}),(0,r.jsx)(e9,{}),(0,r.jsx)(p,{}),(0,r.jsx)(tc,{}),(0,r.jsx)(ta,{mountains:h}),(0,r.jsx)(to,{trees:d}),(0,r.jsx)(tl,{mushrooms:m}),(0,r.jsx)("group",{ref:S,children:(0,r.jsx)(e_,{...R})}),j.map(e=>(0,r.jsx)(e7,{id:e.id,initialPosition:e.initialPosition,position:e.position,health:e.health,maxHealth:e.maxHealth,isDying:e.isDying,onTakeDamage:F,onPositionUpdate:k,playerPosition:I,onAttackPlayer:C,weaponType:n.currentWeapon},e.id))]})})}let td=new i.kn4,tm=new i.Pq0,tp=new i.O9p,tf=new i.Pq0,tx=new i.PTz;function tg(e,t,n,r,s){tx.setFromEuler(r),td.compose(n,tx,s),e.setMatrixAt(t,td)}let tj=new i._4j({color:"#e8e8e8",roughness:.4,metalness:.3}),ty=new i._4j({color:"#4169E1",emissive:"#4169E1",emissiveIntensity:1.75,transparent:!0,opacity:.875}),tM=new i._4j({color:"#896BFF",roughness:.7,transparent:!0,opacity:.7}),tv=new i.Gu$(.06,6,6),tw=new i.Ho_(.04,.032,1,4),tP=new i.Gu$(.02,8,8),tS=new i.Ho_(.03,.04,2.8,8),tI=new i.rKP(.575,.7,24),tb={tooth:new i.qFE(.03,.075,3),lowerTooth:new i.qFE(.01,.08,3),eye:new i.Gu$(.02,8,8),eyeGlow:new i.Gu$(.035,8,8),eyeOuterGlow:new i.Gu$(.05,6.5,2),vertebrae:new i.Ho_(.0225,.0225,.03,6),particle:new i.Gu$(.01,6,6)},tF={bone:new i._4j({color:"#e8e8e8",roughness:.4,metalness:.3}),darkBone:new i._4j({color:"#d8d8d8",roughness:.5,metalness:.2}),eyeCore:new i._4j({color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:3}),eyeGlow:new i._4j({color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.75}),eyeOuterGlow:new i._4j({color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.7}),particleGlow:new i._4j({color:"#4169E1",emissive:"#4169E1",emissiveIntensity:2,transparent:!0,opacity:.7})};function tC(){let e=(e,t)=>(0,r.jsx)("mesh",{geometry:tw,material:tj,scale:[t/.04,e,t/.04]}),t=e=>(0,r.jsx)("mesh",{geometry:tv,material:tj,scale:[e/.06,e/.06,e/.06]}),n=(n,s)=>(0,r.jsxs)("group",{children:[(0,r.jsx)("group",{position:[s/2,0,0],children:e(n,.04)}),(0,r.jsx)("group",{position:[-s/2,0,0],children:e(n,.04)}),(0,r.jsx)("group",{position:[0,n/2,0],children:t(.06)}),(0,r.jsx)("group",{position:[0,-n/2,0],children:t(.06)})]});return(0,r.jsx)("group",{children:(0,r.jsxs)("group",{children:[(0,r.jsx)("mesh",{geometry:tw,material:tj}),(0,r.jsxs)("group",{position:[0,-.35,0],children:[(0,r.jsx)("mesh",{geometry:tv,material:tj}),(0,r.jsxs)("group",{position:[0,-.15,0],children:[n(.7,.06),(0,r.jsxs)("group",{position:[0,-.25,0],rotation:[Math.PI/2,0,0],children:[t(.06),(0,r.jsxs)("group",{position:[0,-.015,.1],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("boxGeometry",{args:[.15,.02,.4]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),[-.05,0,.05].map((e,t)=>(0,r.jsx)("group",{position:[e,.15,.25],rotation:[-Math.PI,0,0],children:(0,r.jsxs)("group",{children:[n(.15,.02),(0,r.jsx)("group",{position:[0,-.1,0],rotation:[Math.PI/6,0,0],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("coneGeometry",{args:[.02,.15,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})})]})},t))]})]})]})]})]})})}function tE(e){let{isLeftHand:t=!1}=e,n=(e,t)=>(0,r.jsx)("mesh",{geometry:tw,material:tj,scale:[t/.04,e,t/.04]}),s=e=>(0,r.jsx)("mesh",{geometry:tv,material:tj,scale:[e/.06,e/.06,e/.06]}),i=(e,t)=>(0,r.jsxs)("group",{children:[(0,r.jsx)("group",{position:[t/2,0,0],children:n(e,.06)}),(0,r.jsx)("group",{position:[-t/2,0,0],children:n(e,.06)}),(0,r.jsx)("group",{position:[0,e/2,0],children:s(.08)}),(0,r.jsx)("group",{position:[0,-e/2,0],children:s(.08)})]});return(0,r.jsx)("group",{children:(0,r.jsxs)("group",{children:[i(1.3,.15),(0,r.jsxs)("group",{position:[.25,-.875,.21],scale:[.8,.8,1.1],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.12,12,12]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("group",{rotation:[-.7,-0,Math.PI/5],children:[i(.8,.12),(0,r.jsxs)("group",{position:[0,-.5,0],rotation:[0,0,Math.PI/5.5],children:[s(.09),(0,r.jsxs)("group",{position:[0,-.1,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("boxGeometry",{args:[.2,.15,.08]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4})]}),[-.08,-.04,0,.04,.08].map((e,t)=>(0,r.jsxs)("group",{position:[e,-.1,0],rotation:[0,0,(t-2)*Math.PI/10],children:[n(.5,.02),(0,r.jsx)("group",{position:[.025,-.3,0],rotation:[0,0,Math.PI+Math.PI/16],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("coneGeometry",{args:[.03,.3,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})})]},t)),!t&&(0,r.jsx)("group",{position:[0,0,.1],rotation:[Math.PI,Math.PI/4,Math.PI/1.65],scale:[2.5,2.5,2.5],children:(0,r.jsx)(tR,{isLeftHand:!0})})]})]})]})]})]})})}function tk(){return(0,r.jsx)("group",{children:(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.123,.19,.175,6,1,!1,0,2*Math.PI]}),(0,r.jsx)("meshStandardMaterial",{color:"#97EFFF",roughness:.4,metalness:.3})]}),[0,1,2,3,4,5].map(e=>(0,r.jsxs)("group",{rotation:[0,e*Math.PI/3,0],children:[(0,r.jsxs)("mesh",{position:[.11,0,0],rotation:[0,Math.PI/6,0],children:[(0,r.jsx)("boxGeometry",{args:[.12,.19,.02]}),(0,r.jsx)("meshStandardMaterial",{color:"#97EFFF",roughness:.5,metalness:.4})]}),(0,r.jsxs)("mesh",{position:[.07,.05,0],rotation:[0,Math.PI/6,0],children:[(0,r.jsx)("boxGeometry",{args:[.035,.24,.015]}),(0,r.jsx)("meshStandardMaterial",{color:"#c0c0c0",roughness:.3,metalness:.5})]})]},e)),(0,r.jsxs)("mesh",{position:[0,.22,0],rotation:[0,.25,Math.PI/2],children:[(0,r.jsx)("torusGeometry",{args:[.2,.035,3,5]}),(0,r.jsx)("meshStandardMaterial",{color:"#97EFFF",roughness:.3,metalness:.5})]}),(0,r.jsxs)("mesh",{position:[0,0,0],rotation:[Math.PI/2,Math.PI,Math.PI/2],children:[(0,r.jsx)("torusGeometry",{args:[.16,.02,4,5]}),(0,r.jsx)("meshStandardMaterial",{color:"#00D9FF",roughness:.3,metalness:.5})]}),(0,r.jsxs)("mesh",{position:[0,-.1,0],rotation:[Math.PI/2,Math.PI,Math.PI/2],children:[(0,r.jsx)("torusGeometry",{args:[.2,.02,4,5]}),(0,r.jsx)("meshStandardMaterial",{color:"#00D9FF",roughness:.3,metalness:.5})]}),(0,r.jsxs)("mesh",{position:[0,.1,0],rotation:[Math.PI/2,Math.PI,Math.PI/2],children:[(0,r.jsx)("torusGeometry",{args:[.175,.0175,6,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#00D9FF",roughness:.3,metalness:.5})]})]})})}function tR(e){let{isLeftHand:t=!1}=e;return(0,r.jsxs)("group",{rotation:[0,0,t?Math.PI:-Math.PI/3],children:[(0,r.jsx)("mesh",{geometry:tS,children:(0,r.jsx)("meshStandardMaterial",{color:"#4a2105",roughness:.6,metalness:.2})}),[.3,.6,.9].map((e,t)=>(0,r.jsx)("group",{position:[0,e,0],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("torusGeometry",{args:[.075,.03,3,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#c0c0c0",metalness:.7,roughness:.3})]})},t)),(0,r.jsxs)("group",{position:[0,1.25,0],children:[(0,r.jsx)("mesh",{geometry:tP,material:ty}),(0,r.jsx)("pointLight",{color:"#4169E1",intensity:1.5,distance:4,decay:2}),[0,1].map(e=>{let t=Math.PI*e;return(0,r.jsx)("group",{rotation:[0,t,0],position:[.3*Math.cos(t),.1*Math.sin(e*Math.PI),.3*Math.sin(t)],children:(0,r.jsx)("mesh",{geometry:tP,material:ty})},e)})]})]})}function tT(){return(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{position:[0,-.15,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.17,.45,1.65,6]}),(0,r.jsx)("meshStandardMaterial",{...tM})]}),(0,r.jsxs)("mesh",{position:[0,0,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.285,.285,.135,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#6b0fb3",metalness:.3,roughness:.6})]}),[-1,1].map(e=>(0,r.jsx)("group",{position:[.3*e,.5,0],rotation:[0,5,.1*e],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.1,.125,.3,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#2a0845",roughness:.7,transparent:!0,opacity:.75})]})},e))]})}function t_(e){let{isUpper:t=!0}=e,n=(0,s.useMemo)(()=>{let e=t?5:4,n=t?tb.tooth:tb.lowerTooth,r=new i.ZLX(n,tF.bone,e);return r.instanceMatrix.setUsage(i.Vnu),r},[t]);return(0,s.useEffect)(()=>{(t?[-.03,-.06,-.09,0,.03]:[-.06,-.02,.02,.06]).forEach((e,r)=>{tm.set(e,t?-.25:-.18,.2),tp.set(t?.5:2.5,0,0),tf.set(1,1,1),tg(n,r,tm,tp,tf)}),n.instanceMatrix.needsUpdate=!0},[n,t]),(0,r.jsx)("primitive",{object:n})}function tG(){let e=(0,s.useMemo)(()=>{let e=new i.ZLX(tb.vertebrae,tF.bone,5);return e.instanceMatrix.setUsage(i.Vnu),e},[]);return(0,s.useEffect)(()=>{[.15,.27,.39,.51,.63].forEach((t,n)=>{tm.set(0,t,0),tp.set(0,0,0),tf.set(1,1,1),tg(e,n,tm,tp,tf)}),e.instanceMatrix.needsUpdate=!0},[e]),(0,r.jsx)("primitive",{object:e})}function tD(e){let{position:t,isAttacking:n,isWalking:i,onHit:o}=e,a=(0,s.useRef)(null),[l,c]=(0,s.useState)(0),[u,h]=(0,s.useState)(0),d=(0,s.useRef)(),m=(0,s.useMemo)(()=>({walkSpeed:3,attackSpeed:.6,walkHeightMultiplier:.1,armSwingMultiplier:.3,legSwingMultiplier:.4}),[]);return(0,f.F)((e,r)=>{if(a.current){if(i){let e=(l+r*m.walkSpeed)%(2*Math.PI);c(e);let n=Math.abs(Math.sin(e)*m.walkHeightMultiplier);a.current.position.y=t[1]-n,["LeftLeg","RightLeg"].forEach(t=>{var n,r;let s=null===(n=a.current)||void 0===n?void 0:n.getObjectByName(t);if(s){let n=t.includes("Right")?e:e+Math.PI,i=.4*Math.sin(n);s.rotation.x=i;let o=null===(r=s.children[0])||void 0===r?void 0:r.children[1];if(o){let e=Math.max(0,Math.sin(n+Math.PI/4));o.rotation.x=.2+.8*e;let t=.1*Math.sin(n);o.rotation.y=t}let a=.05*Math.sin(n);s.rotation.y=a}}),["LeftArm","RightArm"].forEach(t=>{var n;let r=null===(n=a.current)||void 0===n?void 0:n.getObjectByName(t);if(r){let n=Math.sin(t.includes("Right")?e+Math.PI:e)*m.armSwingMultiplier;r.rotation.x=n}})}if(n){h(e=>e+r*m.attackSpeed);let e=Math.sin(Math.min(u,Math.PI/4))*Math.PI,t=a.current.getObjectByName("RightArm");t&&(t.rotation.x=-e),u>Math.PI/4&&o&&!d.current&&(d.current=setTimeout(()=>{d.current=void 0},0)),u>Math.PI/4&&h(0)}else d.current&&(clearTimeout(d.current),d.current=void 0)}}),(0,s.useEffect)(()=>()=>{d.current&&clearTimeout(d.current)},[]),(0,r.jsxs)("group",{ref:a,position:[t[0],t[1],t[2]],scale:[.925,.935,.8],children:[(0,r.jsx)("group",{position:[0,.775,.025],children:(0,r.jsx)(tT,{})}),(0,r.jsx)("group",{name:"Body",position:[0,1.15,0],scale:[.9,.75,.775],rotation:[-.2,0,0],children:(0,r.jsx)(_,{})}),(0,r.jsx)("group",{children:[0,1].map(e=>(0,r.jsx)("group",{rotation:[0,Math.PI*e,0],position:[0,1.3,0],children:(0,r.jsx)("mesh",{geometry:tI,material:ty})},e))}),Array.from({length:4}).map((e,t)=>(0,r.jsxs)("group",{position:[.2*Math.sin(t*Math.PI/2),1.25+.3*Math.cos(t*Math.PI),.5*Math.cos(t*Math.PI/2)],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.01,6,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#4169E1",emissive:"#4169E1",emissiveIntensity:2,transparent:!0,opacity:.7})]}),(0,r.jsx)("pointLight",{color:"#4169E1",intensity:.5,distance:1,decay:2})]},t)),(0,r.jsxs)("group",{name:"Head",position:[0,1.7,.1],scale:[.75,.8,.8],children:[(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{position:[0,0,-.05],children:[(0,r.jsx)("sphereGeometry",{args:[.22,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("mesh",{position:[0,-.02,.12],children:[(0,r.jsx)("boxGeometry",{args:[.28,.28,.1]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{position:[.12,-.08,.1],children:[(0,r.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("mesh",{position:[-.12,-.08,.1],children:[(0,r.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})]}),(0,r.jsx)("group",{position:[0,-.15,.05],children:(0,r.jsxs)("mesh",{position:[0,-.08,.08],rotation:[0,Math.PI/5,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.08,.08,.2,5]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})}),(0,r.jsx)("group",{position:[.025,-.25,.2175],children:(0,r.jsx)(t_,{isUpper:!0})}),(0,r.jsx)("group",{position:[0,-.18,.2],children:(0,r.jsx)(t_,{isUpper:!1})})]}),(0,r.jsxs)("group",{position:[0,.05,.14],children:[(0,r.jsxs)("group",{position:[-.07,0,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.02,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:3})]}),(0,r.jsxs)("mesh",{scale:1.2,children:[(0,r.jsx)("sphereGeometry",{args:[.035,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.75})]}),(0,r.jsxs)("mesh",{scale:1.4,children:[(0,r.jsx)("sphereGeometry",{args:[.05,6.5,2]}),(0,r.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.7})]}),(0,r.jsx)("pointLight",{color:"#FF4C4C",intensity:.5,distance:1,decay:2})]}),(0,r.jsxs)("group",{position:[.07,0,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.02,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:3})]}),(0,r.jsxs)("mesh",{scale:1.2,children:[(0,r.jsx)("sphereGeometry",{args:[.035,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.75})]}),(0,r.jsxs)("mesh",{scale:1.4,children:[(0,r.jsx)("sphereGeometry",{args:[.05,6.5,2]}),(0,r.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.7})]}),(0,r.jsx)("pointLight",{color:"#FF4C4C",intensity:.5,distance:1,decay:1})]})]})]}),(0,r.jsx)("group",{position:[-.36,1.475,0],rotation:[-.15,-Math.PI-.4,-.35],children:(0,r.jsx)(tk,{})}),(0,r.jsx)("group",{position:[.36,1.475,0],rotation:[-.15,Math.PI-.4,.35],children:(0,r.jsx)(tk,{})}),(0,r.jsx)("group",{name:"LeftArm",position:[-.35,1.325,0],scale:[-.4,.4,.4],rotation:[0,Math.PI/3,0],children:(0,r.jsx)(tE,{isLeftHand:!0})}),(0,r.jsx)("group",{name:"RightArm",position:[.35,1.325,.1],scale:[.4,.4,.4],rotation:[0,-Math.PI/2.5,0],children:(0,r.jsx)(tE,{isLeftHand:!1})}),(0,r.jsxs)("group",{position:[0,.7,0],scale:[1.4,1,.8],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.21,.2,.2,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,r.jsx)("group",{position:[0,.15,-.16],rotation:[.1,0,0],children:(0,r.jsx)(tG,{})}),[-1,1].map(e=>(0,r.jsx)("group",{position:[.15*e,-.1,0],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.075,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})},e))]}),(0,r.jsx)("group",{name:"LeftLeg",position:[.2,.36,0],children:(0,r.jsx)(tC,{})}),(0,r.jsx)("group",{name:"RightLeg",position:[-.2,.36,0],children:(0,r.jsx)(tC,{})}),(0,r.jsx)("group",{position:[0,1.2,0],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.04,.04,.2,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})})]})}let tA=e=>{let{color:t,size:n,meshRef:o,opacity:a=1}=e,l=(0,s.useRef)(null),c=(0,s.useRef)(new Float32Array(54)),u=(0,s.useRef)(new Float32Array(18)),h=(0,s.useRef)(new Float32Array(18)),d=(0,s.useRef)(!1);return(0,s.useEffect)(()=>{if(o.current&&!d.current){let{x:e,y:t,z:n}=o.current.position;for(let r=0;r<18;r++)c.current[3*r]=e,c.current[3*r+1]=t,c.current[3*r+2]=n,u.current[r]=0,h.current[r]=0;d.current=!0}},[o]),(0,f.F)(()=>{var e;if(!(null===(e=l.current)||void 0===e?void 0:e.parent)||!o.current||!d.current)return;let{x:t,y:r,z:s}=o.current.position;for(let e=17;e>0;e--)c.current[3*e]=c.current[(e-1)*3],c.current[3*e+1]=c.current[(e-1)*3+1],c.current[3*e+2]=c.current[(e-1)*3+2],u.current[e]=.8*Math.pow(1-e/18,1.5)*a,h.current[e]=.6*n*Math.pow(1-e/18,.8);if(c.current[0]=t,c.current[1]=r,c.current[2]=s,u.current[0]=.8*a,h.current[0]=1.5*n,l.current){let e=l.current.geometry;e.attributes.position.array=c.current,e.attributes.position.needsUpdate=!0,e.attributes.opacity&&(e.attributes.opacity.array=u.current,e.attributes.opacity.needsUpdate=!0),e.attributes.scale&&(e.attributes.scale.array=h.current,e.attributes.scale.needsUpdate=!0)}}),(0,s.useEffect)(()=>{let e=l.current;return()=>{e&&(e.geometry.dispose(),e.material.dispose())}},[]),(0,r.jsxs)("points",{ref:l,children:[(0,r.jsxs)("bufferGeometry",{children:[(0,r.jsx)("bufferAttribute",{attach:"attributes-position",count:18,array:c.current,itemSize:3}),(0,r.jsx)("bufferAttribute",{attach:"attributes-opacity",count:18,array:u.current,itemSize:1}),(0,r.jsx)("bufferAttribute",{attach:"attributes-scale",count:18,array:h.current,itemSize:1})]}),(0,r.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:i.EZo,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 17.0 * (300.0 / -mvPosition.z);\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          uniform vec3 uColor;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.4, 0.1, d);\n            vec3 glowColor = mix(uColor, vec3(1.0), 0.3);\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        ",uniforms:{uColor:{value:t}}})]})};function tz(e){let{position:t,target:n,onHit:o,playerPosition:a}=e,l=(0,s.useRef)(null),c=(0,s.useRef)(null),u=n.clone().sub(t).normalize(),[h,d]=(0,s.useState)(!1),[m,p]=(0,s.useState)(null),[,x]=(0,s.useState)({}),g=(0,s.useRef)(!1);return(0,f.F)(()=>{if(l.current){if(h){x({}),g.current||(g.current=!0,o(!0)),m&&Date.now()-m>200&&o(!1);return}if(l.current.position.add(u.clone().multiplyScalar(.25)),1>l.current.position.distanceTo(a)){d(!0),p(Date.now());return}if(1>l.current.position.distanceTo(n)){1>a.distanceTo(n)?(d(!0),p(Date.now())):o(!1);return}l.current.position.distanceTo(t)>200&&o(!1)}}),(0,s.useEffect)(()=>{let e=c.current;return()=>{e&&(e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose())}},[]),(0,r.jsx)("group",{ref:l,position:t,children:h?(0,r.jsx)(r.Fragment,{children:(()=>{let e=m?(Date.now()-m)/1e3:0,t=Math.max(0,1-e/.2);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.45*(1+2*e),32,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff3333",emissive:"#ff4444",emissiveIntensity:2*t,transparent:!0,opacity:.8*t,depthWrite:!1,blending:i.EZo})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.4*(1+3*e),24,24]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff6666",emissive:"#ffffff",emissiveIntensity:3*t,transparent:!0,opacity:.9*t,depthWrite:!1,blending:i.EZo})]}),[.45,.675,.9,1.175].map((n,s)=>(0,r.jsxs)("mesh",{rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,r.jsx)("torusGeometry",{args:[n*(1+3*e),.045,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff3333",emissive:"#ff4444",emissiveIntensity:.8*t,transparent:!0,opacity:.5*t*(1-.2*s),depthWrite:!1,blending:i.EZo})]},s)),[void 0,void 0,void 0,void 0].map((n,s)=>{let o=s/4*Math.PI*2,a=.5*(1+2*e);return(0,r.jsxs)("mesh",{position:[Math.sin(o)*a,Math.cos(o)*a,0],children:[(0,r.jsx)("sphereGeometry",{args:[.05,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff6666",emissive:"#ffffff",emissiveIntensity:2*t,transparent:!0,opacity:.8*t,depthWrite:!1,blending:i.EZo})]},"spark-".concat(s))}),(0,r.jsx)("pointLight",{color:"#ff3333",intensity:2*t,distance:4,decay:2}),(0,r.jsx)("pointLight",{color:"#ff6666",intensity:1*t,distance:6,decay:1})]})})()}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("mesh",{ref:c,children:[(0,r.jsx)("sphereGeometry",{args:[.2,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff3333",emissive:"#ff0000",emissiveIntensity:2,transparent:!0,opacity:.9})]}),(0,r.jsx)(tA,{color:new i.Q1f("#ff3333"),size:.235,meshRef:c,opacity:.8}),(0,r.jsx)("pointLight",{color:"#ff3333",intensity:2,distance:3,decay:2})]})})}let tq=s.memo(function(e){let{id:t,initialPosition:n,position:o,health:a,maxHealth:l,onTakeDamage:c,onPositionUpdate:u,playerPosition:h,onAttackPlayer:d,weaponType:m}=e,p=(0,s.useRef)(null),[x,g]=(0,s.useState)(!1),[j,y]=(0,s.useState)(!1),[M,v]=(0,s.useState)(!0),[w,P]=(0,s.useState)(!1),[S,I]=(0,s.useState)(!1),F=(0,s.useRef)(Date.now()+2e3),[C,E]=(0,s.useState)([]),[k,R]=(0,s.useState)([]),T=(0,s.useRef)(n.clone()),_=(0,s.useRef)(n.clone()),G=(0,s.useRef)(Date.now()),D=(0,s.useRef)(a),A=(0,s.useRef)(new i.Pq0),z=(0,s.useRef)(null),q=(0,s.useRef)(Date.now());(0,s.useEffect)(()=>{D.current=a},[a]);let L=(0,s.useCallback)((e,n)=>{if(D.current<=0)return;let r=Math.max(0,D.current-e);if(c("enemy-".concat(t),e),n.type&&B.hasShadowStrikeBuff()){let e=new i.Pq0().subVectors(T.current,h).normalize();R(t=>[...t,{id:Date.now(),type:"stealthStrike",position:T.current.clone(),direction:e,duration:.2,startTime:Date.now()}])}0===r&&D.current>0&&(y(!0),g(!0))},[t,c,h]);(0,s.useEffect)(()=>{o&&(T.current.copy(o),_.current.copy(o),p.current&&p.current.position.copy(o))},[o]);let O=(0,s.useCallback)(()=>{S||j||(I(!0),setTimeout(()=>{if(p.current){let e=T.current.clone();e.y+=1.5,E(t=>[...t,{id:Date.now(),position:e,target:h.clone()}])}setTimeout(()=>{I(!1)},500)},1e3))},[S,j,h]),H=(0,s.useCallback)(()=>{if(!p.current)return null;let e=Math.random()*Math.PI*2,t=5*Math.random();return new i.Pq0(T.current.x+Math.cos(e)*t,0,T.current.z+Math.sin(e)*t)},[]);return(0,f.F)((e,n)=>{if(!p.current||D.current<=0||!h){P(!1);return}if(B.isUnitStealthed()){P(!1),I(!1);let e=Date.now();if(!z.current||e-q.current>4500){if(z.current){let e=new i.Pq0().subVectors(z.current,T.current).normalize(),t=new i.Pq0().copy(T.current).add(e.multiplyScalar(5));z.current=t}else z.current=H();q.current=e}if(z.current){P(!0);let e=new i.Pq0().subVectors(z.current,T.current).normalize(),t=e.multiplyScalar(1.5*n);A.current.lerp(t,3*n),T.current.add(A.current),T.current.y=0,p.current.position.copy(T.current);let r=Math.atan2(e.x,e.z)-p.current.rotation.y;for(;r>Math.PI;)r-=2*Math.PI;for(;r<-Math.PI;)r+=2*Math.PI;p.current.rotation.y+=r*Math.min(1,4*n)}return}let r=T.current.distanceTo(h);if(r>20&&D.current>0){var s;P(!0);let e=new i.Pq0().subVectors(h,T.current).normalize(),t=new i.Pq0;((null===(s=p.current.parent)||void 0===s?void 0:s.children.filter(e=>e!==p.current&&e.position&&1.25>e.position.distanceTo(T.current)))||[]).forEach(e=>{let n=T.current.clone().setY(0),r=e.position.clone().setY(0),s=new i.Pq0().subVectors(n,r).normalize().multiplyScalar(.155/Math.max(.1,r.distanceTo(n)));t.add(s)});let r=e.add(t).normalize();r.y=0;let o=r.multiplyScalar(1.7999999999999998*n);A.current.lerp(o,6*n),T.current.add(A.current),T.current.y=0,p.current.position.copy(T.current);let a=new i.Pq0().copy(h).setY(T.current.y),l=Math.atan2(a.x-T.current.x,a.z-T.current.z)-p.current.rotation.y;for(;l>Math.PI;)l-=2*Math.PI;for(;l<-Math.PI;)l+=2*Math.PI;p.current.rotation.y+=l*Math.min(1,8*n)}else P(!1),A.current.multiplyScalar(1-8*n),A.current.length()>.001&&(T.current.add(A.current),p.current.position.copy(T.current));Date.now()-F.current>=4250&&r<=20&&(O(),F.current=Date.now());let a=Date.now();a-G.current>=35&&T.current.distanceTo(o)>.1&&(u(t,T.current.clone()),G.current=a)}),(0,s.useEffect)(()=>{0===a&&!j&&(y(!0),g(!0),p.current&&(p.current.visible=!0))},[a,j]),(0,s.useEffect)(()=>{if(j){let e=setTimeout(()=>{var e;g(!1),(null===(e=p.current)||void 0===e?void 0:e.parent)&&p.current.parent.remove(p.current)},3e3);return()=>clearTimeout(e)}},[j]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("group",{ref:p,visible:!M&&D.current>0,position:T.current,onClick:e=>{e.stopPropagation()},children:[(0,r.jsx)(tD,{position:[0,.76,0],isAttacking:S,isWalking:w&&D.current>0,onHit:e=>L(e,{type:m})}),S&&(0,r.jsxs)("group",{position:[.4,2.265,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.125,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff3333",emissive:"#ff0000",emissiveIntensity:1,transparent:!0,opacity:.8})]}),(0,r.jsx)("pointLight",{color:"#ff3333",intensity:2,distance:3})]}),S&&(0,r.jsxs)("group",{position:[-.4,2.265,-.05],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.125,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff3333",emissive:"#ff0000",emissiveIntensity:2,transparent:!0,opacity:.7})]}),(0,r.jsx)("pointLight",{color:"#ff3333",intensity:2,distance:3})]}),(0,r.jsx)(eG.Q,{position:[0,3.5,0],follow:!0,lockX:!1,lockY:!1,lockZ:!1,children:D.current>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("mesh",{position:[0,0,0],children:[(0,r.jsx)("planeGeometry",{args:[2,.25]}),(0,r.jsx)("meshBasicMaterial",{color:"#333333",opacity:.8,transparent:!0})]}),(0,r.jsxs)("mesh",{position:[-1+D.current/l,0,.001],children:[(0,r.jsx)("planeGeometry",{args:[D.current/l*2,.23]}),(0,r.jsx)("meshBasicMaterial",{color:"#ff3333",opacity:.9,transparent:!0})]}),(0,r.jsx)(b.E,{position:[0,0,.002],fontSize:.2,color:"#ffffff",anchorX:"center",anchorY:"middle",fontWeight:"bold",children:"".concat(Math.ceil(D.current),"/").concat(l)})]})})]}),M&&(0,r.jsx)(e0,{position:T.current,onComplete:()=>{v(!1)},isSpawning:!0}),x&&(0,r.jsx)(e5,{position:T.current,onComplete:()=>{g(!1)},isSpawning:!1,weaponType:m}),C.map(e=>(0,r.jsx)(tz,{position:e.position,target:e.target,playerPosition:h,onHit:t=>{E(t=>t.filter(t=>t.id!==e.id)),t&&d(18)}},e.id)),k.map(e=>"stealthStrike"===e.type?(0,r.jsx)(ek,{position:e.position,direction:e.direction,onComplete:()=>{R(t=>t.filter(t=>t.id!==e.id))},parentRef:p},e.id):null)]})},(e,t)=>e.health===t.health&&e.position.equals(t.position)&&e.playerPosition.equals(t.playerPosition));e3.mage,e8.mage;let tB=e=>{let{parentRef:t}=e,n=(0,s.useRef)(null),o=(0,s.useRef)(new Float32Array(36)),a=(0,s.useRef)(new Float32Array(12)),l=(0,s.useRef)(new Float32Array(12)),c=(0,s.useRef)(0);return(0,f.F)((e,r)=>{var s;if(!(null===(s=n.current)||void 0===s?void 0:s.parent)||!t.current)return;c.current+=r;let i=t.current.position;for(let e=0;e<12;e++){let t=Math.acos(-1+2*e/12),n=Math.sqrt(12*Math.PI)*t+c.current,r=.8+.1*Math.sin(2*c.current+.2*e);o.current[3*e]=i.x+r*Math.cos(n)*Math.sin(t),o.current[3*e+1]=i.y+r*Math.sin(n)*Math.sin(t),o.current[3*e+2]=i.z+r*Math.cos(t),a.current[e]=.3*Math.pow(1-e/12,1.2),l.current[e]=.4*Math.pow(1-e/12,.5)}if(n.current){let e=n.current.geometry;e.attributes.position.needsUpdate=!0,e.attributes.opacity.needsUpdate=!0,e.attributes.scale.needsUpdate=!0}}),(0,r.jsxs)("points",{ref:n,children:[(0,r.jsxs)("bufferGeometry",{children:[(0,r.jsx)("bufferAttribute",{attach:"attributes-position",count:12,array:o.current,itemSize:3}),(0,r.jsx)("bufferAttribute",{attach:"attributes-opacity",count:12,array:a.current,itemSize:1}),(0,r.jsx)("bufferAttribute",{attach:"attributes-scale",count:12,array:l.current,itemSize:1})]}),(0,r.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:i.EZo,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 25.0 * (300.0 / -mvPosition.z); // Larger point size\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.5, 0.1, d);\n            vec3 glowColor = mix(vec3(0.5, 0.0, 0.5), vec3(0.8, 0.0, 0.8), 0.4); // Purple color\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        "})]})};function tL(){let e={roughness:.4,metalness:.3,transparent:!0,opacity:.95};return(0,r.jsx)("group",{children:[-.89,.89].map(t=>(0,r.jsxs)("group",{position:[.56*t,.625,-.75],rotation:[-1.35,0,3.025*t],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.08,.0125,1]}),(0,r.jsx)("meshStandardMaterial",{color:"#d4d4d4",...e})]}),(0,r.jsxs)("group",{position:[0,1.35,-0],scale:1.6,rotation:[-.65,0,0],children:[[-.07,-.02,.02,.07].map((t,n)=>(0,r.jsx)("group",{position:[t,.125,-.15],rotation:[2,0,0],scale:[1,1.5,1.2],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("coneGeometry",{args:[.02,.075,3]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",...e})]})},"upper-".concat(n))),[-.08,-.015,.015,.09].map((t,n)=>(0,r.jsx)("group",{position:[t,.01075,0],rotation:[-.45,0,0],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("coneGeometry",{args:[.025*(0===n||3===n?1.3:1),.095*(0===n||3===n?1.5:1),3]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",...e})]})},"lower-".concat(n)))]}),(0,r.jsxs)("group",{position:[0,.4,.2],rotation:[-.05,0,.3*t],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.08,.008,.8,32,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#c4c4c4",...e})]}),[void 0,void 0,void 0,void 0,void 0].map((n,s)=>(0,r.jsx)("group",{position:[.02*t,.095*s,.07],rotation:[Math.PI/1.5,0,0],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("coneGeometry",{args:[.0325,.1,32,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#b4b4b4",...e})]})},s))]}),(0,r.jsx)("group",{position:[0,1.0225,.3],rotation:[-.925,0,.5*t],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.07,.0075,.6,5]}),(0,r.jsx)("meshStandardMaterial",{color:"#b4b4b4",...e})]})})]},t))})}let tO=new i.kn4,tH=new i.Pq0,tN=new i.O9p,tW=new i.Pq0,tU=new i.PTz;function tQ(e,t,n,r,s){tU.setFromEuler(r),tO.compose(n,tU,s),e.setMatrixAt(t,tO)}let tY={sphere:new i.Gu$(.02,8,8),cylinder:new i.Ho_(.04,.032,1,4),cone:new i.qFE(.02,.15,4),box:new i.iNn(.2,.15,.08),vertebrae:new i.Ho_(.0225,.0225,.03,6),eye:new i.Gu$(.02,8,8),eyeGlow:new i.Gu$(.035,8,8),eyeOuterGlow:new i.Gu$(.05,6.5,2)},tZ={standardBone:new i._4j({color:"#e8e8e8",roughness:.4,metalness:.3}),darkBone:new i._4j({color:"#d4d4d4",roughness:.3,metalness:.4}),eyeCore:new i._4j({color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:3}),eyeGlow:new i._4j({color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.75}),eyeOuterGlow:new i._4j({color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.7})};function tV(){let e=(0,s.useMemo)(()=>{let e=new i.ZLX(tY.vertebrae,tZ.standardBone,5);return e.instanceMatrix.setUsage(i.Vnu),e},[]);return(0,s.useEffect)(()=>{[.15,.27,.39,.51,.63].forEach((t,n)=>{tH.set(0,t,0),tN.set(.1,0,0),tW.set(1,1,1),tQ(e,n,tH,tN,tW)}),e.instanceMatrix.needsUpdate=!0},[e]),(0,r.jsx)("primitive",{object:e})}function tK(e){let{position:t}=e,n=(0,s.useMemo)(()=>({core:new i.ZLX(tY.eye,tZ.eyeCore,1),innerGlow:new i.ZLX(tY.eyeGlow,tZ.eyeGlow,1),outerGlow:new i.ZLX(tY.eyeOuterGlow,tZ.eyeOuterGlow,1)}),[]);return(0,s.useEffect)(()=>{tH.set(...t),tN.set(0,0,0),tQ(n.core,0,tH,tN,tW.set(1,1,1)),tQ(n.innerGlow,0,tH,tN,tW.set(1.2,1.2,1.2)),tQ(n.outerGlow,0,tH,tN,tW.set(1.4,1.4,1.4)),Object.values(n).forEach(e=>{e.instanceMatrix.needsUpdate=!0})},[n,t]),(0,r.jsxs)("group",{children:[(0,r.jsx)("primitive",{object:n.core}),(0,r.jsx)("primitive",{object:n.innerGlow}),(0,r.jsx)("primitive",{object:n.outerGlow}),(0,r.jsx)("pointLight",{color:"#FF4C4C",intensity:.5,distance:1,decay:2,position:t})]})}function t$(){let e=(e,t)=>(0,r.jsx)("mesh",{geometry:tY.cylinder,material:tZ.standardBone,scale:[t/.04,e,t/.04]}),t=e=>(0,r.jsx)("mesh",{geometry:tY.sphere,material:tZ.standardBone,scale:[e/.06,e/.06,e/.06]});return(0,r.jsxs)("group",{children:[t(.08),(0,r.jsxs)("group",{rotation:[.3,0,0],children:[e(.4,.07),(0,r.jsxs)("group",{position:[0,-.2,0],children:[t(.09),(0,r.jsxs)("group",{position:[0,0,-.5],children:[e(.8,.06),(0,r.jsxs)("group",{position:[0,-.4,0],children:[t(.05),(0,r.jsxs)("group",{position:[0,0,0],children:[e(.9,.04),(0,r.jsxs)("group",{position:[0,-.45,0],children:[t(.04),(0,r.jsxs)("group",{position:[0,0,0],children:[e(.7,.03),(0,r.jsx)("group",{position:[0,-.35,0],children:(0,r.jsx)("mesh",{geometry:tY.cone,material:tZ.darkBone})})]})]})]})]})]})]})]})]})}function tX(e){let{isLeftHand:t=!1}=e,n=(e,t)=>(0,r.jsx)("mesh",{geometry:tY.cylinder,material:tZ.standardBone,scale:[t/.04,e,t/.04]}),s=e=>(0,r.jsx)("mesh",{geometry:tY.sphere,material:tZ.standardBone,scale:[e/.06,e/.06,e/.06]}),o=(e,t)=>(0,r.jsxs)("group",{children:[(0,r.jsx)("group",{position:[t/2,0,0],children:n(e,.06)}),(0,r.jsx)("group",{position:[-t/2,0,0],children:n(e,.06)}),(0,r.jsx)("group",{position:[0,e/2,0],children:s(.08)}),(0,r.jsx)("group",{position:[0,-e/2,0],children:s(.08)})]}),a=(()=>{let e=new i.ypk;return e.moveTo(0,0),e.lineTo(.4,-.13),e.bezierCurveTo(.8,.22,1.33,.5,1.6,.515),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e})();return(0,r.jsx)("group",{children:(0,r.jsxs)("group",{children:[o(1.3,.15),(0,r.jsxs)("group",{position:[.25,-.85,.21],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.12,12,12]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("group",{rotation:[-.7,-0,Math.PI/5],children:[o(.8,.12),(0,r.jsxs)("group",{position:[0,-.5,0],rotation:[0,0,Math.PI/5.5],children:[s(.09),(0,r.jsxs)("group",{position:[0,-.1,0],children:[(0,r.jsxs)("group",{position:[-0,-.2,.1],rotation:[2+Math.PI/4,-1,2.675*Math.PI+.85],scale:[1.4,.55,1.4],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("extrudeGeometry",{args:[a,{steps:1,depth:1e-4,bevelEnabled:!0,bevelThickness:.03,bevelSize:.035,bevelSegments:1,curveSegments:16}]}),(0,r.jsx)("meshStandardMaterial",{color:"#9c27b0",emissive:"#9c27b0",emissiveIntensity:1.3,metalness:.8,roughness:.1,opacity:1,transparent:!0,side:i.$EB})]}),(0,r.jsx)("pointLight",{color:"#9c27b0",intensity:1,distance:2,decay:2})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("boxGeometry",{args:[.2,.15,.08]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4})]}),[-.08,-.04,0,.04,.08].map((e,t)=>(0,r.jsxs)("group",{position:[e,-.1,0],rotation:[0,0,(t-2)*Math.PI/10],children:[n(.5,.02),(0,r.jsx)("group",{position:[.025,-.3,0],rotation:[0,0,Math.PI+Math.PI/16],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("coneGeometry",{args:[.03,.3,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})})]},t)),!t&&(0,r.jsx)("group",{position:[0,-.2,.3],rotation:[Math.PI/2,0,0],scale:[.8,.8,.8]})]})]})]})]})]})})}function tJ(){let e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return(0,r.jsxs)("group",{scale:[e,e,e],position:[0,-.125,0],children:[(0,r.jsxs)("mesh",{position:[0,0,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.06,.06,.115,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("mesh",{position:[0,.1,.0275],rotation:[0,0,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.04,.03,.12,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("mesh",{position:[0,.2,.04],rotation:[.2,0,0],children:[(0,r.jsx)("coneGeometry",{args:[.04,.175,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.5})]}),[0,Math.PI/2,Math.PI,3*Math.PI/2].map((e,t)=>(0,r.jsx)("group",{rotation:[0,e,0],children:(0,r.jsxs)("mesh",{position:[.04,.05,0],children:[(0,r.jsx)("boxGeometry",{args:[.01,.12,.02]}),(0,r.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.5,metalness:.3})]})},t))]})};return(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.185,.2,.225,4,1]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("group",{position:[0,.25,0],rotation:[2*Math.PI,Math.PI/3,0],children:[(0,r.jsx)("group",{position:[0,0,0],rotation:[0,0,0],children:e(1.5)}),(0,r.jsx)("group",{position:[0,-.05,.15],rotation:[-.2,0,0],children:e(1.1)}),(0,r.jsx)("group",{position:[0,-.05,-.15],rotation:[.2,0,0],children:e(1.1)})]})]})}function t0(e){let{isLeft:t=!1}=e,n=1.2*Math.PI;return(0,r.jsx)("group",{rotation:[-.25,t?-.3:.3,t?-.4:.4],children:Array.from({length:10}).map((e,s)=>{let i=s/9,o=.15*(1-.8*i),a=Math.pow(i,1.2)*n,l=1.4*Math.pow(i,1.3);return(0,r.jsxs)("group",{position:[l*(t?-.15:.15),.12*s,-(.6*l)],rotation:[-.8*i,a,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[o,.92*o,.12,4]}),(0,r.jsx)("meshStandardMaterial",{color:"rgb(".concat(139-80*i,", ").concat(0+20*i,", ").concat(0+20*i,")"),roughness:.7,metalness:.4})]}),Array.from({length:4}).map((e,t)=>(0,r.jsx)("group",{rotation:[0,t*Math.PI*2/4,0],children:(0,r.jsxs)("mesh",{position:[.95*o,0,0],children:[(0,r.jsx)("boxGeometry",{args:[.4*o,.132,.2*o]}),(0,r.jsx)("meshStandardMaterial",{color:"rgb(".concat(159-100*i,", ").concat(20+20*i,", ").concat(20+20*i,")"),roughness:.8,metalness:.3})]})},t))]},s)})})}function t1(e){let{position:t,isAttacking:n,isWalking:i}=e,o=(0,s.useRef)(null),[a,l]=(0,s.useState)(0),[c,u]=(0,s.useState)(0),h=(0,s.useRef)(),d=[{left:"LeftFrontLeg",right:"RightFrontLeg",baseRotation:{x:.2,y:-.6,z:.6},rightBaseRotation:{x:.2,y:.6,z:-.6},phase:0},{left:"LeftMiddleFrontLeg",right:"RightMiddleFrontLeg",baseRotation:{x:.25,y:-.8,z:.7},rightBaseRotation:{x:.25,y:.8,z:-.7},phase:Math.PI},{left:"LeftMiddleBackLeg",right:"RightMiddleBackLeg",baseRotation:{x:.5,y:-1,z:.7},rightBaseRotation:{x:.5,y:1,z:-.7},phase:0},{left:"LeftBackLeg",right:"RightBackLeg",baseRotation:{x:1,y:-1.2,z:.6},rightBaseRotation:{x:1,y:1.2,z:-.6},phase:Math.PI}];return(0,f.F)((e,t)=>{if(!o.current)return;let r=o.current;if(i){let e=(a+4*t)%(2*Math.PI);l(e),["LeftFrontLeg","RightFrontLeg","LeftMiddleFrontLeg","RightMiddleFrontLeg","LeftMiddleBackLeg","RightMiddleBackLeg","LeftBackLeg","RightBackLeg"].forEach((t,n)=>{let s=r.getObjectByName(t);if(s){var i,o;t.includes("Right");let r=e+(n%2==0?0:Math.PI),a=.3*Math.max(0,Math.sin(r)),l=.2*Math.cos(r);s.rotation.x=l,s.position.y=.6+a;let c=null===(i=s.children[0])||void 0===i?void 0:i.children[1],u=null==c?void 0:null===(o=c.children[1])||void 0===o?void 0:o.children[1];if(c&&u){let e=r+Math.PI/4;c.rotation.x=.4*Math.sin(e)-.2,u.rotation.x=-(.6*Math.sin(e))-.3}}})}if(n){u(e=>e+3*t);let e=[{left:"LeftLowerBackArm",right:"RightLowerBackArm",startTime:.65,rotationRange:.5*Math.PI},{left:"LeftMiddleBackArm",right:"RightMiddleBackArm",startTime:.95,rotationRange:.5*Math.PI},{left:"LeftUpperBackArm",right:"RightUpperBackArm",startTime:1.25,rotationRange:.5*Math.PI},{left:"LeftFrontArm",right:"RightFrontArm",startTime:1.55,rotationRange:.5*Math.PI}];e.forEach(e=>{let{left:t,right:n,startTime:s,rotationRange:i}=e,o=r.getObjectByName(t),a=r.getObjectByName(n);if(o&&a){let e=Math.max(0,Math.min(1,(c-s)*1)),t=Math.sin(e*Math.PI)*i,n=.5*Math.sin(e*Math.PI);o.rotation.y=4*Math.PI+t,a.rotation.y=4*Math.PI-t,o.rotation.z=n,a.rotation.z=n}}),c>2.45&&(u(0),e.forEach(e=>{let{left:t,right:n}=e,s=r.getObjectByName(t),i=r.getObjectByName(n);s&&i&&(s.rotation.z=0,i.rotation.z=0)}))}else[{left:"LeftLowerBackArm",right:"RightLowerBackArm",y:4.2*Math.PI},{left:"LeftMiddleBackArm",right:"RightMiddleBackArm",y:4.1*Math.PI},{left:"LeftUpperBackArm",right:"RightUpperBackArm",y:4*Math.PI},{left:"LeftFrontArm",right:"RightFrontArm",y:4.9*Math.PI}].forEach(e=>{let{left:t,right:n,y:s}=e,i=r.getObjectByName(t),o=r.getObjectByName(n);i&&o&&(i.rotation.y=s,o.rotation.y=-s)});n||d.forEach(t=>{let{left:n,right:s,baseRotation:i,rightBaseRotation:o,phase:a}=t,l=r.getObjectByName(n),c=r.getObjectByName(s);if(l&&c){let t=3*e.clock.getElapsedTime(),n=Math.sin(t+a),r=Math.sin(t+a+Math.PI);l.rotation.set(i.x+.15*n,i.y+.045*n,i.z+.075*n),c.rotation.set(o.x+.15*r,o.y+.045*r,o.z+.075*r)}})}),(0,s.useEffect)(()=>{let e=h.current;return()=>{e&&clearTimeout(e)}},[]),(0,r.jsxs)("group",{ref:o,position:[t[0],t[1],t[2]],scale:[1.425,1.425,1.425],children:[(0,r.jsx)("group",{position:[0,.15,-0],children:(0,r.jsx)(tB,{parentRef:o})}),(0,r.jsx)("group",{name:"Body",position:[0,1.2,-.25],scale:[1.8,1.4,1.65],rotation:[.25,0,0],children:(0,r.jsx)(_,{})}),(0,r.jsx)("group",{scale:[.7,.7,.7],position:[0,1.25,-.1],rotation:[.25,0,0],children:(0,r.jsx)(tL,{})}),(0,r.jsx)("group",{scale:[.7,.5,.7],position:[0,1.3,-.3],rotation:[1,0,-4.25],children:(0,r.jsx)(t0,{isLeft:!0})}),(0,r.jsx)("group",{scale:[.7,.5,.7],position:[0,1.3,-.3],rotation:[1,0,4.25],children:(0,r.jsx)(t0,{isLeft:!1})}),(0,r.jsx)("group",{scale:[.7,.5,.7],position:[0,.7,-.6],rotation:[1,0,-4.25],children:(0,r.jsx)(t0,{isLeft:!0})}),(0,r.jsx)("group",{scale:[.7,.5,.7],position:[0,.7,-.6],rotation:[1,0,4.25],children:(0,r.jsx)(t0,{isLeft:!1})}),(0,r.jsxs)("group",{name:"Head",position:[0,1.925,.2],scale:[.95,.8,.8],children:[(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{position:[0,0,-.05],children:[(0,r.jsx)("sphereGeometry",{args:[.22,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("mesh",{position:[0,-.02,.12],children:[(0,r.jsx)("boxGeometry",{args:[.28,.28,.1]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{position:[.12,-.08,.1],children:[(0,r.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("mesh",{position:[-.12,-.08,.1],children:[(0,r.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})]}),(0,r.jsx)("group",{position:[0,-.15,.05],children:(0,r.jsxs)("mesh",{position:[0,-.08,.08],rotation:[0,Math.PI/5,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.08,.08,.2,5]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})}),(0,r.jsx)("group",{position:[.025,-.25,.2175],children:[-.03,-.06,-.09,-0,.03].map((e,t)=>(0,r.jsx)("group",{position:[e,0,0],rotation:[.5,0,0],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("coneGeometry",{args:[.03,.075,3]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.3,metalness:.4})]})},t))}),(0,r.jsx)("group",{position:[0,-.18,.2],children:[-.06,-.02,.02,.06].map((e,t)=>(0,r.jsx)("group",{position:[e,0,0],rotation:[2.5,0,0],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("coneGeometry",{args:[.01,.08,3]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.3,metalness:.4})]})},t))})]}),(0,r.jsxs)("group",{position:[0,.05,.14],children:[(0,r.jsx)(tK,{position:[-.07,0,0]}),(0,r.jsx)(tK,{position:[.07,0,0]})]})]}),(0,r.jsx)("group",{position:[-.55,1.8,.05],rotation:[-.45,-Math.PI/1.2,-.525],children:(0,r.jsx)(tJ,{})}),(0,r.jsx)("group",{position:[.55,1.8,.05],rotation:[-.45,Math.PI/1.2,.525],children:(0,r.jsx)(tJ,{})}),(0,r.jsx)("group",{name:"LeftFrontArm",position:[-.4,1.525,.1],scale:[-.525,.425,.525],rotation:[.2,Math.PI/3,0],children:(0,r.jsx)(tX,{isLeftHand:!0})}),(0,r.jsx)("group",{name:"RightFrontArm",position:[.4,1.525,.1],scale:[.525,.425,.525],rotation:[.2,-Math.PI/3,0],children:(0,r.jsx)(tX,{isLeftHand:!1})}),(0,r.jsx)("group",{name:"LeftUpperBackArm",position:[-.55,1.6,0],scale:[-1.1,.7,.9],rotation:[0,2*Math.PI,-.4],children:(0,r.jsx)(tX,{isLeftHand:!0})}),(0,r.jsx)("group",{name:"RightUpperBackArm",position:[.55,1.6,0],scale:[1.1,.7,.9],rotation:[0,-(2*Math.PI),.4],children:(0,r.jsx)(tX,{isLeftHand:!1})}),(0,r.jsx)("group",{name:"LeftMiddleBackArm",position:[-.45,1.5,-.1],scale:[-.75,.75,.75],rotation:[.4,2.1*Math.PI,-.4],children:(0,r.jsx)(tX,{isLeftHand:!0})}),(0,r.jsx)("group",{name:"RightMiddleBackArm",position:[.45,1.5,-.1],scale:[.75,.75,.75],rotation:[.4,-(2.1*Math.PI),.4],children:(0,r.jsx)(tX,{isLeftHand:!1})}),(0,r.jsx)("group",{name:"LeftFrontLeg",position:[.4,.75,.4],rotation:[.2,-.6,.6],children:(0,r.jsx)(t$,{})}),(0,r.jsx)("group",{name:"RightFrontLeg",position:[-.4,.75,.4],rotation:[.2,.6,-.6],children:(0,r.jsx)(t$,{})}),(0,r.jsx)("group",{name:"LeftMiddleFrontLeg",position:[.6,.73,0],rotation:[.25,-.8,.7],children:(0,r.jsx)(t$,{})}),(0,r.jsx)("group",{name:"RightMiddleFrontLeg",position:[-.6,.73,0],rotation:[.25,.8,-.7],children:(0,r.jsx)(t$,{})}),(0,r.jsx)("group",{name:"LeftMiddleBackLeg",position:[.5,.71,-.35],rotation:[.5,-1,.7],children:(0,r.jsx)(t$,{})}),(0,r.jsx)("group",{name:"RightMiddleBackLeg",position:[-.5,.71,-.35],rotation:[.5,1,-.7],children:(0,r.jsx)(t$,{})}),(0,r.jsx)("group",{name:"LeftBackLeg",position:[.4,.7,-.725],rotation:[1,-1.2,.6],children:(0,r.jsx)(t$,{})}),(0,r.jsx)("group",{name:"RightBackLeg",position:[-.4,.7,-.725],rotation:[1,1.2,-.6],children:(0,r.jsx)(t$,{})}),(0,r.jsxs)("group",{position:[0,1.925,.245],scale:[.405,.425,.275],children:[(0,r.jsx)("group",{position:[.2,.2,0],rotation:[-.4,.5,-.2],children:(0,r.jsx)(t0,{isLeft:!0})}),(0,r.jsx)("group",{position:[-.2,.2,0],rotation:[-.3,-.5,.3],children:(0,r.jsx)(t0,{isLeft:!1})})]}),(0,r.jsxs)("group",{position:[0,.5,-.25],scale:[1.9,1,1.75],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.35,.34,.27,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,r.jsx)("group",{position:[0,.15,-.16],rotation:[.1,0,0],children:(0,r.jsx)(tV,{})}),[-1,1].map(e=>(0,r.jsx)("group",{position:[.15*e,-.1,0],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.075,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})},e))]})]})}let t2=s.memo(function(e){let{id:t,initialPosition:n,position:o,health:a,maxHealth:l,onTakeDamage:c,onPositionUpdate:u,playerPosition:h,onAttackPlayer:d,weaponType:m}=e,p=(0,s.useRef)(null),x=(0,s.useRef)(Date.now()+2e3),[g,j]=(0,s.useState)(!1),[y,M]=(0,s.useState)(!1),[v,w]=(0,s.useState)(!1),[P,S]=(0,s.useState)(!0),[I,F]=(0,s.useState)(!1),C=(0,s.useRef)(n.clone()),E=(0,s.useRef)(n.clone()),k=(0,s.useRef)(a),R=(0,s.useRef)(new i.Pq0),T=(0,s.useRef)(Date.now()),_=(0,s.useRef)(null),G=(0,s.useRef)(Date.now());(0,s.useEffect)(()=>{k.current=a},[a]);let D=(0,s.useCallback)(e=>{if(k.current<=0)return;let n=Math.max(0,k.current-e);c("enemy-".concat(t),e),0===n&&k.current>0&&(w(!0),M(!0))},[t,c]);(0,s.useEffect)(()=>{o&&(C.current.copy(o),E.current.copy(o),p.current&&p.current.position.copy(o))},[o]);let A=(0,s.useCallback)(()=>{if(!p.current)return null;let e=Math.random()*Math.PI*2,t=6*Math.random();return new i.Pq0(C.current.x+Math.cos(e)*t,0,C.current.z+Math.sin(e)*t)},[]);return(0,f.F)((e,n)=>{if(!p.current||k.current<=0||!h){F(!1);return}if(B.isUnitStealthed()){j(!1);let e=Date.now();if(!_.current||e-G.current>4500){if(_.current){let e=new i.Pq0().subVectors(_.current,C.current).normalize(),t=new i.Pq0().copy(C.current).add(e.multiplyScalar(6));_.current=t}else _.current=A();G.current=e}if(_.current){F(!0);let e=new i.Pq0().subVectors(_.current,C.current).normalize(),t=e.multiplyScalar(1.7999999999999998*n);R.current.lerp(t,2.5*n),C.current.add(R.current),C.current.y=0,p.current.position.copy(C.current);let r=Math.atan2(e.x,e.z)-p.current.rotation.y;for(;r>Math.PI;)r-=2*Math.PI;for(;r<-Math.PI;)r+=2*Math.PI;p.current.rotation.y+=r*Math.min(1,3.5*n);return}}let r=C.current.distanceTo(h);if(r>2.5&&k.current>0){var s;j(!1),F(!0);let e=new i.Pq0().subVectors(h,C.current).normalize(),r=(null===(s=p.current.parent)||void 0===s?void 0:s.children.filter(e=>e!==p.current&&e.position&&4>e.position.distanceTo(C.current)))||[],a=new i.Pq0;r.forEach(e=>{let t=C.current.clone().setY(0),n=e.position.clone().setY(0),r=new i.Pq0().subVectors(t,n).normalize().multiplyScalar(.15/Math.max(.1,n.distanceTo(t)));a.add(r)});let l=e.add(a).normalize();l.y=0;let c=l.multiplyScalar(2.4*n);R.current.lerp(c,5*n),C.current.add(R.current),C.current.y=0,p.current.position.copy(C.current);let d=new i.Pq0().copy(h).setY(C.current.y),m=new i.Pq0().subVectors(d,C.current).normalize(),f=Math.atan2(m.x,m.z)-p.current.rotation.y;for(;f>Math.PI;)f-=2*Math.PI;for(;f<-Math.PI;)f+=2*Math.PI;p.current.rotation.y+=f*Math.min(1,7*n);let x=Date.now();x-T.current>=40&&C.current.distanceTo(o)>.1&&(u(t,C.current.clone()),T.current=x)}else F(!1),R.current.multiplyScalar(1-7*n),R.current.length()>.001&&(C.current.add(R.current),p.current.position.copy(C.current));if(r<=2.5&&k.current>0){let e=Date.now();if(e-x.current>=3e3){j(!0);let t=C.current.clone();for(let e=0;e<6;e++)setTimeout(()=>{let e=C.current.distanceTo(h);k.current>0&&e<=2.5&&.65>t.distanceTo(C.current)&&d(8)},450+300*e);x.current=e,setTimeout(()=>{j(!1)},2850)}}}),(0,s.useEffect)(()=>{0===a&&!v&&(w(!0),M(!0),p.current&&(p.current.visible=!0))},[a,v]),(0,s.useEffect)(()=>{if(v){let e=setTimeout(()=>{var e;M(!1),(null===(e=p.current)||void 0===e?void 0:e.parent)&&p.current.parent.remove(p.current)},3e3);return()=>clearTimeout(e)}},[v]),(0,s.useEffect)(()=>{let e=()=>{F(!0)};return window.addEventListener("stealthBreak",e),()=>{window.removeEventListener("stealthBreak",e)}},[]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("group",{ref:p,visible:!P&&k.current>0,position:C.current,onClick:e=>{e.stopPropagation()},children:[(0,r.jsx)(t1,{position:[0,.765,0],isAttacking:g,isWalking:I&&k.current>0,onHit:D}),(0,r.jsx)(eG.Q,{position:[0,5.5,0],follow:!0,lockX:!1,lockY:!1,lockZ:!1,children:k.current>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("mesh",{position:[0,0,0],children:[(0,r.jsx)("planeGeometry",{args:[2,.25]}),(0,r.jsx)("meshBasicMaterial",{color:"#333333",opacity:.8,transparent:!0})]}),(0,r.jsxs)("mesh",{position:[-1+k.current/l,0,.001],children:[(0,r.jsx)("planeGeometry",{args:[k.current/l*2,.23]}),(0,r.jsx)("meshBasicMaterial",{color:"#ff3333",opacity:.9,transparent:!0})]}),(0,r.jsx)(b.E,{position:[0,0,.002],fontSize:.2,color:"#ffffff",anchorX:"center",anchorY:"middle",fontWeight:"bold",children:"".concat(Math.ceil(k.current),"/").concat(l)})]})})]}),P&&(0,r.jsx)(e0,{position:C.current,onComplete:()=>{S(!1)},isSpawning:!0,scale:1.5}),y&&(0,r.jsx)(e5,{position:C.current,onComplete:()=>{M(!1)},isSpawning:!1,weaponType:m,scale:1.5})]})},(e,t)=>e.health===t.health&&e.position.equals(t.position)&&e.playerPosition.equals(t.playerPosition));e3.abomination,e8.abomination;class t5{initialize(){for(let e=0;e<this.initialSize;e++)this.available.push(this.factory())}acquire(){0===this.available.length&&this.size<this.maxSize&&this.expand();let e=this.available.pop();if(!e)throw Error("Pool exhausted");return this.inUse.add(e),e}release(e){this.inUse.has(e)&&(this.inUse.delete(e),this.available.push(e))}clear(){this.available=[],this.inUse.clear(),this.initialize()}expand(){let e=Math.min(this.size+this.expandSize,this.maxSize)-this.size;for(let t=0;t<e;t++)this.available.push(this.factory())}get size(){return this.available.length+this.inUse.size}constructor(e,t,n,r){this.factory=e,this.initialSize=t,this.expandSize=n,this.maxSize=r,this.available=[],this.inUse=new Set,this.initialize()}}let t3={initialSize:20,expandSize:5,maxSize:30};function t8(e){let{unitProps:{controlsRef:t,...n},onLevelComplete:o,maxSkeletons:a=17,initialSkeletons:l=6,killCount:c}=e,u=(0,s.useMemo)(()=>tn(),[]),h=(0,s.useMemo)(()=>tr(),[]),d=(0,s.useMemo)(()=>ts(),[]),[m]=(0,s.useState)(()=>new t5(()=>{let e=new i.YJl;return e.visible=!1,e},t3.initialSize,t3.expandSize,t3.maxSize)),[f,x]=(0,s.useState)(()=>Array.from({length:l},(e,t)=>{let n=ti();n.y=0;let r=m.acquire();return r.visible=!0,{id:"skeleton-".concat(t),position:n.clone(),initialPosition:n.clone(),rotation:0,health:324,maxHealth:324,ref:{current:r}}})),[g,j]=(0,s.useState)(l),[y,M]=(0,s.useState)(n.health),v=(0,s.useRef)(null),[w,P]=(0,s.useState)(new i.Pq0(0,0,0)),[S,I]=(0,s.useState)(l),b=(0,s.useCallback)(e=>{var t;(null===(t=e.ref)||void 0===t?void 0:t.current)&&(e.ref.current.visible=!1,m.release(e.ref.current))},[m]),F=(0,s.useCallback)((e,t)=>{x(r=>{let s=[...r],i=s.findIndex(t=>t.id===e.replace("enemy-",""));if(-1!==i){let e=Math.max(0,s[i].health-t);if(0===e&&s[i].health>0){var o;s[i]={...s[i],health:e,isDying:!0,deathStartTime:Date.now()},I(e=>Math.max(0,e-1)),null===(o=n.onEnemyDeath)||void 0===o||o.call(n)}else s[i]={...s[i],health:e}}return s})},[n]),C=(0,s.useCallback)(e=>{var t;null===(t=n.onDamage)||void 0===t||t.call(n,e)},[n]),E=(0,s.useCallback)(e=>{P(e)},[]),k=(0,s.useCallback)((e,t)=>{x(n=>n.map(n=>n.id===e.replace("enemy-","")?{...n,position:t.clone()}:n))},[]),R={onHit:F,controlsRef:t,currentWeapon:n.currentWeapon,onWeaponSelect:n.onWeaponSelect,health:y,maxHealth:n.maxHealth,isPlayer:n.isPlayer,abilities:n.abilities,onAbilityUse:n.onAbilityUse,onPositionUpdate:E,onHealthChange:e=>{if("function"==typeof e)M(t=>{var r;let s=e(t);return null===(r=n.onHealthChange)||void 0===r||r.call(n,s),s});else{var t;M(e),null===(t=n.onHealthChange)||void 0===t||t.call(n,e)}},enemyData:f.filter(e=>!e.isDying&&e.health>0).map(e=>({id:"enemy-".concat(e.id),position:e.position.clone(),initialPosition:e.initialPosition.clone(),rotation:e.rotation,health:e.health,maxHealth:e.maxHealth,type:e.type})),onDamage:n.onDamage,onEnemyDeath:()=>{console.log("Kill counted in Scene")},onFireballDamage:n.onFireballDamage,fireballManagerRef:n.fireballManagerRef,onSmiteDamage:n.onSmiteDamage},[T,_]=(0,s.useState)(0);(0,s.useEffect)(()=>{if(g>=a)return;let e=setInterval(()=>{S>=6||c<14&&0===T||c<20&&1===T||c<26&&2===T||x(e=>{let t=a-g;if(t<=0||S>=6)return e;if(1===t){let t=ti();j(e=>e+1),_(e=>e+1);let n=m.acquire();return n.visible=!0,I(e=>e+1),[...e,{id:"abomination-".concat(g),position:t.clone(),initialPosition:t.clone(),rotation:0,health:841,maxHealth:841,isDying:!1,type:"abomination",ref:{current:n}}]}let n=ti(),r=(g+1)%4==0,s=m.acquire();s.visible=!0;let i=r?{id:"mage-".concat(g),position:n.clone(),initialPosition:n.clone(),rotation:0,health:289,maxHealth:289,isDying:!1,type:"mage",ref:{current:s}}:{id:"skeleton-".concat(g),position:n.clone(),initialPosition:n.clone(),rotation:0,health:324,maxHealth:324,isDying:!1,type:"regular",ref:{current:s}};return j(e=>e+1),I(e=>e+1),[...e,i]})},2500);return()=>clearInterval(e)},[g,a,c,T,m,S]),(0,s.useEffect)(()=>{t.current&&(t.current.object.position.set(0,12,-18),t.current.target.set(0,0,0),t.current.update())},[t]),(0,s.useEffect)(()=>{x(e=>{let t=Date.now();return e.filter(e=>e.isDying&&e.deathStartTime?!(t-e.deathStartTime>=1500)||(b(e),!1):e.health>0)})},[f,b]),(0,s.useEffect)(()=>{let e=v.current;return()=>{x([]),e&&e.clear(),P(new i.Pq0(0,0,0)),j(l)}},[l]),(0,s.useEffect)(()=>(e4(),e3.mountain=new i.qFE(23,35,12),e3.mushroom=new i.Ho_(.25,.30625,4,8),e3.tree=new i.Ho_(.25,.30625,4,8),e8.mountain=new i.uSd({color:"#2a2a2a",metalness:.1,roughness:1,emissive:"#222222",flatShading:!0,clearcoat:.1,clearcoatRoughness:.8}),()=>{e6()}),[]);let G=(0,s.useCallback)(()=>{x(e=>(e.forEach(e=>{var t,n;b(e),null===(n=e.ref)||void 0===n||null===(t=n.current)||void 0===t||t.traverse(e=>{if("geometry"in e&&e.geometry instanceof i.LoY&&!Object.values(e3).includes(e.geometry)&&e.geometry.dispose(),"material"in e){let t=e.material;Array.isArray(t)?t.forEach(e=>{Object.values(e8).includes(e)||e.dispose()}):t&&!Object.values(e8).includes(t)&&t.dispose()}})}),[])),m.clear()},[m,b]);return(0,s.useEffect)(()=>G,[G]),(0,s.useEffect)(()=>{let e=f.every(e=>e.health<=0),t=g>=a;e&&t&&o()},[f,g,a,o]),(0,s.useEffect)(()=>{console.log("Enemy Data:",f.map(e=>({id:e.id,position:e.position,health:e.health})))},[f]),(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("group",{children:[(0,r.jsx)(tt,{}),(0,r.jsx)(e9,{}),(0,r.jsx)(p,{}),(0,r.jsx)(tc,{}),(0,r.jsx)(ta,{mountains:u}),(0,r.jsx)(to,{trees:h}),(0,r.jsx)(tl,{mushrooms:d}),(0,r.jsx)("group",{ref:v,children:(0,r.jsx)(e_,{...R})}),f.map(e=>"abomination"===e.type?(0,r.jsx)(t2,{id:e.id,initialPosition:e.initialPosition,position:e.position,health:e.health,maxHealth:e.maxHealth,onTakeDamage:F,onPositionUpdate:k,playerPosition:w,onAttackPlayer:C,weaponType:n.currentWeapon},e.id):"mage"===e.type?(0,r.jsx)(tq,{id:e.id,initialPosition:e.initialPosition,position:e.position,health:e.health,maxHealth:e.maxHealth,onTakeDamage:F,onPositionUpdate:k,playerPosition:w,onAttackPlayer:C,weaponType:n.currentWeapon},e.id):(0,r.jsx)(e7,{id:e.id,initialPosition:e.initialPosition,position:e.position,health:e.health,maxHealth:e.maxHealth,onTakeDamage:F,onPositionUpdate:k,playerPosition:w,onAttackPlayer:C,weaponType:n.currentWeapon},e.id))]})})}let t4=()=>(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("boxGeometry",{args:[.055,.015,.015]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff0000",transparent:!0,opacity:.35,emissive:"#ff0000",emissiveIntensity:.4})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.0285,6,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:.9,transparent:!0,opacity:.6})]})]});function t6(e){let{parentRef:t}=e,n=(0,s.useRef)([]),i=(0,s.useRef)(null);return(0,f.F)(e=>{let{clock:r}=e;if(!t.current||!i.current)return;let s=t.current.position;i.current.position.set(s.x,0,s.z),n.current.forEach((e,t)=>{if(!e)return;let n=r.getElapsedTime(),s=t/25*.65,i=t/25*Math.PI*4+2*n,o=.45*(1.1-1.5*s),a=Math.cos(i)*o,l=Math.sin(i)*o;e.position.set(a,s,l),e.rotation.y=i+Math.PI/2,e.rotation.x=Math.PI/6,e.rotation.z=.1*Math.sin(3*n+t);let c=e.children[0];c&&c.material&&(c.material.opacity=Math.max(.1,1-2*s))})}),(0,r.jsxs)("group",{ref:i,children:[Array.from({length:25}).map((e,t)=>(0,r.jsx)("group",{ref:e=>{e&&(n.current[t]=e)},children:t4()},t)),(0,r.jsx)("pointLight",{color:"#ff0000",intensity:10,distance:15,decay:2,position:[0,.5,0]})]})}let t7=e=>{let{parentRef:t}=e,n=(0,s.useRef)(null),o=(0,s.useRef)(new Float32Array(24)),a=(0,s.useRef)(new Float32Array(8)),l=(0,s.useRef)(new Float32Array(8)),c=(0,s.useRef)(0);return(0,f.F)((e,r)=>{var s;if(!(null===(s=n.current)||void 0===s?void 0:s.parent)||!t.current)return;c.current+=r;let i=t.current.position;for(let e=0;e<8;e++){let t=e/8*Math.PI*2+c.current,n=.1*+Math.sin(2*c.current+.2*e);o.current[3*e]=i.x+Math.cos(t)*n,o.current[3*e+1]=i.y+1e-4*Math.sin(c.current+.1*e),o.current[3*e+2]=i.z+Math.sin(t)*n,a.current[e]=.25*Math.pow(1-e/8,1.5),l.current[e]=.4*Math.pow(1-e/8,.6)}if(n.current){let e=n.current.geometry;e.attributes.position.needsUpdate=!0,e.attributes.opacity.needsUpdate=!0,e.attributes.scale.needsUpdate=!0}}),(0,r.jsxs)("points",{ref:n,children:[(0,r.jsxs)("bufferGeometry",{children:[(0,r.jsx)("bufferAttribute",{attach:"attributes-position",count:8,array:o.current,itemSize:3}),(0,r.jsx)("bufferAttribute",{attach:"attributes-opacity",count:8,array:a.current,itemSize:1}),(0,r.jsx)("bufferAttribute",{attach:"attributes-scale",count:8,array:l.current,itemSize:1})]}),(0,r.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:i.EZo,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 20.0 * (300.0 / -mvPosition.z);\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.5, 0.1, d);\n            vec3 glowColor = mix(vec3(0.8, 0.1, 0.1), vec3(1.0, 0.3, 0.3), 0.4);\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        "})]})};function t9(e){let{isSwinging:t,onSwingComplete:n}=e,o=(0,s.useRef)(null),a=(0,s.useRef)(0),l=[-1.055,1.1,.35];return(0,f.F)((e,r)=>{if(t&&o.current){a.current+=2.7*r;let e=Math.min(a.current/Math.PI/1.5,1);if(a.current>=.5*Math.PI){a.current=0,o.current.rotation.set(0,0,0),o.current.position.set(...l),n();return}let t=e<=.25?2*e:.5-(e-.25),s=l[0]+-2*Math.sin(t*Math.PI),i=l[1]+-1.2*Math.sin(t*Math.PI),c=l[2]+.9*Math.cos(t*Math.PI);o.current.position.set(s,i,c);let u=Math.PI/4*Math.sin(t*Math.PI),h=Math.PI/2*Math.sin(t*Math.PI),d=Math.PI/4*Math.sin(t*Math.PI);o.current.rotation.set(u,h,d)}else!t&&o.current&&(o.current.rotation.x*=.85,o.current.rotation.y*=.85,o.current.rotation.z*=.85,o.current.position.x+=(l[0]-o.current.position.x)*.2,o.current.position.y+=(l[1]-o.current.position.y)*.2,o.current.position.z+=(l[2]-o.current.position.z)*.2)}),(0,r.jsxs)("group",{ref:o,position:[l[0],l[1],l[2]],rotation:[0,0,Math.PI],scale:[1,1,1],children:[(0,r.jsxs)("group",{position:[0,-.7,0],rotation:[0,0,-Math.PI],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.05,.05,2.5,12]}),(0,r.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.7,transparent:!0,opacity:.5})]}),[...Array(7)].map((e,t)=>(0,r.jsxs)("mesh",{position:[0,.81-.3*t,0],rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("torusGeometry",{args:[.06,.01,8,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#8B4513",metalness:.3,roughness:.7,transparent:!0,opacity:.5})]},t))]}),(0,r.jsxs)("group",{position:[0,.35,0],rotation:[Math.PI/1,0,Math.PI],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.08,.08,.3,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.6})]}),(0,r.jsx)("group",{"rotation-x":(0,f.F)(e=>2*e.clock.getElapsedTime()),children:(0,r.jsxs)("mesh",{"position-y":-.075,rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("torusGeometry",{args:[.145,.02,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff3300",emissive:"#ff3300",emissiveIntensity:1.5,transparent:!0,opacity:.7})]})}),(0,r.jsx)("group",{"rotation-x":(0,f.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,r.jsxs)("mesh",{"position-y":.03,rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("torusGeometry",{args:[.175,.02,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:1.5,transparent:!0,opacity:.7})]})}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.13,.11,.32,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff1a1a",emissive:"#ff1a1a",emissiveIntensity:1.5,transparent:!0,opacity:.3})]})]}),(0,r.jsx)("group",{position:[0,.375,1.175],rotation:[-1,-Math.PI/2,Math.PI/2.2],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("extrudeGeometry",{args:[(()=>{let e=new i.ypk;return e.moveTo(0,0),e.lineTo(.15,-.23),e.bezierCurveTo(.8,.22,1.13,.5,1.6,.6),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e})(),{steps:1,depth:1e-4,bevelEnabled:!0,bevelThickness:.03,bevelSize:.035,bevelSegments:1,curveSegments:16,depth:.03}]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:1.25,metalness:.8,roughness:.1,opacity:.5,transparent:!0,side:i.$EB})]})})]})}function ne(e){let{isSwinging:t,onSwingComplete:n}=e,o=(0,s.useRef)(null),a=(0,s.useRef)(0),l=[-1.055,1.1,.35];return(0,f.F)((e,r)=>{if(t&&o.current){a.current+=2.7*r;let e=Math.min(a.current/Math.PI/1.5,1);if(a.current>=.5*Math.PI){a.current=0,o.current.rotation.set(0,0,0),o.current.position.set(...l),n();return}let t=e<=.25?2*e:.5-(e-.25),s=l[0]+2*Math.sin(t*Math.PI),i=l[1]+-1.2*Math.sin(t*Math.PI),c=l[2]+.9*Math.cos(t*Math.PI);o.current.position.set(s,i,c);let u=Math.PI/4*Math.sin(t*Math.PI),h=Math.PI/2*Math.sin(t*Math.PI),d=Math.PI/4*Math.sin(t*Math.PI);o.current.rotation.set(u,h,d)}else!t&&o.current&&(o.current.rotation.x*=.85,o.current.rotation.y*=.85,o.current.rotation.z*=.85,o.current.position.x+=(l[0]-o.current.position.x)*.2,o.current.position.y+=(l[1]-o.current.position.y)*.2,o.current.position.z+=(l[2]-o.current.position.z)*.2)}),(0,r.jsxs)("group",{ref:o,position:[l[0],l[1],l[2]],rotation:[0,0,Math.PI],scale:[1,1,1],children:[(0,r.jsxs)("group",{position:[0,-.7,0],rotation:[0,0,-Math.PI],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.05,.05,2.5,12]}),(0,r.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.7,transparent:!0,opacity:.5})]}),[...Array(7)].map((e,t)=>(0,r.jsxs)("mesh",{position:[0,.81-.3*t,0],rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("torusGeometry",{args:[.06,.01,8,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#8B4513",metalness:.3,roughness:.7,transparent:!0,opacity:.5})]},t))]}),(0,r.jsxs)("group",{position:[0,.35,0],rotation:[Math.PI/1,0,Math.PI],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.08,.08,.3,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.6})]}),(0,r.jsx)("group",{"rotation-x":(0,f.F)(e=>2*e.clock.getElapsedTime()),children:(0,r.jsxs)("mesh",{"position-y":-.075,rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("torusGeometry",{args:[.145,.02,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff3300",emissive:"#ff3300",emissiveIntensity:1.5,transparent:!0,opacity:.7})]})}),(0,r.jsx)("group",{"rotation-x":(0,f.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,r.jsxs)("mesh",{"position-y":.03,rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("torusGeometry",{args:[.175,.02,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:1.5,transparent:!0,opacity:.7})]})}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.13,.11,.32,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff1a1a",emissive:"#ff1a1a",emissiveIntensity:1.5,transparent:!0,opacity:.3})]})]}),(0,r.jsx)("group",{position:[0,.375,1.175],rotation:[-1,-Math.PI/2,Math.PI/2.2],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("extrudeGeometry",{args:[(()=>{let e=new i.ypk;return e.moveTo(0,0),e.lineTo(.15,-.23),e.bezierCurveTo(.8,.22,1.13,.5,1.6,.6),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e})(),{steps:1,depth:1e-4,bevelEnabled:!0,bevelThickness:.03,bevelSize:.035,bevelSegments:1,curveSegments:16,depth:.03}]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:1.25,metalness:.8,roughness:.1,opacity:.5,transparent:!0,side:i.$EB})]})})]})}let nt=()=>(0,r.jsxs)("group",{rotation:[Math.PI/3.75,0,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.04,.04,.7,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.4,metalness:.3})]}),(0,r.jsxs)("mesh",{position:new i.Pq0(0,.375,0),rotation:new i.O9p(0,0,Math.PI/3),children:[(0,r.jsx)("sphereGeometry",{args:[.075,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.5,metalness:.2})]}),(0,r.jsxs)("mesh",{position:new i.Pq0(0,-.375,0),rotation:new i.O9p(0,0,-Math.PI/3),children:[(0,r.jsx)("sphereGeometry",{args:[.075,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.5,metalness:.2})]})]});function nn(e){let{parentRef:t}=e,n=(0,s.useRef)([]),i=(0,s.useRef)(null);return(0,f.F)(()=>{if(!t.current||!i.current)return;let e=t.current.position;i.current.position.set(e.x,.3,e.z),n.current.forEach((e,t)=>{let n=t/18*Math.PI*2+8e-4*Date.now(),r=-(.915*Math.cos(n)),s=.915*Math.sin(n),i=1e-4*Math.sin(.001*Date.now()+t);e.position.set(r,i-.2,s),e.rotation.y=n+Math.PI/3})}),(0,r.jsx)("group",{ref:i,children:Array.from({length:18}).map((e,t)=>(0,r.jsx)("mesh",{ref:e=>{e&&(n.current[t]=e)},children:nt()},t))})}let nr=new i._4j({color:"#e8e8e8",roughness:.4,metalness:.3}),ns=new i._4j({color:"#d4d4d4",roughness:.3,metalness:.4}),ni=new i.Gu$(.06,6,6),no=new i.Ho_(.06,.048,1,4);function na(e){let{isAttacking:t}=e,n=(0,s.useRef)(null);return(0,r.jsxs)("group",{ref:n,children:[(0,r.jsx)("group",{scale:[.7,.65,.7],position:[0,2.05,.35],rotation:[.5,0,0],children:(0,r.jsx)(tL,{})}),(0,r.jsx)("group",{scale:[1.3,1.1,1.3],position:[0,1.5,0],rotation:[.3,0,0],children:(0,r.jsx)(_,{})}),(0,r.jsxs)("group",{scale:[1.85,1.55,1.625],position:[0,1.85,0],children:[(0,r.jsx)("group",{rotation:[0,Math.PI/7,0],children:(0,r.jsx)(k,{collectedBones:15,isLeftWing:!0,parentRef:n})}),(0,r.jsx)("group",{rotation:[0,-Math.PI/7,0],children:(0,r.jsx)(k,{collectedBones:15,isLeftWing:!1,parentRef:n})})]}),(0,r.jsxs)("group",{scale:[1.7,1.525,1.525],position:[0,1.95,0],children:[(0,r.jsx)("group",{rotation:[0,Math.PI/4,0],children:(0,r.jsx)(k,{collectedBones:15,isLeftWing:!0,parentRef:n})}),(0,r.jsx)("group",{rotation:[0,-Math.PI/4,0],children:(0,r.jsx)(k,{collectedBones:15,isLeftWing:!1,parentRef:n})})]}),(0,r.jsxs)("group",{scale:[.625,.625,.625],position:[0,1.6,0],children:[(0,r.jsx)("group",{position:[-.775,.15,.1],rotation:[0,-(Math.PI/2),0],children:(0,r.jsx)(nl,{})}),(0,r.jsx)("group",{position:[.775,.15,.1],rotation:[0,-Math.PI/6,0],children:(0,r.jsx)(nl,{})})]}),(0,r.jsx)("group",{scale:[1.5,1.5,1.5],position:[0,1.7,.16],children:(0,r.jsx)(G,{})}),(0,r.jsx)("group",{position:[0,1.4,0],scale:[1.05,1.05,1.05],children:(0,r.jsx)(t7,{parentRef:n})}),(0,r.jsx)("group",{position:[0,2.15,.275],scale:[.525,.525,.525],children:(0,r.jsx)(t7,{parentRef:n})}),(0,r.jsxs)("group",{scale:[2.1,2.25,2.1],position:[0,-.325,0],children:[(0,r.jsx)("group",{position:[0,0,.11],rotation:[0,0,0],children:(0,r.jsx)(t6,{parentRef:n})}),(0,r.jsx)("group",{position:[0,0,-.11],rotation:[0,Math.PI,0],children:(0,r.jsx)(t6,{parentRef:n})})]}),(0,r.jsx)("group",{position:[.5,2.6,.2],rotation:[Math.PI/3+.2,1+Math.PI+1.15,1.45],scale:[.6,.6,.6],children:(0,r.jsx)(ne,{isSwinging:t,onSwingComplete:()=>{},parentRef:n})}),(0,r.jsx)("group",{position:[-.5,2.31,-1],rotation:[Math.PI/3+.2,-(1+Math.PI+1.15),-1.45],scale:[.6,.6,.6],children:(0,r.jsx)(t9,{isSwinging:t,onSwingComplete:()=>{},parentRef:n})}),(0,r.jsx)("group",{position:[0,.15,0],scale:[.9,.9,.9],children:(0,r.jsx)(nn,{parentRef:n})}),(0,r.jsx)("pointLight",{position:[0,.1,0],color:"#ff0000",intensity:4,distance:12,decay:2}),(0,r.jsx)("group",{position:[0,0,0]})]})}function nl(){let e=(e,t)=>(0,r.jsx)("mesh",{geometry:no,scale:[t/.06,e,t/.06],children:(0,r.jsx)("meshStandardMaterial",{...nr})}),t=e=>(0,r.jsx)("mesh",{geometry:ni,scale:[e/.06,e/.06,e/.06],children:(0,r.jsx)("meshStandardMaterial",{...nr})}),n=(n,s)=>(0,r.jsxs)("group",{children:[(0,r.jsx)("group",{position:[s/2,0,0],children:e(n,.06)}),(0,r.jsx)("group",{position:[-s/2,0,0],children:e(n,.06)}),(0,r.jsx)("group",{position:[0,n/2,0],children:t(.17)}),(0,r.jsx)("group",{position:[0,-n/2,0],children:t(.075)})]}),s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return(0,r.jsxs)("group",{scale:[e,e,e],children:[(0,r.jsxs)("mesh",{position:[0,0,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.06,.02,.12,4]})," ",(0,r.jsx)("meshStandardMaterial",{...nr})]}),(0,r.jsxs)("mesh",{position:[0,.1,.02],rotation:[.05,0,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.025,.025,.12,4]})," ",(0,r.jsx)("meshStandardMaterial",{...nr})]}),(0,r.jsxs)("mesh",{position:[0,.2,.04],rotation:[.1,0,0],children:[(0,r.jsx)("coneGeometry",{args:[.03,.15,4]})," ",(0,r.jsx)("meshStandardMaterial",{...ns})]}),[0,Math.PI/2,Math.PI,3*Math.PI/2].map((e,t)=>(0,r.jsx)("group",{rotation:[0,e,0],children:(0,r.jsxs)("mesh",{position:[.04,.05,0],children:[(0,r.jsx)("boxGeometry",{args:[.01,.12,.02]}),(0,r.jsx)("meshStandardMaterial",{...ns})]})},t))]})};return(0,r.jsx)("group",{children:(0,r.jsxs)("group",{children:[n(1,.15),(0,r.jsx)("group",{position:[0,.7,0],rotation:[-1,1,1],scale:.5,children:[-.03,0,.03].map((e,t)=>(0,r.jsx)("group",{position:[e,-.275,-.15],rotation:[.4,0,(t-1)*Math.PI/4],children:(0,r.jsxs)("group",{position:[0,.4,0],scale:[1.35,1.35,1.35],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.075,.5,.2,4,1]})," ",(0,r.jsx)("meshStandardMaterial",{...nr})]}),(0,r.jsxs)("group",{position:[0,.25,0],children:[(0,r.jsx)("group",{position:[0,0,0],children:s(2)}),(0,r.jsx)("group",{position:[0,-.05,.15],rotation:[-.1,0,0],children:s(.9)}),(0,r.jsx)("group",{position:[0,-.05,-.15],rotation:[.1,0,0],children:s(.9)})]})]})},t))}),(0,r.jsxs)("group",{position:[.25,-.85,.21],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.12,12,12]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("group",{rotation:[-.7,-0,Math.PI/5],children:[n(.8,.12),(0,r.jsxs)("group",{position:[0,-.5,0],rotation:[0,0,Math.PI/5.5],children:[t(.09),(0,r.jsxs)("group",{position:[0,-.1,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("boxGeometry",{args:[.2,.15,.08]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4})]}),[-.08,-.04,0,.04,.08].map((t,n)=>(0,r.jsxs)("group",{position:[t,-.1,0],rotation:[0,0,(n-2)*Math.PI/10],children:[e(.5,.02),(0,r.jsx)("group",{position:[.025,-.3,0],rotation:[0,0,Math.PI+Math.PI/16],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("coneGeometry",{args:[.03,.3,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})})]},n))]})]})]})]})]})})}function nc(e){let{color:t,size:n,meshRef:o}=e,a=(0,s.useRef)(null),l=(0,s.useRef)(new Float32Array(33)),c=(0,s.useRef)(new Float32Array(11)),u=(0,s.useRef)(new Float32Array(11)),h=(0,s.useRef)(!1);return(0,s.useEffect)(()=>{if(o.current&&!h.current){let e=o.current.position;for(let t=0;t<11;t++)l.current[3*t]=e.x,l.current[3*t+1]=e.y,l.current[3*t+2]=e.z,c.current[t]=0,u.current[t]=0;h.current=!0}},[o]),(0,f.F)(()=>{var e;if(!(null===(e=a.current)||void 0===e?void 0:e.parent)||!o.current||!h.current)return;let t=o.current.position;for(let e=10;e>0;e--)l.current[3*e]=l.current[(e-1)*3],l.current[3*e+1]=l.current[(e-1)*3+1]+.5,l.current[3*e+2]=l.current[(e-1)*3+2],c.current[e]=.9*Math.pow(1-e/11,.3),u.current[e]=n*(2-e/11*.5);if(l.current[0]=t.x,l.current[1]=t.y,l.current[2]=t.z,c.current[0]=.9,u.current[0]=.8*n,a.current){let e=a.current.geometry;e.attributes.position.array=l.current,e.attributes.position.needsUpdate=!0,e.attributes.opacity&&(e.attributes.opacity.array=c.current,e.attributes.opacity.needsUpdate=!0),e.attributes.scale&&(e.attributes.scale.array=u.current,e.attributes.scale.needsUpdate=!0)}}),(0,r.jsxs)("points",{ref:a,children:[(0,r.jsxs)("bufferGeometry",{children:[(0,r.jsx)("bufferAttribute",{attach:"attributes-position",count:11,array:l.current,itemSize:3}),(0,r.jsx)("bufferAttribute",{attach:"attributes-opacity",count:11,array:c.current,itemSize:1}),(0,r.jsx)("bufferAttribute",{attach:"attributes-scale",count:11,array:u.current,itemSize:1})]}),(0,r.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:i.EZo,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 45.0 * (300.0 / -mvPosition.z);\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          uniform vec3 uColor;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.5, 0.1, d);\n            vec3 glowColor = mix(uColor, vec3(1.0), 0.4);\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        ",uniforms:{uColor:{value:t}}})]})}let nu=new i.Gu$(.75,16,16),nh=new i.V9B({color:"#ff4400"}),nd=new i.rKP(2.75,2.95,32),nm=new i.rKP(2.95-.8,2.35,32),np=new i.rKP(2.7,2.95,32),nf=new i.Gu$(.1,8,8),nx=new i.Pq0,ng=new i.Pq0,nj=(e,t,n)=>{let s=(Date.now()-t)/1e3,o=Math.max(0,1-s/2);return o<=0?(n(),null):(0,r.jsxs)("group",{position:e,children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[1.2*(2+s),32,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff2200",emissive:"#ff4400",emissiveIntensity:2*o,transparent:!0,opacity:1.8*o,depthWrite:!1,blending:i.EZo})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[1,24,24]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff8800",emissive:"#ffffff",emissiveIntensity:2*o,transparent:!0,opacity:1.9*o,depthWrite:!1,blending:i.EZo})]}),[2,2.15,2.3,2.5,2.7].map((e,t)=>(0,r.jsxs)("mesh",{rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,r.jsx)("torusGeometry",{args:[e*(1.125+2*s),.225,4,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff2200",emissive:"#ff4400",emissiveIntensity:.7*o,transparent:!0,opacity:.95*o*(1-.1*t),depthWrite:!1,blending:i.EZo})]},t)),(0,r.jsx)("pointLight",{color:"#ff2200",intensity:.8*o,distance:8*(1+s),decay:2}),(0,r.jsx)("pointLight",{color:"#ff8800",intensity:.8*o,distance:12,decay:1})]})};function ny(e){var t;let{targetPosition:n,onImpact:o,onComplete:a,playerPosition:l}=e,c=(0,s.useRef)(null),u=(0,s.useRef)(null),[h,d,m]=s.useMemo(()=>{let e=new i.Pq0(n.x,-5,n.z),t=new i.Pq0(n.x,60,n.z),r=new i.Pq0().subVectors(e,t).normalize();return[e,t,r]},[n]),[p,x]=(0,s.useState)({impactOccurred:!1,showMeteor:!1,impactStartTime:null});(0,s.useEffect)(()=>{let e=setTimeout(()=>{x(e=>({...e,showMeteor:!0}))},1090);return()=>clearTimeout(e)},[]),(0,f.F)((e,t)=>{if(!c.current||!p.showMeteor||p.impactOccurred){p.impactOccurred&&!p.impactStartTime&&x(e=>({...e,impactStartTime:Date.now()}));return}let n=c.current.position;(2.95>n.distanceTo(h)||n.y<=.1)&&(x(e=>({...e,impactOccurred:!0,impactStartTime:Date.now()})),nx.set(l.x,0,l.z),ng.set(h.x,0,h.z),2.95>=nx.distanceTo(ng)&&o(72)),n.addScaledVector(m,27.75*t)});let g=(0,s.useCallback)(()=>{let e=1+.2*Math.sin(.005*Date.now());return[e,e,1]},[]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("group",{position:[h.x,.1,h.z],children:[(0,r.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],children:[(0,r.jsx)("primitive",{object:nd}),(0,r.jsx)("meshBasicMaterial",{color:"#ff2200",transparent:!0,opacity:.4,side:i.$EB})]}),(0,r.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],scale:g(),children:[(0,r.jsx)("primitive",{object:nm}),(0,r.jsx)("meshBasicMaterial",{color:"#ff4400",transparent:!0,opacity:.4+.2*Math.sin(.003*Date.now()),side:i.$EB})]}),(0,r.jsxs)("mesh",{rotation:[-Math.PI/2,.0035*Date.now(),0],children:[(0,r.jsx)("primitive",{object:np}),(0,r.jsx)("meshBasicMaterial",{color:"#ff3300",transparent:!0,opacity:.25,side:i.$EB})]}),[...Array(12)].map((e,t)=>(0,r.jsxs)("mesh",{position:[2.45*Math.sin(.001*Date.now()+t),.5*Math.sin(.002*Date.now()+t),2.45*Math.cos(.001*Date.now()+t)],children:[(0,r.jsx)("primitive",{object:nf}),(0,r.jsx)("meshBasicMaterial",{color:"#ff3300",transparent:!0,opacity:.3+.2*Math.sin(.004*Date.now()+t)})]},t))]}),p.showMeteor&&(0,r.jsx)("group",{ref:c,position:d,children:(0,r.jsxs)("mesh",{ref:u,children:[(0,r.jsx)("primitive",{object:nu}),(0,r.jsx)("primitive",{object:nh}),(0,r.jsx)("pointLight",{color:"#ff4400",intensity:5,distance:8}),(0,r.jsx)(nc,{meshRef:u,color:new i.Q1f("#ff4400"),size:.09})]})}),p.impactStartTime&&nj((null===(t=c.current)||void 0===t?void 0:t.position)||h,p.impactStartTime,a)]})}function nM(e){let{position:t,duration:n,range:o}=e,a=(0,s.useRef)(null),l=(0,s.useRef)(Date.now());return(0,f.F)(()=>{if(!a.current)return;let e=(Date.now()-l.current)/1e3,t=Math.min(e/n,1),r=1+.15*Math.sin(8*e);a.current.scale.setScalar(r),t>.7&&(a.current.material.opacity=.6*(1-(t-.7)/.3))}),(0,r.jsxs)("group",{position:[t.x,.5,t.z],children:[(0,r.jsxs)("mesh",{ref:a,rotation:[-Math.PI/2,0,0],children:[(0,r.jsx)("ringGeometry",{args:[o-.2,o,64]}),(0,r.jsx)("meshBasicMaterial",{color:"#ff3300",transparent:!0,opacity:.6,side:i.$EB})]}),(0,r.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],children:[(0,r.jsx)("ringGeometry",{args:[o-.8,o-.6,64]}),(0,r.jsx)("meshBasicMaterial",{color:"#ff4400",transparent:!0,opacity:.2,side:i.$EB})]})]})}function nv(e){let{id:t,initialPosition:n,position:o,health:a,maxHealth:l,onTakeDamage:c,onPositionUpdate:u,playerPosition:h,onAttackPlayer:d,onEnrageSpawn:m}=e,p=(0,s.useRef)(null),x=(0,s.useRef)(Date.now()+2e3),g=(0,s.useRef)(Date.now()),j=(0,s.useRef)(n.clone()),y=(0,s.useRef)(h.clone()),M=(0,s.useRef)(a),[v,w]=(0,s.useState)(!1),[P,S]=(0,s.useState)(!1),[I,F]=(0,s.useState)(!0),[C,E]=(0,s.useState)(!1),[k,R]=(0,s.useState)(!1),[T,_]=(0,s.useState)(!1),G=(0,s.useRef)(3500),D=(0,s.useRef)(7e3),A=(0,s.useRef)(new i.Pq0),z=(0,s.useRef)(Date.now());(0,s.useEffect)(()=>{y.current.copy(h)},[h]),(0,s.useEffect)(()=>{o&&(j.current.copy(o),p.current&&p.current.position.copy(j.current))},[o]),(0,s.useEffect)(()=>{M.current=a},[a]),(0,s.useEffect)(()=>{let e=a<=l/2,t=3500===G.current;e&&t&&(null==m||m()),G.current=e?2250:3500,D.current=e?4750:7e3},[a,l,m]),(0,s.useEffect)(()=>{let e=setTimeout(()=>{F(!1)},2e3);return()=>clearTimeout(e)},[]),(0,s.useEffect)(()=>{0!==a||P||(console.log("Boss ".concat(t," died")),S(!0))},[a,t,P]);let q=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=j.current;return!(new i.Pq0(n.x-e.x,0,n.z-e.z).length()>4)&&4>=Math.abs(e.y+t-(n.y+2))},[]),B=(0,s.useCallback)((e,n)=>{!(M.current<=0)&&n&&q(n)&&(c("enemy-".concat(t),e),0===Math.max(0,M.current-e)&&M.current>0&&S(!0))},[t,c,q]),L=(0,s.useCallback)(()=>{v||T||Date.now()-x.current<G.current||(R(!0),x.current=Date.now(),_(!0),setTimeout(()=>{R(!1),w(!0),setTimeout(()=>{let e=j.current.clone();e.y=0;let t=y.current.clone();t.y=0,5>=e.distanceTo(t)&&d(0)},270),setTimeout(()=>{w(!1),setTimeout(()=>{_(!1)},G.current)},540)},1500))},[v,T,d,0,5]),O=(0,s.useCallback)(()=>{!C&&Date.now()-g.current>=D.current&&(E(!0),g.current=Date.now(),setTimeout(()=>{E(!1)},3500))},[C]);return(0,f.F)((e,n)=>{if(!p.current||a<=0)return;let r=j.current.distanceTo(y.current);if(!C&&Date.now()-g.current>=D.current&&O(),r>4.625&&a>0){w(!1);let e=new i.Pq0().subVectors(y.current,j.current).normalize().multiplyScalar(2.1*n);A.current.lerp(e,4*n),j.current.add(A.current),j.current.y=0,p.current.position.copy(j.current);let r=y.current.clone().setY(j.current.y),s=new i.Pq0().subVectors(r,j.current).normalize(),a=Math.atan2(s.x,s.z)-p.current.rotation.y;for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;p.current.rotation.y+=a*Math.min(1,6*n);let l=Date.now();l-z.current>=50&&j.current.distanceTo(o)>.1&&(u(t,j.current.clone()),z.current=l)}else A.current.multiplyScalar(1-6*n),A.current.length()>.001&&(j.current.add(A.current),p.current.position.copy(j.current));Date.now()-x.current>=G.current&&(L(),x.current=Date.now())}),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("group",{ref:p,visible:!I&&a>0,position:j.current,scale:[1.595,1.595,1.595],onClick:e=>e.stopPropagation(),children:[(0,r.jsx)(na,{isAttacking:v,isWalking:!v&&a>0,onHit:B,playerPosition:h}),(0,r.jsx)(eG.Q,{position:[0,4,0],follow:!0,lockX:!1,lockY:!1,lockZ:!1,children:M.current>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("mesh",{position:[0,0,0],children:[(0,r.jsx)("planeGeometry",{args:[4,.4]}),(0,r.jsx)("meshBasicMaterial",{color:"#333333",opacity:.8,transparent:!0})]}),(0,r.jsxs)("mesh",{position:[-2+M.current/l*2,0,.001],children:[(0,r.jsx)("planeGeometry",{args:[M.current/l*4,.35]}),(0,r.jsx)("meshBasicMaterial",{color:"#ff0000",opacity:.9,transparent:!0})]}),(0,r.jsx)(b.E,{position:[0,0,.002],fontSize:.3,color:"#ffffff",anchorX:"center",anchorY:"middle",fontWeight:"bold",children:"".concat(Math.ceil(M.current),"/").concat(l)})]})})]}),C&&(0,r.jsx)(ny,{targetPosition:y.current,onImpact:e=>d(e),onComplete:()=>E(!1),playerPosition:y.current}),k&&(0,r.jsx)(nM,{position:j.current,duration:1,range:5})]})}let nw=new i.Pq0(0,0,0),nP={initialSize:20,expandSize:5,maxSize:30};function nS(e){let{unitProps:t,skeletonProps:n,killCount:o,onLevelComplete:a,spawnInterval:l=5500,maxSkeletons:c=23,initialSkeletons:u=5}=e,h=(0,s.useMemo)(()=>tn(),[]),d=(0,s.useMemo)(()=>tr(),[]),m=(0,s.useMemo)(()=>ts(),[]),[f,x]=(0,s.useState)(!1),[g,j]=(0,s.useState)(u||5),[y,M]=(0,s.useState)(u),[v]=(0,s.useState)(()=>new t5(()=>{let e=new i.YJl;return e.visible=!1,e},nP.initialSize,nP.expandSize,nP.maxSize)),[w,P]=(0,s.useState)(()=>n.map((e,t)=>{let n=v.acquire();return n.visible=!0,{id:"skeleton-".concat(t),position:e.initialPosition.clone(),initialPosition:e.initialPosition.clone(),currentPosition:e.initialPosition.clone(),health:361,maxHealth:361,ref:{current:n},rotation:0}})),[S,I]=(0,s.useState)(t.health),b=(0,s.useRef)(null),[F,C]=(0,s.useState)(new i.Pq0(0,0,0)),[E,k]=(0,s.useState)(!1),[R,T]=(0,s.useState)(6084),[_,G]=(0,s.useState)(nw.clone()),[D,A]=(0,s.useState)(0),z=(0,s.useCallback)(e=>{var t;(null===(t=e.ref)||void 0===t?void 0:t.current)&&(e.ref.current.visible=!1,v.release(e.ref.current))},[v]),q=(0,s.useCallback)((e,n)=>{if(e.includes("boss")){T(Math.max(0,R-n));return}P(r=>{let s=[...r],i=s.findIndex(t=>t.id===e.replace("enemy-",""));if(-1!==i){let e=Math.max(0,s[i].health-n);if(0===e&&s[i].health>0){var o;s[i]={...s[i],health:e,isDying:!0,deathStartTime:Date.now()},M(e=>Math.max(0,e-1)),null===(o=t.onEnemyDeath)||void 0===o||o.call(t)}else s[i]={...s[i],health:e}}return s})},[R,t]),B=(0,s.useCallback)(e=>{var n;null===(n=t.onDamage)||void 0===n||n.call(t,e)},[t]),L=(0,s.useCallback)(e=>{C(e)},[]),O=(0,s.useCallback)((e,t)=>{if(e.includes("boss")){G(t.clone());return}P(n=>n.map(n=>n.id===e.replace("enemy-","")?{...n,position:t.clone()}:n))},[]),H={onHit:q,controlsRef:t.controlsRef,currentWeapon:t.currentWeapon,onWeaponSelect:t.onWeaponSelect,health:S,maxHealth:t.maxHealth,isPlayer:t.isPlayer,abilities:t.abilities,onAbilityUse:t.onAbilityUse,onPositionUpdate:L,onHealthChange:e=>{if("function"==typeof e)I(n=>{var r;let s=e(n);return null===(r=t.onHealthChange)||void 0===r||r.call(t,s),s});else{var n;I(e),null===(n=t.onHealthChange)||void 0===n||n.call(t,e)}},enemyData:[...w.map(e=>({id:"enemy-".concat(e.id),position:e.position,initialPosition:e.initialPosition,rotation:e.rotation,health:e.health,maxHealth:e.maxHealth})),...E&&R>0?[{id:"enemy-boss-1",position:_,initialPosition:nw,rotation:0,health:R,maxHealth:6084}]:[]],onDamage:t.onDamage,onEnemyDeath:()=>{console.log("Kill counted in Scene")},onFireballDamage:t.onFireballDamage,fireballManagerRef:t.fireballManagerRef,onSmiteDamage:t.onSmiteDamage};(0,s.useEffect)(()=>{let e=w.every(e=>e.health<=0),n=f&&g>u;e&&n&&o>=47&&!E&&(async()=>{var e,n,r,s;x(!1),P(e=>(e.forEach(e=>{var t;(null===(t=e.ref)||void 0===t?void 0:t.current)&&(e.ref.current.traverse(e=>{e instanceof i.eaF&&(e.geometry&&e.geometry.dispose(),Array.isArray(e.material)?e.material.forEach(e=>{e.map&&e.map.dispose(),e.normalMap&&e.normalMap.dispose(),e.specularMap&&e.specularMap.dispose(),e.envMap&&e.envMap.dispose(),e.dispose()}):e.material&&(e.material.map&&e.material.map.dispose(),e.material.normalMap&&e.material.normalMap.dispose(),e.material.specularMap&&e.material.specularMap.dispose(),e.material.envMap&&e.material.envMap.dispose(),e.material.dispose()))}),e.ref.current.parent&&e.ref.current.parent.remove(e.ref.current),e.ref.current.visible=!1,v.release(e.ref.current))}),[])),v.clear(),i.l2R.clear(),b.current&&b.current.updateMatrixWorld(),window.gc&&window.gc(),await new Promise(e=>setTimeout(e,250));let o=null===(n=t.controlsRef.current)||void 0===n?void 0:null===(e=n.domElement)||void 0===e?void 0:e.parentElement;(null==o?void 0:null===(s=o.__r3f)||void 0===s?void 0:null===(r=s.fiber)||void 0===r?void 0:r.renderer)&&o.__r3f.fiber.renderer.renderLists.dispose(),await new Promise(e=>setTimeout(e,250)),setTimeout(()=>{k(!0)},2750)})(),E&&R<=0&&a()},[t.controlsRef,w,o,a,f,g,u,E,R,v]),(0,s.useEffect)(()=>{let e=setTimeout(()=>{x(!0)},1e3);return()=>clearTimeout(e)},[]),(0,s.useEffect)(()=>{if(g>=c)return;let e=setInterval(()=>{!(y>=6)&&(o<31||P(e=>{if(c-g<=0||y>=6)return e;if((o>=36&&0===D||o>=45&&1===D)&&D<2){let t=ti();j(e=>e+1),A(e=>e+1),M(e=>e+1);let n=v.acquire();return n.visible=!0,[...e,{id:"abomination-".concat(g),position:t.clone(),initialPosition:t.clone(),rotation:0,health:961,maxHealth:961,isDying:!1,type:"abomination",ref:{current:n}}]}let t=ti(),n=(g+1)%4==0,r=v.acquire();r.visible=!0;let s=n?{id:"mage-".concat(g),position:t.clone(),initialPosition:t.clone(),rotation:0,health:361,maxHealth:361,isDying:!1,type:"mage",ref:{current:r}}:{id:"skeleton-".concat(g),position:t.clone(),initialPosition:t.clone(),rotation:0,health:361,maxHealth:361,isDying:!1,type:"regular",ref:{current:r}};return j(e=>e+1),M(e=>e+1),[...e,s]}))},2500);return()=>clearInterval(e)},[g,c,l,D,o,v,y]),(0,s.useEffect)(()=>{t.controlsRef.current&&(t.controlsRef.current.object.position.set(0,12,-18),t.controlsRef.current.target.set(0,0,0),t.controlsRef.current.update())},[t.controlsRef]),(0,s.useEffect)(()=>{P(e=>{let t=Date.now();return e.filter(e=>e.isDying&&e.deathStartTime?!(t-e.deathStartTime>=1500)||(z(e),!1):e.health>0)})},[w,z]);let N=(0,s.useCallback)(()=>{P(e=>(e.forEach(e=>{var t,n;z(e),null===(n=e.ref)||void 0===n||null===(t=n.current)||void 0===t||t.traverse(e=>{if("geometry"in e&&e.geometry instanceof i.LoY&&e.geometry.dispose(),"material"in e){let t=e.material;Array.isArray(t)?t.forEach(e=>e.dispose()):null==t||t.dispose()}})}),[])),v.clear()},[v,z]);return(0,s.useEffect)(()=>{let e=b.current;return()=>{P([]),e&&e.clear(),C(new i.Pq0(0,0,0)),j(u),G(nw.clone()),k(!1),T(6084)}},[u]),(0,s.useEffect)(()=>{let e=[],t=[];return()=>{e.forEach(e=>e.dispose()),t.forEach(e=>e.dispose())}},[]),(0,s.useEffect)(()=>N,[N]),(0,s.useEffect)(()=>(e4(),e3.mountain=new i.qFE(23,35,12),e3.mushroom=new i.Ho_(.25,.30625,4,8),e3.tree=new i.Ho_(.25,.30625,4,8),e3.skeleton=new i.LoY,e3.mage=new i.LoY,e3.boss=new i.LoY,e8.mountain=new i.uSd({color:"#2a2a2a",metalness:.1,roughness:1,emissive:"#222222",flatShading:!0,clearcoat:.1,clearcoatRoughness:.8}),e8.mushroom=new i._4j({color:"#FFBD83",roughness:.6,metalness:.2,emissive:"#FFBD83",emissiveIntensity:0}),()=>{e6()}),[]),(0,r.jsx)(s.Suspense,{fallback:null,children:(0,r.jsxs)("group",{children:[(0,r.jsx)(tt,{}),(0,r.jsx)(e9,{}),(0,r.jsx)(p,{}),(0,r.jsx)(tc,{}),(0,r.jsx)(ta,{mountains:h}),(0,r.jsx)(to,{trees:d}),(0,r.jsx)(tl,{mushrooms:m}),(0,r.jsx)("group",{ref:b,children:(0,r.jsx)(e_,{...H})}),w.map(e=>"abomination"===e.type?(0,r.jsx)(t2,{id:e.id,initialPosition:e.initialPosition,position:e.position,health:e.health,maxHealth:e.maxHealth,onTakeDamage:q,onPositionUpdate:O,playerPosition:F,onAttackPlayer:B,weaponType:t.currentWeapon},e.id):"mage"===e.type?(0,r.jsx)(tq,{id:e.id,initialPosition:e.initialPosition,position:e.position,health:e.health,maxHealth:e.maxHealth,onTakeDamage:q,onPositionUpdate:O,playerPosition:F,onAttackPlayer:B,weaponType:t.currentWeapon},e.id):(0,r.jsx)(e7,{id:e.id,initialPosition:e.initialPosition,position:e.position,health:e.health,maxHealth:e.maxHealth,onTakeDamage:q,onPositionUpdate:O,playerPosition:F,onAttackPlayer:B,weaponType:t.currentWeapon},e.id)),E&&(0,r.jsx)(nv,{id:"boss-1",initialPosition:nw,position:nw,health:R,maxHealth:6084,onTakeDamage:(e,t)=>{T(e=>Math.max(0,e-t))},onPositionUpdate:O,playerPosition:F,onAttackPlayer:B,onEnrageSpawn:()=>{if(y>=6)return;let e=ti();M(e=>e+1),P(t=>[...t,{id:"abomination-enraged-".concat(Date.now()),position:e.clone(),initialPosition:e.clone(),rotation:0,health:1024,maxHealth:1024,isDying:!1,type:"abomination",ref:{current:v.acquire()}}])}},"boss-1")]})})}function nI(e){let{sceneProps:t,onLevelTransition:n,currentLevel:o,onAbilityUnlock:a}=e,[l,c]=(0,s.useState)(!1),[u,h]=(0,s.useState)(!1),[d,m]=(0,s.useState)(!1),p=(0,s.useCallback)(()=>new Promise(e=>{let t=e=>{if("geometry"in e&&e.geometry instanceof i.LoY&&e.geometry.dispose(),"material"in e){let t=e.material;Array.isArray(t)?t.forEach(e=>e.dispose()):null==t||t.dispose()}"texture"in e&&e.texture instanceof i.gPd&&e.texture.dispose(),e.children.forEach(e=>t(e))};document.querySelectorAll("canvas").forEach(e=>{var n;let r=null===(n=e.__r3f)||void 0===n?void 0:n.scene;r&&r.traverse(t)}),window.gc&&window.gc(),e()}),[]),f=(0,s.useCallback)(()=>{if(d)return;let e=t.killCount||0;console.log("Checking level completion conditions:"),console.log("Level 1 condition: killCount >= 13 && currentLevel === 1: ".concat(e>=13&&1===o)),console.log("Level 2 condition: killCount >= 30 && currentLevel === 2: ".concat(e>=30&&2===o)),console.log("Level 3 condition: killCount >= 50 && currentLevel === 3: ".concat(e>=50&&3===o)),e>=13&&1===o?(console.log("Level 1 completion triggered"),n(1,!0),m(!0)):e>=30&&2===o?(console.log("Level 2 completion triggered"),n(2,!0),m(!0)):3===o&&e>=50&&(console.log("Level 3 completion triggered"),n(3,!1),m(!0))},[o,n,t.killCount,d]);return(0,s.useEffect)(()=>{console.log("Kill count changed: ".concat(t.killCount))},[t.killCount]),(0,s.useEffect)(()=>{(async()=>{await p(),await new Promise(e=>setTimeout(e,1100)),2===o?(c(!0),h(!1)):3===o?(c(!1),h(!0)):(c(!1),h(!1)),m(!1)})()},[o,p]),(0,s.useEffect)(()=>{console.log("Kill count changed: ".concat(t.killCount))},[t.killCount]),(0,s.useEffect)(()=>()=>{p()},[p]),(0,r.jsxs)(r.Fragment,{children:[!l&&!u&&(0,r.jsx)(th,{...t,onLevelComplete:f,onAbilityUnlock:a,spawnInterval:1e3,maxSkeletons:13,initialSkeletons:4}),l&&!u&&(0,r.jsx)(t8,{...t,onLevelComplete:f,onAbilityUnlock:a,spawnInterval:1e3,maxSkeletons:17,initialSkeletons:5,spawnCount:3}),u&&(0,r.jsx)(nS,{...t,onLevelComplete:f,onAbilityUnlock:a,spawnInterval:4500,maxSkeletons:20,initialSkeletons:5,spawnCount:4})]})}var nb=n(5019),nF=n.n(nb),nC=n(9965),nE=n.n(nC),nk=n(5831),nR=n.n(nk);function nT(e){let{damage:t,index:n,onComplete:i,timestamp:o}=e,[a,l]=(0,s.useState)(!0);(0,s.useEffect)(()=>{let e=setTimeout(()=>{l(!1),setTimeout(i,300)},1e3),t=setTimeout(()=>{i()},2e3);return()=>{clearTimeout(e),clearTimeout(t)}},[i]);let c=Math.max(0,1-(Date.now()-o)/1e3);return(0,r.jsxs)("div",{className:"".concat(nR().notification," ").concat(a?nR().visible:nR().hidden),style:{transform:"translateY(".concat(-20-25*n,"px)"),opacity:c},children:["-",t]})}var n_=n(5190),nG=n.n(n_);function nD(e){let{content:t,visible:n,x:s,y:i}=e;return n?(0,r.jsxs)("div",{className:nG().tooltip,style:{left:"".concat(s,"px"),top:"".concat(i,"px")},children:[(0,r.jsx)("h3",{children:t.title}),t.description.split("\n").map((e,t)=>(0,r.jsx)("p",{children:e},t))]}):null}let nA=e=>{let{size:t,strokeWidth:n,percentage:s,borderRadius:i,isActive:o}=e,a=n/2,l=t-n,c=4*l;return(0,r.jsx)("svg",{width:t,height:t,className:nF().roundedSquareProgress,children:(0,r.jsx)("rect",{x:a,y:a,width:l,height:l,rx:i,ry:i,stroke:o?"#ff3333":"#39ff14",strokeWidth:n,fill:"none",strokeDasharray:c,strokeDashoffset:c-c*s/100,className:nF().progressForeground})})};function nz(e){let{currentWeapon:t,playerHealth:n,maxHealth:i,abilities:a,killCount:l,activeEffects:c}=e,[h,d]=(0,s.useState)([]),m=(0,s.useRef)(0),p=(0,s.useRef)(n),[f,x]=(0,s.useState)(null),[g,j]=(0,s.useState)({x:0,y:0});(0,s.useEffect)(()=>{if(n<p.current){let e=p.current-n;d(t=>[...t,{id:m.current++,damage:e,timestamp:Date.now()}].slice(-3))}p.current=n},[n]);let y=e=>{d(t=>t.filter(t=>t.id!==e))},M=e=>e<13?1:e<30?2:3,v=(e,n)=>{let r=u[t][n],s=e.currentTarget.getBoundingClientRect();x(r),j({x:s.left+s.width/2,y:s.top})},w=()=>{x(null)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:nF().leftPanel,children:[(0,r.jsxs)("div",{className:nF().controlsSection,children:[(0,r.jsxs)("div",{className:nF().controlGroup,children:[(0,r.jsx)("div",{className:nF().controlKey,children:"W"}),(0,r.jsx)("div",{className:nF().controlKey,children:"A"}),(0,r.jsx)("div",{className:nF().controlKey,children:"S"}),(0,r.jsx)("div",{className:nF().controlKey,children:"D"}),(0,r.jsx)("div",{className:nF().controlLabel,children:"Move"})]}),(0,r.jsx)("div",{className:nF().controlDivider}),(0,r.jsxs)("div",{className:nF().controlGroup,children:[(0,r.jsx)("div",{className:nF().controlLabel,children:"Zoom"}),(0,r.jsx)("div",{className:nF().controlKey,children:"Scroll Wheel"})]})]}),(0,r.jsxs)("div",{className:nF().controlsSection,children:[(0,r.jsxs)("div",{className:nF().controlGroup,children:[(0,r.jsx)("div",{className:nF().controlKey,children:"L-Click Hold"}),(0,r.jsx)("div",{className:nF().controlLabel,children:"Auto Attack"})]}),(0,r.jsx)("div",{className:nF().controlDivider}),(0,r.jsxs)("div",{className:nF().controlGroup,children:[(0,r.jsx)("div",{className:nF().controlLabel,children:"Camera"}),(0,r.jsx)("div",{className:nF().controlKey,children:"R-Click Hold"})]})]})]}),(0,r.jsxs)("div",{className:nF().bottomPanel,children:[a[t]&&(0,r.jsx)("div",{className:nF().abilitiesSection,children:Object.entries(a[t]).map(e=>{let[n,s]=e;return(0,r.jsxs)("div",{className:"".concat(nF().ability," ").concat(s.isUnlocked?"":nF().locked),onMouseEnter:e=>v(e,n),onMouseLeave:w,children:[(0,r.jsx)("div",{className:nF().keyBind,children:s.key.toUpperCase()}),(0,r.jsx)(nE(),{src:s.icon,alt:"".concat(n," ability"),width:40,height:40,className:nF().abilityIcon}),"active"===n&&t===o.SCYTHE&&a[o.SCYTHE].active.isUnlocked&&(null==c?void 0:c.some(e=>"summon"===e.type))?(0,r.jsx)("div",{className:nF().activeOverlay,children:(0,r.jsx)(nA,{size:50,strokeWidth:4,percentage:100,borderRadius:8,isActive:!0})}):s.currentCooldown>0&&(0,r.jsxs)("div",{className:nF().cooldownOverlay,children:[(0,r.jsx)(nA,{size:50,strokeWidth:4,percentage:s.currentCooldown/s.cooldown*100,borderRadius:8}),(0,r.jsx)("span",{className:nF().cooldownText,children:Math.ceil(s.currentCooldown)})]})]},n)})}),(0,r.jsxs)("div",{className:nF().healthBarSection,children:[h.map((e,t)=>(0,r.jsx)(nT,{damage:e.damage,index:t,timestamp:e.timestamp,onComplete:()=>y(e.id)},e.id)),(0,r.jsxs)("div",{className:nF().healthBarContainer,children:[(0,r.jsxs)("div",{className:nF().healthBar,children:[(0,r.jsx)("div",{className:nF().healthBarBackground}),(0,r.jsx)("div",{className:nF().healthBarInner,style:{width:"".concat(n/i*100,"%")}}),(0,r.jsx)("div",{className:nF().healthBarShine}),(0,r.jsx)("div",{className:nF().healthBarPulse})]}),(0,r.jsxs)("span",{className:nF().healthText,children:[(0,r.jsx)("span",{className:nF().healthCurrent,children:n}),(0,r.jsx)("span",{className:nF().healthSeparator,children:"/"}),(0,r.jsx)("span",{className:nF().healthMax,children:i})]})]}),(0,r.jsxs)("div",{className:nF().experienceBarContainer,children:[(0,r.jsx)("div",{className:nF().experienceBarOrnamentLeft,children:(0,r.jsx)("span",{className:nF().levelText,children:M(l)})}),(0,r.jsx)("div",{className:nF().experienceBar,children:(0,r.jsx)("div",{className:nF().xpFill,style:{width:"".concat((e=>{let t=M(e);return 1===t?e/13*100:2===t?(e-13)/17*100:(e-30)/20*100})(l),"%")}})}),(0,r.jsx)("div",{className:nF().experienceBarOrnamentRight,children:(0,r.jsx)("span",{className:nF().killCountText,children:l})})]})]}),(0,r.jsx)(nD,{content:f,visible:!!f,x:g.x,y:g.y})]})]})}var nq=n(6133),nB=n.n(nq);function nL(e){let{onWeaponSelect:t,selectedWeapon:n,onStart:i}=e,[a,l]=(0,s.useState)(null),[c,h]=(0,s.useState)({x:0,y:0}),d=(e,t,n)=>{let r=u[t][n],s=e.currentTarget.getBoundingClientRect();l({title:r.title,description:r.description}),h({x:s.left+s.width/2,y:s.top-10})},m=()=>{l(null)};return(0,r.jsxs)("div",{className:nB().panel,onContextMenu:e=>e.preventDefault(),children:[(0,r.jsx)("h2",{children:"Eidolon IV"}),(0,r.jsxs)("div",{className:nB().iconSelection,children:[(0,r.jsxs)("div",{className:nB().weaponContainer,children:[(0,r.jsx)("div",{className:"".concat(nB().icon," ").concat(n===o.SWORD?nB().selected:""),onClick:()=>t(o.SWORD),children:(0,r.jsx)("div",{className:nB().iconContent,children:(0,r.jsx)(nE(),{src:"/icons/2.svg",alt:"Sword",width:240,height:280,unoptimized:!0})})}),(0,r.jsxs)("div",{className:nB().abilityIcons,children:[(0,r.jsxs)("div",{className:nB().abilityIcon,onMouseEnter:e=>d(e,o.SWORD,"q"),onMouseLeave:m,children:[(0,r.jsx)(nE(),{src:"/icons/q2.svg",alt:"Q Ability",width:80,height:100,unoptimized:!0}),(0,r.jsx)("span",{className:nB().abilityKey,children:"Q"})]}),(0,r.jsxs)("div",{className:nB().abilityIcon,onMouseEnter:e=>d(e,o.SWORD,"e"),onMouseLeave:m,children:[(0,r.jsx)(nE(),{src:"/icons/e2.svg",alt:"E Ability",width:80,height:100,unoptimized:!0}),(0,r.jsx)("span",{className:nB().abilityKey,children:"E"})]})]})]}),(0,r.jsxs)("div",{className:nB().weaponContainer,children:[(0,r.jsx)("div",{className:"".concat(nB().icon," ").concat(n===o.SCYTHE?nB().selected:""),onClick:()=>t(o.SCYTHE),children:(0,r.jsx)("div",{className:nB().iconContent,children:(0,r.jsx)(nE(),{src:"/icons/1.svg",alt:"Scythe",width:240,height:280,unoptimized:!0})})}),(0,r.jsxs)("div",{className:nB().abilityIcons,children:[(0,r.jsxs)("div",{className:nB().abilityIcon,onMouseEnter:e=>d(e,o.SCYTHE,"q"),onMouseLeave:m,children:[(0,r.jsx)(nE(),{src:"/icons/q1.svg",alt:"Q Ability",width:80,height:100,unoptimized:!0}),(0,r.jsx)("span",{className:nB().abilityKey,children:"Q"})]}),(0,r.jsxs)("div",{className:nB().abilityIcon,onMouseEnter:e=>d(e,o.SCYTHE,"e"),onMouseLeave:m,children:[(0,r.jsx)(nE(),{src:"/icons/e1.svg",alt:"E Ability",width:80,height:100,unoptimized:!0}),(0,r.jsx)("span",{className:nB().abilityKey,children:"E"})]})]})]}),(0,r.jsxs)("div",{className:nB().weaponContainer,children:[(0,r.jsx)("div",{className:"".concat(nB().icon," ").concat(n===o.SABRES?nB().selected:""),onClick:()=>t(o.SABRES),children:(0,r.jsx)("div",{className:nB().iconContent,children:(0,r.jsx)(nE(),{src:"/icons/3.svg",alt:"Sabres",width:240,height:280,unoptimized:!0})})}),(0,r.jsxs)("div",{className:nB().abilityIcons,children:[(0,r.jsxs)("div",{className:nB().abilityIcon,onMouseEnter:e=>d(e,o.SABRES,"q"),onMouseLeave:m,children:[(0,r.jsx)(nE(),{src:"/icons/q3.svg",alt:"Q Ability",width:80,height:100,unoptimized:!0}),(0,r.jsx)("span",{className:nB().abilityKey,children:"Q"})]}),(0,r.jsxs)("div",{className:nB().abilityIcon,onMouseEnter:e=>d(e,o.SABRES,"e"),onMouseLeave:m,children:[(0,r.jsx)(nE(),{src:"/icons/e3.svg",alt:"E Ability",width:80,height:100,unoptimized:!0}),(0,r.jsx)("span",{className:nB().abilityKey,children:"E"})]})]})]}),(0,r.jsxs)("div",{className:nB().weaponContainer,children:[(0,r.jsx)("div",{className:"".concat(nB().icon," ").concat(n===o.SPEAR?nB().selected:""),onClick:()=>t(o.SPEAR),children:(0,r.jsx)("div",{className:nB().iconContent,children:(0,r.jsx)(nE(),{src:"/icons/q4.svg",alt:"Spear",width:240,height:280,unoptimized:!0})})}),(0,r.jsxs)("div",{className:nB().abilityIcons,children:[(0,r.jsxs)("div",{className:nB().abilityIcon,onMouseEnter:e=>d(e,o.SPEAR,"q"),onMouseLeave:m,children:[(0,r.jsx)(nE(),{src:"/icons/q4.svg",alt:"Q Ability",width:80,height:100,unoptimized:!0}),(0,r.jsx)("span",{className:nB().abilityKey,children:"Q"})]}),(0,r.jsxs)("div",{className:nB().abilityIcon,onMouseEnter:e=>d(e,o.SPEAR,"e"),onMouseLeave:m,children:[(0,r.jsx)(nE(),{src:"/icons/e4.svg",alt:"E Ability",width:80,height:100,unoptimized:!0}),(0,r.jsx)("span",{className:nB().abilityKey,children:"E"})]})]})]}),(0,r.jsxs)("div",{className:nB().weaponContainer,children:[(0,r.jsx)("div",{className:"".concat(nB().icon," ").concat(n===o.BOW?nB().selected:""),onClick:()=>t(o.BOW),children:(0,r.jsx)("div",{className:nB().iconContent,children:(0,r.jsx)(nE(),{src:"/icons/5.svg",alt:"Bow",width:240,height:280,unoptimized:!0})})}),(0,r.jsxs)("div",{className:nB().abilityIcons,children:[(0,r.jsxs)("div",{className:nB().abilityIcon,onMouseEnter:e=>d(e,o.BOW,"q"),onMouseLeave:m,children:[(0,r.jsx)(nE(),{src:"/icons/q5.svg",alt:"Q Ability",width:80,height:100,unoptimized:!0}),(0,r.jsx)("span",{className:nB().abilityKey,children:"Q"})]}),(0,r.jsxs)("div",{className:nB().abilityIcon,onMouseEnter:e=>d(e,o.BOW,"e"),onMouseLeave:m,children:[(0,r.jsx)(nE(),{src:"/icons/e3.svg",alt:"E Ability",width:80,height:100,unoptimized:!0}),(0,r.jsx)("span",{className:nB().abilityKey,children:"E"})]})]})]})]}),(0,r.jsx)("button",{className:nB().startButton,onClick:i,disabled:!n,children:"Enter"}),a&&(0,r.jsx)(nD,{content:a,visible:!!a,x:c.x,y:c.y})]})}var nO=n(5151),nH=n.n(nO);function nN(e){let{onContinue:t,onSelectIcon:n,selectedIcon:i,currentWeapon:a,onAbilityUnlock:l,abilities:c}=e,[h,d]=(0,s.useState)(null),[m,p]=(0,s.useState)({x:0,y:0}),f=(e,t)=>{let n=u[a][t],r=e.currentTarget.getBoundingClientRect();d(n),p({x:r.left-721,y:r.top-70})},x=()=>{d(null)},g=(e,t)=>{t||n(e)},j=(()=>{switch(a){case o.SCYTHE:return{r:"/Eidolon/icons/r1.svg",p:"/Eidolon/icons/p1.svg",s:"/Eidolon/icons/a1.svg"};case o.SWORD:return{r:"/Eidolon/icons/r2.svg",p:"/Eidolon/icons/p2.svg",s:"/Eidolon/icons/a2.svg"};case o.SABRES:return{r:"/Eidolon/icons/r3.svg",p:"/Eidolon/icons/p3.svg",s:"/Eidolon/icons/a3.svg"}}})();return(0,r.jsxs)("div",{className:nH().panel,style:{pointerEvents:"auto"},onContextMenu:e=>e.preventDefault(),children:[(0,r.jsx)("h2",{children:"Level Complete!"}),(0,r.jsx)("p",{children:"Choose an ability to unlock:"}),(0,r.jsxs)("div",{className:nH().iconSelection,children:[(0,r.jsx)("div",{className:"".concat(nH().icon," \n            ").concat(1===i?nH().selected:""," \n            ").concat(c[a].r.isUnlocked?nH().disabled:""),onClick:()=>g(1,c[a].r.isUnlocked),onMouseEnter:e=>f(e,"r"),onMouseLeave:x,children:(0,r.jsxs)("div",{className:nH().iconContent,children:[(null==j?void 0:j.r)&&(0,r.jsx)(nE(),{src:j.r,alt:"R Ability",width:75,height:75,priority:!0}),(0,r.jsx)("p",{children:"[R] Hotkey"})]})}),(0,r.jsx)("div",{className:"".concat(nH().icon," \n            ").concat(2===i?nH().selected:""," \n            ").concat(c[a].passive.isUnlocked?nH().disabled:""),onClick:()=>g(2,c[a].passive.isUnlocked),onMouseEnter:e=>f(e,"passive"),onMouseLeave:x,children:(0,r.jsxs)("div",{className:nH().iconContent,children:[(null==j?void 0:j.p)&&(0,r.jsx)(nE(),{src:j.p,alt:"Passive Ability",width:75,height:75,priority:!0}),(0,r.jsx)("p",{children:"[1] Hotkey"})]})}),(a===o.SCYTHE||a===o.SABRES||a===o.SWORD)&&(0,r.jsx)("div",{className:"".concat(nH().icon," \n              ").concat(3===i?nH().selected:""," \n              ").concat(c[a].active.isUnlocked?nH().disabled:""),onClick:()=>g(3,c[a].active.isUnlocked),onMouseEnter:e=>f(e,"active"),onMouseLeave:x,children:(0,r.jsxs)("div",{className:nH().iconContent,children:[(null==j?void 0:j.s)&&(0,r.jsx)(nE(),{src:j.s,alt:"Active Ability",width:75,height:75,priority:!0}),(0,r.jsx)("p",{children:"[2] Hotkey"})]})})]}),(0,r.jsx)("button",{className:nH().continueButton,onClick:()=>{null!==i&&(l(1===i?"r":2===i?"passive":"active"),t())},disabled:null===i,children:"Confirm"}),(0,r.jsx)(nD,{content:h,visible:!!h,x:m.x,y:m.y})]})}var nW=n(2374),nU=n.n(nW);let nQ=[{title:"The Darkness Claims Another",subtitle:"Your soul joins the eternal dance..."},{title:"Fallen to Shadow",subtitle:"The necropolis grows stronger..."},{title:"Death's Embrace",subtitle:"The bones welcome their kin..."},{title:"The Last Stand",subtitle:"Your light fades into the abyss..."},{title:"Eternal Rest",subtitle:"The skeleton army claims victory..."},{title:"Denied Ascension",subtitle:"The dragons turn their backs on another unworthy soul..."},{title:"Draconic Disappointment",subtitle:"Your flames were not strong enough to join their ranks..."},{title:"Failed Wyrm",subtitle:"The ancient dragons scoff at your weakness..."},{title:"Wingless One",subtitle:"You'll never know the freedom of dragon flight..."},{title:"Mortal Chains",subtitle:"Forever bound to walk while dragons soar above..."},{title:"Lost Heritage",subtitle:"The dragon blood within you grows cold..."},{title:"Fading Ember",subtitle:"Your draconic spark extinguishes in darkness..."},{title:"Rejected by Fire",subtitle:"The dragon's flame finds you unworthy..."}];function nY(e){let{playerHealth:t,killCount:n}=e,[i,o]=(0,s.useState)(!1),[a,l]=(0,s.useState)(null);return(0,s.useEffect)(()=>{t<=0&&!i&&(l(nQ[Math.floor(Math.random()*nQ.length)]),o(!0),window.dispatchEvent(new CustomEvent("gameOver")))},[t,i]),(0,r.jsx)(r.Fragment,{children:i&&a&&(0,r.jsxs)("div",{className:nU().gameOverContainer,onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),children:[(0,r.jsx)("h1",{className:nU().gameOverTitle,children:a.title}),(0,r.jsx)("p",{className:nU().gameOverSubtitle,children:a.subtitle}),(0,r.jsx)("button",{className:nU().retryButton,onClick:()=>{console.log("Behavior: Reset triggered"),window.location.reload()},children:"RETRY"}),(0,r.jsxs)("div",{className:nU().killCounter,children:["Skeletons Defeated: ",n]})]})})}let nZ=(0,s.createContext)({isPaused:!1});function nV(e){let{children:t}=e,[n,i]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{let e=()=>{i(document.hidden)},t=()=>{i(!0)},n=()=>{i(!1)},r=e=>{(e.ctrlKey||e.metaKey)&&"s"===e.key.toLowerCase()&&e.preventDefault(),(e.ctrlKey||e.metaKey)&&"f"===e.key.toLowerCase()&&e.preventDefault(),(e.ctrlKey||e.metaKey)&&"p"===e.key.toLowerCase()&&e.preventDefault(),(e.ctrlKey||e.metaKey)&&"n"===e.key.toLowerCase()&&e.preventDefault(),(e.ctrlKey||e.metaKey)&&"d"===e.key.toLowerCase()&&e.preventDefault()},s=e=>{e.preventDefault()};return document.addEventListener("visibilitychange",e),window.addEventListener("blur",t),window.addEventListener("focus",n),document.addEventListener("keydown",r),document.addEventListener("contextmenu",s),()=>{document.removeEventListener("visibilitychange",e),window.removeEventListener("blur",t),window.removeEventListener("focus",n),document.removeEventListener("keydown",r),document.removeEventListener("contextmenu",s)}},[]),(0,r.jsx)(nZ.Provider,{value:{isPaused:n},children:t})}function nK(e){let{sceneProps:t,currentWeapon:n,onWeaponSelect:o,playerHealth:a,maxHealth:l,abilities:c,onReset:u,killCount:h,onAbilityUnlock:p}=e,[f,x]=(0,s.useState)(!1),[g,j]=(0,s.useState)(!1),[y,M]=(0,s.useState)(null),[v,w]=(0,s.useState)(1),P=(0,s.useCallback)((e,t)=>{t?j(!0):w(e=>e+1)},[]),S=(0,s.useCallback)(()=>{j(!1),M(null),w(e=>e+1)},[]),I=(0,s.useCallback)(()=>{console.log("GameWrapper: Reset triggered"),x(!1),w(1),j(!1),M(null),u()},[u,,]);return(0,s.useEffect)(()=>{let e=e=>{"Space"===e.code&&e.preventDefault()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),(0,s.useEffect)(()=>()=>{t.unitProps.controlsRef.current&&t.unitProps.controlsRef.current.dispose(),i.l2R.clear()},[t.unitProps.controlsRef]),(0,r.jsx)(nV,{children:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{style:{width:"100vw",height:"100vh",overflow:"hidden",position:"fixed",top:0,left:0,touchAction:"none"},children:(0,r.jsxs)(d.Hl,{frameloop:"demand",performance:{min:.5},dpr:[1,2],children:[(0,r.jsx)("ambientLight",{intensity:.215}),f&&(0,r.jsx)(s.Suspense,{fallback:null,children:(0,r.jsx)(nI,{sceneProps:{...t,onReset:I},onAbilityUnlock:p,onLevelTransition:P,currentLevel:v})}),(0,r.jsx)(m.N,{ref:t.unitProps.controlsRef,enablePan:!1,minPolarAngle:Math.PI/6,maxPolarAngle:Math.PI/2.25,maxDistance:11.5,mouseButtons:{LEFT:void 0,MIDDLE:void 0,RIGHT:i.kBv.ROTATE},minDistance:11.5,rotateSpeed:.8,enableDamping:!0,dampingFactor:.075,zoomSpeed:1.25,position:[0,15,20],target:[0,0,0]})]})}),(0,r.jsx)(nY,{playerHealth:a,onReset:I,killCount:h,onEnemiesDefeated:()=>{},maxSkeletons:12}),(0,r.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:!f||g?"auto":"none",zIndex:1e3},children:f?g?(0,r.jsx)(nN,{onContinue:S,onSelectIcon:M,selectedIcon:y,currentWeapon:n,onAbilityUnlock:p,abilities:c}):(0,r.jsx)(nz,{currentWeapon:n,onWeaponSelect:()=>{},playerHealth:a,maxHealth:l,abilities:c,onReset:u,killCount:h}):(0,r.jsx)(nL,{onWeaponSelect:o,selectedWeapon:n,onStart:()=>{console.log("handleStart called, currentWeapon:",n),n&&x(!0)}})})]})})}let n$=()=>{let e=Math.random()*Math.PI*2,t=15*Math.sqrt(Math.random());return new i.Pq0(Math.cos(e)*t,0,Math.sin(e)*t)};function nX(){let[e,t]=(0,s.useState)(null),n=(0,s.useRef)(null),[a,u]=(0,s.useState)(200),[h,d]=(0,s.useState)(200),[m,p]=(0,s.useState)(0),[f,x]=(0,s.useState)(()=>l),[g,j]=(0,s.useState)({r:!1,passive:!1,active:!1}),y=t=>{console.log("Unlocking ".concat(t," ability")),j(e=>({...e,[t]:!0})),x(n=>{let r={...n};return e&&(r[e][t]={...r[e][t],isUnlocked:!0}),r})},M=e=>{t(e)},v=(0,s.useCallback)((e,t)=>{let n=Date.now();if(n-m>100){if(e.startsWith("skeleton-")){let n=parseInt(e.split("-")[1]);S(e=>{let r=[...e];return r[n]=Math.max(0,e[n]-t),r})}p(n)}},[m]),w=(e,t)=>{x(n=>{let r={...n};return r[e][t].currentCooldown=c(e,t,n),r})};(0,s.useEffect)(()=>{let e=setInterval(()=>{x(e=>{let t={...e};return Object.keys(t).forEach(e=>{["q","e","r","passive","active"].forEach(n=>{t[e][n].currentCooldown>0&&(t[e][n].currentCooldown-=.15)})}),t})},150);return()=>clearInterval(e)},[]);let[P]=(0,s.useState)(new i.Pq0(0,0,0)),[,S]=(0,s.useState)(()=>[,,,,,].fill(175)),[I,b]=(0,s.useState)(()=>Array.from({length:5},(e,t)=>{let n=n$();return{id:"skeleton-".concat(t),initialPosition:n,position:n.clone(),rotation:0,health:196,maxHealth:196,onTakeDamage:(e,t)=>{b(n=>n.map(n=>n.id===e?{...n,health:Math.max(0,n.health-t)}:n))}}})),[F,C]=(0,s.useState)(0),E=(0,s.useCallback)(()=>{console.log("Enemy death registered in HomePage"),C(e=>{let t=e+1;return console.log("Kill count updated:",t),d(200+t),u(e=>e+1),t})},[]),k=(0,s.useCallback)((e,t,n)=>{b(n=>n.map(n=>n.id===e?{...n,health:Math.max(0,n.health-t)}:n)),n&&console.log("Critical hit on ".concat(e," for ").concat(t," damage!"))},[]),R=(0,s.useCallback)((e,t,n,r)=>{console.log("Smite hit ".concat(e," for ").concat(t," damage (Critical: ").concat(n,") at position:"),r),v(e,t)},[v]),T=(0,s.useRef)(null),_=()=>{console.log("HomePage: Reset triggered"),d(200),u(200),S([,,,,,].fill(175)),x(e=>{let t={...e};return Object.keys(t).forEach(e=>{["q","e"].forEach(n=>{t[e][n].currentCooldown=0})}),t}),p(0),C(0),t(null),j({r:!1,passive:!1,active:!1})},G=(0,s.useCallback)(e=>{u(t=>Math.min(h,t+e))},[h]),D={bossActive:!1,onAbilityUnlock:y,onReset:_,unitProps:{onFireballDamage:k,onSmiteDamage:R,onHit:v,controlsRef:n,currentWeapon:e||o.SCYTHE,onWeaponSelect:M,health:a,maxHealth:h,isPlayer:!0,abilities:{...f,...e?{[e]:{...f[e],r:{...f[e].r,isUnlocked:g.r},passive:{...f[e].passive,isUnlocked:g.passive}}}:{}},onAbilityUse:(t,n)=>{e&&w(t,n)},onPositionUpdate:e=>{P.copy(e)},enemyData:I.map(e=>({id:e.id,position:e.position,rotation:e.rotation||0,initialPosition:e.initialPosition,currentPosition:e.position.clone(),health:e.health,maxHealth:e.maxHealth})),onDamage:e=>{u(t=>Math.max(0,t-e))},onEnemyDeath:E,fireballManagerRef:T,onHealthChange:G},skeletonProps:I,killCount:F,onFireballDamage:k,onWeaponSelect:M};return(0,s.useEffect)(()=>{let e=e=>{"Space"===e.code&&e.preventDefault()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[]),(0,r.jsx)("div",{style:{width:"100vw",height:"100vh",overflow:"hidden",position:"fixed",top:0,left:0},children:(0,r.jsx)(nK,{sceneProps:D,currentWeapon:e,onWeaponSelect:M,playerHealth:a,maxHealth:h,abilities:f,onReset:_,killCount:F,onAbilityUnlock:y})})}},5831:e=>{e.exports={notification:"DamageNotification_notification__f3Yeu",floatUp:"DamageNotification_floatUp__Myim4",visible:"DamageNotification_visible__jYt6g",hidden:"DamageNotification_hidden__l4PWe"}},5151:e=>{e.exports={panel:"LevelCompletionPanel_panel__dcef3",iconSelection:"LevelCompletionPanel_iconSelection__jS9NE",icon:"LevelCompletionPanel_icon__lRABe",selected:"LevelCompletionPanel_selected__PqyOR",continueButton:"LevelCompletionPanel_continueButton__xlmot",iconContent:"LevelCompletionPanel_iconContent__DqvWS",disabled:"LevelCompletionPanel_disabled__npgST"}},5019:e=>{e.exports={bottomPanel:"Panel_bottomPanel__E_GFV",weaponSection:"Panel_weaponSection__zIJl0",weaponIcon:"Panel_weaponIcon__iLPYg",levelBadge:"Panel_levelBadge__XHoiD",badgePulse:"Panel_badgePulse__tCaHu",statsSection:"Panel_statsSection__cewg2",healthBarContainer:"Panel_healthBarContainer___xHn5",healthBarInner:"Panel_healthBarInner__B2SSK",experienceBar:"Panel_experienceBar__G5pO5",abilitiesSection:"Panel_abilitiesSection__LVE1_",ability:"Panel_ability__vWpFg",healthBarSection:"Panel_healthBarSection__Lc4_u",healthBarDecoration:"Panel_healthBarDecoration__ok97A",healthBarOrnamentLeft:"Panel_healthBarOrnamentLeft__l_eLO",healthBarOrnamentRight:"Panel_healthBarOrnamentRight__DlmuW",healthBar:"Panel_healthBar__Md85Z",healthBarBackground:"Panel_healthBarBackground__jdRKY",healthBarShine:"Panel_healthBarShine__88Hkf",shine:"Panel_shine__uI8op",healthBarPulse:"Panel_healthBarPulse__CZkcb",pulse:"Panel_pulse__tyA5r",healthText:"Panel_healthText__1fCQl",healthCurrent:"Panel_healthCurrent__7n6qI",healthSeparator:"Panel_healthSeparator__aVnh_",healthMax:"Panel_healthMax__tYk8m",abilityContainer:"Panel_abilityContainer__sN6a4",abilityIcon:"Panel_abilityIcon__3DloH",weaponIcons:"Panel_weaponIcons__FW360",weaponSlot:"Panel_weaponSlot__dVwz7",keyBind:"Panel_keyBind__D5m1t",activeWeapon:"Panel_activeWeapon__uZq6r",cooldownOverlay:"Panel_cooldownOverlay__GJ3zY",cooldownText:"Panel_cooldownText__kVTtb",roundedSquareProgress:"Panel_roundedSquareProgress__1eZW_",progressForeground:"Panel_progressForeground__Acr3c",gameOverOverlay:"Panel_gameOverOverlay__Bud_o",gameOverTitle:"Panel_gameOverTitle__zo4Jg",gameOverSubtitle:"Panel_gameOverSubtitle__qVO8v",retryButton:"Panel_retryButton__GOTn9",killCounter:"Panel_killCounter__iC_Sg",killCountText:"Panel_killCountText__hQyjQ",xpFill:"Panel_xpFill__RXvNL",levelText:"Panel_levelText__SgUXR",experienceBarContainer:"Panel_experienceBarContainer__9mese",experienceBarOrnamentLeft:"Panel_experienceBarOrnamentLeft__JvEOr",experienceBarOrnamentRight:"Panel_experienceBarOrnamentRight__can19",locked:"Panel_locked__Anu5g",tooltip:"Panel_tooltip__tY4zh",abilityTooltip:"Panel_abilityTooltip__QPsMI",controlsSection:"Panel_controlsSection__V2l2S",controlGroup:"Panel_controlGroup__ZKwO3",controlKey:"Panel_controlKey__NC_tm",controlLabel:"Panel_controlLabel__7c5bl",controlDivider:"Panel_controlDivider__R4TV2",leftPanel:"Panel_leftPanel___5GQG",activeOverlay:"Panel_activeOverlay__wG7FY",activeIndicator:"Panel_activeIndicator__qrpa9",weaponPulse:"Panel_weaponPulse__fP758",glowPulse:"Panel_glowPulse__Ye37n"}},5190:e=>{e.exports={tooltip:"Tooltip_tooltip__7tEfC",fadeIn:"Tooltip_fadeIn___CG3h"}},6133:e=>{e.exports={panel:"WeaponSelectionPanel_panel__XVTME",iconContent:"WeaponSelectionPanel_iconContent__0raLR",icon:"WeaponSelectionPanel_icon__s7G0N",startButton:"WeaponSelectionPanel_startButton__zI16Y",abilityIcon:"WeaponSelectionPanel_abilityIcon__QOQYl",iconSelection:"WeaponSelectionPanel_iconSelection__b3lef",selected:"WeaponSelectionPanel_selected__yqwcS",spinHex:"WeaponSelectionPanel_spinHex__23BFC",pulseGlow:"WeaponSelectionPanel_pulseGlow__6GI0P",weaponContainer:"WeaponSelectionPanel_weaponContainer__EKXnN",abilityIcons:"WeaponSelectionPanel_abilityIcons__T_1Eq",abilityKey:"WeaponSelectionPanel_abilityKey__jRO8H",tooltip:"WeaponSelectionPanel_tooltip__RM0kA",pulseAbility:"WeaponSelectionPanel_pulseAbility__gH5Qg"}},2374:e=>{e.exports={gameOverContainer:"Behavior_gameOverContainer__wiKZW",gameOverTitle:"Behavior_gameOverTitle__B0h2R",gameOverSubtitle:"Behavior_gameOverSubtitle____YXI",retryButton:"Behavior_retryButton__N9g61",killCounter:"Behavior_killCounter__Vm3B2"}}},e=>{var t=t=>e(e.s=t);e.O(0,[624,438,84,111,636,593,792],()=>t(2022)),_N_E=e.O()}]);